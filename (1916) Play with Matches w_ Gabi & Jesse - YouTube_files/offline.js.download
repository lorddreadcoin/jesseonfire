(function(g){var window=this;'use strict';var EGv=function(Z,u,G){u={offlineVideoData:u,playlistId:G};if(Z=g.C(Z.actionMetadata,JNs))u.maximumDownloadQuality=Z.maximumDownloadQuality;return{mainVideoEntityActionMetadata:u}},Uii=function(){CX.apply(this,arguments)},Brk=function(Z,u){var G,y,q,N,e,h,d;
return g.A(function(K){switch(K.j){case 1:if(u.length===0)return K.return([]);G=u.map(function(f){return g.hq(f,"transfer")});
return g.S(K,PH(Z.j,"transfer",G),2);case 2:y=K.U;q=y.filter(pCH).map(function(f){return g.ZE(f.key).entityId});
N=u.filter(function(f){return q.indexOf(f)===-1});
if(N.length===0)return K.return([]);e=g.m(N);h=e.next();case 3:if(h.done){K.Rl(5);break}d=h.value;return g.S(K,Hee(d),4);case 4:h=e.next();K.Rl(3);break;case 5:return K.return(N)}})},Wrk=function(Z){if(!Z.T&&!Z.j){var u=t6v();
if(u){Z.T=!0;var G=g.UG("OfflineLockManager");u.request("woffle_orchestration_leader:"+G,{},function(){var y,q;return g.A(function(N){switch(N.j){case 1:return g.QS(N,2),Z.U=new g.JN,Z.j=!0,Z.T=!1,g.S(N,Z.C(),4);case 4:return g.S(N,Z.U.promise,5);case 5:g.u8(N,0);break;case 2:y=g.Ts(N),Z.mj(),y instanceof Error&&(q=y,q.args=[{name:"WoLockManagerError",zX:y.name}],g.SE(q)),g.pA(N)}})})}}},jCk=function(){CX.apply(this,arguments)},OeJ=function(){oz.apply(this,arguments)},ANv=function(){oz.apply(this,
arguments)},zcd=function(){CX.apply(this,arguments)},LrR=function(Z){var u=Z.videos;
Z=[];var G=[];if(u){u=g.m(u);for(var y=u.next();!y.done;y=u.next()){var q=y.value.offlineVideoData.videoId;y=g.hq(q,"musicTrack");q=g.hq(q,"musicTrackDownloadMetadataEntity");Z.push(y);G.push(q)}}return{FR:Z,jG:G}},sCk=function(Z){switch(Z){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
CZk=function(Z){var u,G;
return g.A(function(y){if(y.j==1)return g.S(y,QO(),2);if(y.j!=3){u=y.U;if(!u)return FE("PES is undefined"),y.return();Z.U=new vGe(u,Z.api,Z.T,Z.j);G=Z.ww(u);return g.S(y,SWk(u,G,Z.T,Z.j,Z.W),3)}Z.K=y.U;return g.S(y,RcJ(Z),0)})},PZk=function(Z){return new g.AI(function(u,G){var y=Z.length,q=[];
if(y)for(var N=function(K,f){y--;q[K]=f;y==0&&u(q)},e=function(K){G(K)},h,d=0;d<Z.length;d++)h=Z[d],g.lq7(h,g.gM(N,d),e);
else u(q)})},Frd=function(Z){var u,G,y,q,N,e,h,d;
return g.A(function(K){switch(K.j){case 1:return u=g.Mt(),G=oGi(Z),y=g.dW(QCJ),g.QS(K,2),N={aL:!0},g.S(K,g.KI(u,G,y,void 0,N),4);case 4:q=K.U;g.u8(K,3);break;case 2:e=g.Ts(K);if(e instanceof g.u$)throw h="GetOffline network manager error: "+e.message,FE(h,e),Error(h);FE("GetOffline fetch request error",e);throw Error("GetOffline fetch request error");case 3:d=cH(q);if(!q)throw FE("Network request failed"),Error("Network request failed");if(d!==void 0)gq(d);else if(!q.videos||!q.videos.length)throw FE("No data"),
Error("No data");return K.return(q.videos.map(function(f){return f.offlineVideoData}))}})},cNH=function(){CX.apply(this,arguments)},gG4=function(){CX.apply(this,arguments)},Tri=function(Z,u){var G;
return g.A(function(y){return y.j==1?g.S(y,wCJ(Z,u),2):(G=y.U)?g.S(y,wq(Z,{mode:"readwrite",SK:!0},function(q){var N=[TL(q,G.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];G.mainDownloadsListEntity&&N.push(TL(q,G.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.nB.all(N)}),0):y.Rl(0)})},adR=function(Z,u,G){this.j=Z;
this.W=u;this.T=G},be4=function(){CX.apply(this,arguments)},Ide=function(){CX.apply(this,arguments)},$is=function(){CX.apply(this,arguments)},rNs=function(Z,u,G){var y,q,N,e,h,d,K,f,V,X,n,l,Y,E;
return g.A(function(W){if(W.j==1){y=u.additionalMetadadatas;q=void 0;if(y&&y.length>0)for(N=g.m(y),e=N.next();!e.done;e=N.next())if(h=e.value,h.offlineMusicPlaylistData){q=h.offlineMusicPlaylistData;break}d=u.playlistId;K=LrR(u);f=K.FR;V=K.jG;X=G?(Number(G)*1E3).toString():Date.now().toString();n=u.lastModifiedTimestamp?(Number(u.lastModifiedTimestamp)*1E3).toString():"0";l={id:g.hq(d,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:V,lastModifiedTimestampMillis:n,addedTimestampMillis:X,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};Y={id:g.hq(d,"musicAlbumRelease"),title:u.title,audioPlaylistId:d,trackCount:u.totalVideoCount,tracks:f,downloadMetadata:l.id};q&&(Y.thumbnailDetails=(E=q.albumHqThumbnail)!=null?E:q.albumArtistThumbnail,Y.artistDisplayName=q.albumArtistDisplayName,Y.releaseDate=q.albumReleaseDate,Y.contentRating={explicitType:q.albumReleaseExplicitType},Y.releaseType=q.albumReleaseType);return g.S(W,wq(Z.j,{mode:"readwrite",SK:!0},function(p){var z=TL(p,Y,"musicAlbumRelease");
p=TL(p,l,"musicAlbumReleaseDownloadMetadataEntity");return g.nB.all([z,p])}),2)}return W.return(Y)})},ieJ=function(){CX.apply(this,arguments)},kjd=function(){CX.apply(this,arguments)},Z$J=function(Z){return g.fH((0,g.wPR)(),Z)},uCi=function(){CX.apply(this,arguments)},az=function(Z,u){u=u===void 0?{}:u;
g.dw.call(this,g.T4e[Z],Object.assign({},{name:"PESEncoderError",type:Z},u));this.type=Z;this.level="WARNING";Object.setPrototypeOf(this,az.prototype)},Gzk=function(Z,u){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:Z},metadata:u,statusCode:void 0,csn:void 0,can:void 0}},yhJ=function(){CX.apply(this,arguments)},quw=function(){oz.apply(this,arguments)},xoi=function(Z,u,G){G=G===void 0?!1:G;
var y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W;return g.A(function(p){switch(p.j){case 1:return y=g.C(u.actionMetadata,Ncd),q=g.ZE(u.entityKey).entityId,N=g.hq(q,"downloadStatusEntity"),g.S(p,wq(Z.j,{mode:"readonly",SK:!0},function(z){var L=bR(z,N,"downloadStatusEntity");z=bR(z,g.hq(q,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.nB.all([L,z])}),2);
case 2:return e=p.U,h=g.m(e),d=h.next().value,K=h.next().value,f=d,V=K,X="TRANSFER_STATE_TRANSFER_IN_QUEUE",((n=f)==null?void 0:n.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(X="TRANSFER_STATE_PAUSED_BY_USER"),E={key:u.entityKey,transferState:X,cotn:g.HU(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(l=y)==null?void 0:l.maximumDownloadQuality,preferredAudioTrack:(Y=y)==null?void 0:Y.preferredAudioTrack,transferRetryCount:0,isRefresh:G,hasLoggedFirstStarted:!1},g.S(p,wq(Z.j,
{mode:"readwrite",SK:!0},function(z){var L=[];G&&L.push(Iz(z,g.hq(q,"offlineVideoStreams")));L.push(TL(z,E,"transfer"));return g.nB.all(L)}),3);
case 3:if(!G){p.Rl(4);break}return g.S(p,Hee(q),4);case 4:eji({videoId:q,wJ:E,offlineModeType:(W=V)==null?void 0:W.offlineModeType}),g.pA(p)}})},hja=function(){CX.apply(this,arguments)},doH=function(){CX.apply(this,arguments)},Xxa=function(Z,u){var G,y,q,N;
return g.A(function(e){switch(e.j){case 1:return G=$w(u),g.QS(e,2),y=g.ZE(u.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?g.S(e,KTJ(Z.j,u,Z.T,(q=u.actionMetadata)==null?void 0:(N=q.offlineLoggingData)==null?void 0:N.offlineDeleteReason),5):g.S(e,fPd(y,Z.j,u,Z.T),6);case 6:if(!Z.W.S("woffle_enable_main_downloads_library")){e.Rl(5);break}return g.S(e,VtJ(Z.j,u.entityKey),5);case 5:g.u8(e,3);break;case 2:return g.Ts(e),e.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},nlR=function(){CX.apply(this,arguments)},lPv=function(){CX.apply(this,arguments)},Doe=function(){CX.apply(this,arguments)},MtR=function(Z,u){return{id:Z,
channelId:u.channelId,title:u.title,avatar:u.thumbnail}},iR=function(Z){this.j=Z},VtJ=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E;
return g.A(function(W){if(W.j==1)return G=g.hq("main_downloads_library_id","mainDownloadsLibraryEntity"),y=g.hq("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.S(W,wq(Z,{mode:"readonly",SK:!0},function(p){return g.nB.all([bR(p,G,"mainDownloadsLibraryEntity"),bR(p,y,"mainDownloadsListEntity"),bR(p,g.Sk,"mainDownloadsListEntity")])}),2);
q=W.U;N=g.m(q);e=N.next().value;h=N.next().value;d=N.next().value;K=e;f=h;V=d;if(!K)return W.Rl(0);if(u===g.Sk&&((X=V)==null?0:X.downloads))V.downloads=[];else if((n=f)==null?0:n.downloads)for(l=g.ZE(u).entityType,Y=0;Y<f.downloads.length;Y++)if(E=f.downloads[Y],l==="mainVideoEntity"&&E.videoItem===u){f.downloads.splice(Y,1);break}else if(l==="mainPlaylistEntity"&&E.playlistItem===u){f.downloads.splice(Y,1);break}return g.S(W,wq(Z,{mode:"readwrite",SK:!0},function(p){var z=[TL(p,K,"mainDownloadsLibraryEntity")];
f&&z.push(TL(p,f,"mainDownloadsListEntity"));V&&z.push(TL(p,V,"mainDownloadsListEntity"));return g.nB.all(z)}),0)})},Jh4=function(Z){var u,G;
return g.A(function(y){if(y.j==1)return g.S(y,PH(Z.U,"transfer"),2);u=y.U;G=u.filter(mov).sort(Yuk);return G.length===0?y.return():y.return(G[0])})},ElJ=function(Z,u,G,y,q){var N;
return g.A(function(e){return e.j==1?(q||(q=Date.now().toString()),N={id:g.hq(G,"musicTrackDownloadMetadataEntity"),playbackData:g.hq(G,"playbackData"),addedTimestampMillis:q,videoDownloadContextEntity:g.hq(G,"videoDownloadContextEntity")},y&&(u.albumRelease=y.id),g.S(e,wq(Z.j,{mode:"readwrite",SK:!0},function(h){var d=[],K=TL(h,N,"musicTrackDownloadMetadataEntity");d.push(K);K=TL(h,u,"musicTrack");d.push(K);y&&(h=TL(h,y,"musicAlbumRelease"),d.push(h));return g.nB.all(d)}),2)):e.j!=3?g.S(e,kw(G,"musicTrackDownloadMetadataEntity",
Z.j,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):e.return({musicTrackEntity:u,
Lv:y})})},UoJ=function(){CX.apply(this,arguments)},H$k=function(Z){var u=pxJ[Z];
if(u)return u;g.h6(new g.dw("Entity model not found.",{entityType:Z}))},CX=function(){oz.apply(this,arguments)},tti=function(Z,u){var G,y;
return g.A(function(q){switch(q.j){case 1:return G=$w(u),g.QS(q,2),y=g.ZE(u.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?g.S(q,Z4(Z.j,u,Z.T),5):g.S(q,uM(y,Z.j,u,Z.T),6);case 6:return g.S(q,BcR(Z.j,u.entityKey),5);case 5:g.u8(q,3);break;case 2:return g.Ts(q),q.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},bR=function(Z,u,G){return Z.j.objectStore("EntityStore").get(u).then(function(y){if(y){if(G&&y.entityType!==G)throw Error("Incorrect entity type");
return WTk(Z,y)}})},jYR=function(){var Z,u,G,y,q,N;
return g.A(function(e){switch(e.j){case 1:return g.S(e,QO(),2);case 2:Z=e.U;if(!Z)return e.return([]);u=Date.now()/1E3;return g.S(e,PH(Z,"offlineVideoPolicy"),3);case 3:G=e.U,y=g.m(G),q=y.next();case 4:if(q.done){e.Rl(6);break}N=q.value;if(!(N.expirationTimestamp&&Number(N.expirationTimestamp)<u)){e.Rl(5);break}N.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";N.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.S(e,GM(Z,N,"offlineVideoPolicy"),5);
case 5:q=y.next();e.Rl(4);break;case 6:return e.return(G.map(function(h){return h.key}))}})},O$J=function(){CX.apply(this,arguments)},Ahw=function(){CX.apply(this,arguments)},zjR=function(Z,u){var G=Z.j.objectStore("EntityAssociationStore");
return G.index("byParentEntityKey").getAll(IDBKeyRange.only(u)).then(function(y){var q=[];y=g.m(y);for(var N=y.next();!N.done;N=y.next())N=N.value,q.push(G.index("byChildEntityKey").getAll(N.childEntityKey));return g.nB.all(q)}).then(function(y){var q=[];
y=g.m(y);for(var N=y.next();!N.done;N=y.next())N=N.value,N.length===1&&q.push(N[0].childEntityKey);return q})},LTH=function(){CX.apply(this,arguments)},sYe=function(Z,u,G){var y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L;
return g.A(function(Q){y=[];q=new Set;if((N=G)==null?0:(e=N.downloadedTracks)==null?0:e.length)for(h=g.m(G.downloadedTracks),d=h.next();!d.done;d=h.next())K=d.value,q.add(K);if(Z.tracks){f=g.m(Z.tracks);for(V=f.next();!V.done;V=f.next())X=V.value,q.has(X)||y.push(X);n=g.m(u);for(l=n.next();!l.done;l=n.next())if(Y=l.value,Y.id!==Z.id&&(E=Y.tracks))for(W=g.m(E),p=W.next();!p.done;p=W.next())z=p.value,L=y.indexOf(z),L!==-1&&y.splice(L,1)}return Q.return(y)})},Rje=function(Z){var u;
return g.A(function(G){return G.j==1?g.S(G,QO(),2):(u=G.U)?g.S(G,wq(u,"readwrite",function(y){for(var q={},N=g.m(Z),e=N.next(),h={};!e.done;h={CG:void 0,U9:void 0},e=N.next())h.CG=e.value,h.CG.entityKey&&vl4(h.CG)&&(h.U9=g.fl(h.CG.payload),e=void 0,h.CG.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(e=function(d){return function(){return TL(y,d.CG.payload[d.U9],d.U9)}}(h)),h.CG.type==="ENTITY_MUTATION_TYPE_DELETE"&&(e=function(d){return function(){return Iz(y,d.CG.entityKey)}}(h)),h.CG.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(e=function(d){return function(){return Sus(y,d.CG.entityKey,d.CG.payload[d.U9],d.U9)}}(h)),e&&(q[h.CG.entityKey]=q[h.CG.entityKey]?q[h.CG.entityKey].then(e):e()));
return g.nB.all(Object.values(q))}),0):G.return()})},Pbe=function(){this.j={};
this.j[0]=new yC;if(!g.XQ("aes_pes_encoder_killswitch")){var Z=this.j;try{var u=g.UG();var G=Cba(u);var y=new iR(new g.WP(G),new g.vg(G))}catch(q){throw Z=q instanceof Error?new az("KEY_CREATION_FAILED",{originalMessage:q.message}):new az("KEY_CREATION_FAILED"),g.SE(Z),Z;}Z[1]=y}},QYd=function(Z){var u;
return g.A(function(G){u=g.C(Z.frameworkUpdates,q8);return Z.frameworkUpdates&&u?g.S(G,oli(u),0):G.return()})},chJ=function(Z,u){var G,y,q,N;
return g.A(function(e){if(e.j==1){G=u.clientPlaybackNonce;y={cpn:G,offlineSourceVisualElement:g.Jn(u.Qn||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};u.U&&(y.videoFmt=Number(u.U.itag));u.D&&(y.audioFmt=Number(u.D.itag));if((q=FTa(u))&&u.videoId){var h=u.videoId;h=q!=="PPSV"?Promise.resolve(!1):Z.j.Mf(h);e=g.S(e,h,3)}else e=e.Rl(2);return e}e.j!=2&&(N=e.U)&&(y.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");Z.U=G;g.Kl("offlinePlaybackStarted",y);g.pA(e)})},glk=function(Z,
u){var G,y;
return g.A(function(q){switch(q.j){case 1:return G=$w(u),g.QS(q,2),y=g.ZE(u.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?g.S(q,Z4(Z.j,u,Z.T),5):g.S(q,N8(y,"musicAlbumRelease",Z.j,u,Z.T),6);case 6:return g.S(q,BcR(Z.j,u.entityKey),5);case 5:g.u8(q,3);break;case 2:return g.Ts(q),q.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},wxP=function(Z,u){var G,y,q,N,e,h;
return g.A(function(d){switch(d.j){case 1:G=new Map,y=g.m(u),q=y.next();case 2:if(q.done){d.Rl(4);break}N=q.value;e=G;h=e.set;return g.S(d,Z.U(N),5);case 5:h.call(e,N,d.U);q=y.next();d.Rl(2);break;case 4:return d.return(G)}})},wCJ=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z;
return g.A(function(L){if(L.j==1)return G=g.hq("main_downloads_library_id","mainDownloadsLibraryEntity"),y=g.hq("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.S(L,wq(Z,{mode:"readonly",SK:!0},function(Q){return g.nB.all([bR(Q,G,"mainDownloadsLibraryEntity"),bR(Q,y,"mainDownloadsListEntity")])}),2);
q=L.U;N=g.m(q);e=N.next().value;h=N.next().value;d=e;K=h;d||(d={id:G});f=g.m(u);for(V=f.next();!V.done;V=f.next())if(X=V.value,X===g.Sk){if(d.smartDownloadsList)return L.return();d.smartDownloadsList=X}else if(n=g.ZE(X).entityType,l={},n==="mainPlaylistEntity"?l.playlistItem=X:n==="mainVideoEntity"&&(l.videoItem=X),!g.fV(l)){Y=void 0;if((Y=K)==null?0:Y.downloads){E=!1;W=g.m(K.downloads);for(p=W.next();!p.done;p=W.next())if(z=p.value,z.playlistItem===X||z.videoItem===X){E=!0;break}E||K.downloads.push(l)}else K=
{id:y,downloads:[l]};d.downloadsList=y}return L.return({mainDownloadsLibraryEntity:d,mainDownloadsListEntity:K})})},TcJ=function(){CX.apply(this,arguments)},eH=function(Z,u){Z.api.ET("woffle",{mcte:u});
FE("missing current transfer entity.")},aPJ=function(){CX.apply(this,arguments)},b$v=function(Z,u){var G,y;
return g.A(function(q){if(q.j==1)return g.S(q,g.Xs(),2);if(q.j!=3){G=q.U;if(!G)throw g.ip("wct");return g.S(q,g.V$(G),3)}y=q.U;return g.S(q,g.Hq(y,["captions"],{mode:"readwrite",SK:!0},function(N){var e=[];N=N.objectStore("captions");for(var h=0;h<u.length;h++){var d=g.cA(N,u[h],Z+"|"+u[h].metadata.vss_id);e.push(d)}return g.nB.all(e)}),0)})},uM=function(Z,u,G,y,q){var N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv;
return g.A(function(x9){switch(x9.j){case 1:return N=g.hq(Z,"musicTrack"),e=g.hq(Z,"transfer"),g.S(x9,wq(u,{mode:"readonly",SK:!0},function(qS){return g.nB.all([bR(qS,N,"musicTrack"),bR(qS,e,"transfer"),xD(qS,"musicTrack"),xD(qS,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=x9.U;d=g.m(h);K=d.next().value;f=d.next().value;V=d.next().value;X=d.next().value;n=K;l=f;Y=V;E=X;if(!n){x9.Rl(3);break}return g.S(x9,IPe(n,Y),4);case 4:return W=x9.U,g.S(x9,hV(W),3);case 3:p=[];z=g.m(E);for(L=z.next();!L.done;L=z.next())Q=L.value,b=g.ZE(Q.key).entityId,w=dN(Q),yv=g.ZE(w.action.entityKey).entityId,b!==Z&&yv!==Z||KF(G,Q.actionProto)||p.push(Q.key);return g.S(x9,wq(u,{mode:"readwrite",SK:!0},function(qS){var K7=p.map(function(GR){return Iz(qS,GR)});
K7.push(Iz(qS,N,{uD:!0}));return g.nB.all(K7)}),6);
case 6:fF(l),q&&VC(q),X9(y,{entityKey:N,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.pA(x9)}})},i$i=function(Z){var u,G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W;
return g.A(function(p){switch(p.j){case 1:if(Z.D)throw Error("Already processing an action");if(Z.Bu())return p.return();u=Z.j.actions.shift();$oa(Z.Qn,!u);if(u===void 0)return p.return();u.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&u.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&rhd(Z.j,u.actionId);G="";u.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&u.rootActionId===u.actionId&&(G=u.actionId);y=[u];Z.D=y;if(q=Z.xx[u.entityType]){p.Rl(2);break}Z.D=
void 0;return g.S(p,i$i(Z),3);case 3:return p.return();case 2:N=g.m(y);for(e=N.next();!e.done;e=N.next())h=e.value,kzJ(h,2);g.QS(p,4,5);return g.S(p,wxP(q,y.map(function(z){return z.action})),7);
case 7:d=p.U,K=g.m(y),f=K.next();case 8:if(f.done){p.Rl(10);break}V=f.value;X=d.get(V.action);return g.S(p,Z8R(Z,V,X),9);case 9:f=K.next();p.Rl(8);break;case 10:rhd(Z.j,G);case 5:g.ug(p);Z.D=void 0;g.Gr(p,6);break;case 4:return n=g.Ts(p),FE("Orchestration error",n),g.QS(p,12),g.S(p,upe(Z,y),14);case 14:g.u8(p,5);break;case 12:l=g.Ts(p);FE("Orchestration retry error",l);Y=g.m(y);for(E=Y.next();!E.done;E=Y.next())W=E.value,W.retryScheduleIndex<3&&GKa(Z.j,[W]);p.Rl(5);break;case 6:return g.S(p,i$i(Z),
0)}})},yoa=function(){CX.apply(this,arguments)},eAP=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l;
return g.A(function(Y){switch(Y.j){case 1:return G=$w(u),y=g.ZE(u.entityKey),q=y.entityId,N=g.C(u.actionMetadata,nF),h=!((e=N)==null?0:e.playlistId),g.QS(Y,2),g.S(Y,qPJ(Z,q,void 0,(d=N)==null?void 0:d.offlineVideoData,h),4);case 4:g.u8(Y,3);break;case 2:return K=g.Ts(Y),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.h1&&K.type==="QUOTA_EXCEEDED"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Y.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,f,V));case 3:X=1;X=Number(((n=u.actionMetadata)==null?void 0:n.priority)||0)+1;var E=(E=g.C(u.actionMetadata,nF))?{playbackDataActionMetadata:{maximumDownloadQuality:E.maximumDownloadQuality}}:void 0;l=lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q,"playbackData",X,N0i,E);return Y.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,[l]))}})},xXv=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X;
return g.A(function(n){if(n.j==1)return G=[],g.S(n,wq(Z.j,{mode:"readonly",SK:!0},function(l){var Y=[],E=u.offlineVideoStreams;if(E){E=g.m(E);for(var W=E.next();!W.done;W=E.next())Y.push(bR(l,W.value,"offlineVideoStreams"))}return g.nB.all(Y)}),2);
if(y=n.U)for(q=g.m(y),N=q.next();!N.done;N=q.next())if(e=N.value,h=void 0,(h=e)==null?0:h.streamsProgress)for(d=e.streamsProgress,K=0;K<d.length;K++)f=d[K],V=JSON.parse(f.formatStreamBytes),X={itag:V.itag,lmt:V.lastModified,xtags:V.xtags},G.push(X);return n.return(G)})},hAJ=function(){CX.apply(this,arguments)},GM=function(Z,u,G){return wq(Z,{mode:"readwrite",
SK:!0},function(y){return TL(y,u,G)})},fzv=function(Z,u,G,y){var q,N,e;
return g.A(function(h){switch(h.j){case 1:return g.S(h,dXd([u]),2);case 2:return q=h.U,g.S(h,Kgs(Z,q[0],G,y),3);case 3:return N=h.U,e=D4(N.thumbnailDetails),g.S(h,M8(e),4);case 4:return h.return(q[0].videos)}})},Vpv=function(Z,u){this.j=Z;
this.T=u},XQs=function(){CX.apply(this,arguments)},n4a=function(Z){return Z instanceof Error?new az("UNKNOWN_DECODE_ERROR",{originalMessage:Z.message}):new az("UNKNOWN_DECODE_ERROR")},lzH=function(){CX.apply(this,arguments)},DXe=function(Z){Z=Z*1E3-Date.now();
return Z>4E3?4E3:Z},Mpv=function(Z,u,G,y){y={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!y};u&&G&&(u=Math.floor(u/1024).toFixed(),G=Math.floor(G/1024).toFixed(),y.alreadyDownloadedKbytes=u,y.totalFetchedKbytes=u,y.totalContentKbytes=G);mF(y,Z)},pCH=function(Z){return Z!==void 0},mXH=function(){CX.apply(this,arguments)},YPd=function(){CX.apply(this,arguments)},mF=function(Z,u){var G=u.videoId;
var y=u.wJ;u=u.offlineModeType;Z.encryptedVideoId=G;Z.cotn=y==null?void 0:y.cotn;Z.offlineabilityFormatType=y==null?void 0:y.maximumDownloadQuality;var q;Z.isRefresh=(q=y==null?void 0:y.isRefresh)!=null?q:!1;var N;Z.softErrorCount=(N=y==null?void 0:y.transferRetryCount)!=null?N:0;Z.offlineModeType=u!=null?u:"OFFLINE_NOW";(Z.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&Z.statusType==="UNKNOWN_STATUS_TYPE"||!Z.transferStatusType&&!Z.statusType)&&g.h6(Error("Woffle unknown transfer status"));
g.Kl("offlineTransferStatusChanged",Z)},E4H=function(Z){var u;
return g.A(function(G){if(G.j==1)return g.S(G,PH(Z.U,"offlineOrchestrationActionWrapperEntity"),2);u=G.U;return g.S(G,JoR(Z,u),0)})},UXP=function(Z,u){this.j=Z;
this.W=u},kzJ=function(Z,u){var G={offlineOrchestrationContext:pQw(Z)};
u=Gzk(u,G);H84(B0w(),u,Z.rootActionId)},tpH=function(Z){return Z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!Z.entityKey},Wge=function(){return g.A(function(Z){if(YD!==void 0)return Z.return(YD);
YD=new Promise(function(u){var G;return g.A(function(y){switch(y.j){case 1:return g.QS(y,2),g.S(y,JV.open("test-only"),4);case 4:return g.S(y,JV.delete("test-only"),5);case 5:g.u8(y,3);break;case 2:if(G=g.Ts(y),G instanceof Error&&G.name==="SecurityError")return u(!1),y.return();case 3:u("caches"in window),g.pA(y)}})});
return Z.return(YD)})},Es=function(Z,u,G){u={track:jbe(u)};
G&&(u.playlistId=G);if(Z=g.C(Z.actionMetadata,O8d))u.maximumDownloadQuality=Z.maximumDownloadQuality;return{musicTrackEntityActionMetadata:u}},t6v=function(){try{var Z=g.bb("ytglobal.locks_");
if(Z)return Z;var u;if(u=navigator){var G=navigator;u="locks"in G&&!!G.locks}if(u)return g.nh.localStorage&&g.nh.localStorage.getItem("noop"),Z=new Aoa,g.Vk("ytglobal.locks_",Z),Z}catch(y){}},zAe=function(){CX.apply(this,arguments)},pF=function(Z,u){var G=this;
this.W=Z;this.api=u;this.X=new g.dn;this.G=new g.JN;this.Wy={lf:function(){return G.T.Wy.lf()},
W1:function(){return G.X},
wmH:function(){return G.T},
KL:function(){return G.KL()},
Dh:function(){return G.Dh()},
u6:function(){return G.u6()},
S3:function(){return G.S3()},
M8:function(){return G.M8()},
n3:function(y){return G.n3(y)}};
this.T=new Lgi(function(){return sb4(G)},function(){G.u6()},this.api.Ox(),this.api.S.bind(this.api));
this.j=new Us(this.api);Wrk(this.T)},v4s=function(Z){return{context:g.GF(),
playlistIds:Z}},Hi=function(Z){return Z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!Z.entityKey},SPd=function(){CX.apply(this,arguments)},RAi=function(){CX.apply(this,arguments)},tV=function(Z,u){var G,y,q;
return g.A(function(N){if(N.j==1)return g.S(N,Bi(Z.U,g.hq(u,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);G=N.U;return N.return((q=(y=G)==null?void 0:y.offlineModeType)!=null?q:void 0)})},Cxd=function(Z){var u=new g.bC("und",new g.fe("Default","und",!0));
u.captionTracks=Z.captionTracks;return u},o4i=function(Z){var u,G,y,q;
g.A(function(N){switch(N.j){case 1:if(!Z.j){eH(Z,"onTransferPausedByUser");N.Rl(2);break}u=Z.j;Z.D.stop();return g.S(N,Wi(Z,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:y=((G=u)==null?0:G.key)?g.ZE(u.key).entityId:"";if(!y||!Z.T){N.Rl(4);break}return g.S(N,kw(y,Z.T,Z.U,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.S(N,tV(Z,y),6);case 6:q=N.U,Pxi({videoId:y,wJ:u,offlineModeType:q});case 2:jH(Z),Os(Z),g.pA(N)}})},Z4=function(Z,u,G){var y,q,N,e,h,d,K;
return g.A(function(f){if(f.j==1)return g.S(f,wq(Z,{mode:"readwrite",SK:!0},function(V){var X=xD(V,"transfer"),n=xD(V,"offlineOrchestrationActionWrapperEntity");return g.nB.all([X,n]).then(function(l){l=g.m(l);var Y=l.next().value;var E=l.next().value;l=Qbi.map(function(L){return FgH(V,L)});
E=g.m(E);for(var W=E.next();!W.done;W=E.next()){W=W.value;var p=g.ZE(W.actionProto.entityKey).entityType==="musicTrack",z=W.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";KF(u,W.actionProto)||p&&(!p||z)||l.push(Iz(V,W.key,{uD:!0}))}return g.nB.all(l).then(function(){return Y})})}),2);
y=f.U;q=g.m(y);for(N=q.next();!N.done;N=q.next())e=N.value,fF(e),h=g.ZE(e.key).entityId,d={videoId:h,offlineDeleteReason:void 0,cotn:e.cotn},VC(d),K=g.hq(h,"musicTrack"),X9(G,{entityKey:K,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.S(f,coP(),0)})},g4w=function(Z,u){this.api=Z;
this.j=u;this.logger=new g.ab("woffle");this.U=!1;this.Wy={GO:this.GO}},cH=function(Z){var u;
return(u=Z.errorMetadata)==null?void 0:u.status},wQ4=function(){CX.apply(this,arguments)},IzH=function(Z,u,G){var y=T0e(u);
return azv(Z,y).then(function(){return b8H(Z,u,G)})},$XR=function(Z,u){var G;
return g.A(function(y){if(y.j==1)return g.S(y,PH(Z.U,"offlineOrchestrationActionWrapperEntity",u),2);G=y.U;return y.return(G.filter(pCH))})},ro4=function(){oz.apply(this,arguments)},AV=function(Z,u,G,y,q,N,e,h,d,K,f){this.entityType=Z;
this.actionId=u;this.action=G;this.parentActionId=y;this.rootActionId=q===void 0?u:q;this.childActionIds=N;this.prereqActionId=e;this.postreqActionIds=h;this.hasChildActionFailed=K;this.retryScheduleIndex=0;this.j=f||Date.now();this.retryScheduleIndex=d||0},Cba=function(Z){Z=(new TextEncoder).encode(Z).subarray(0,16);
var u=new Uint8Array(16);u.set(Z);return u},kKs=function(Z){var u;
return g.A(function(G){if(G.j==1)return g.S(G,i8e(Z),2);u=G.U;g.Kl("offlineStateSnapshot",u);g.pA(G)})},ZlJ=function(){},eji=function(Z){mF({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},Z)},M8=function(Z){var u,G;
return g.A(function(y){if(y.j==1)return g.S(y,uNH(),2);if(y.j!=3){u=y.U;if(!u)throw Error("Cache API not supported");return Z.length?g.S(y,u.open("yt-player-local-img"),3):y.return()}G=y.U;return g.S(y,G.addAll(Z),0)})},Pxi=function(Z){mF({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},Z)},zM=function(Z,u){var G=g.Fv(u);
if(G===1||G===0)return Promise.resolve();(G=Gee(Z,u))&&G.stopVideo();Z.T=0;return Hee(u)},yXd=function(){CX.apply(this,arguments)},ete=function(Z,u,G){u=u===void 0?43200:u;
G=G===void 0?!0:G;var y=y===void 0?!1:y;var q,N;return g.A(function(e){switch(e.j){case 1:if(!Z.X.DK())return e.return([]);q=[];g.QS(e,2);return g.S(e,q0H(u,G,y),4);case 4:q=e.U;g.u8(e,3);break;case 2:g.Ts(e);case 3:return N=NPe(Z,q,G,"musicPlaylist"),e.return(N)}})},gq=function(Z,u){u=u?" for "+u:"";
if(Z===0)throw Z="Empty response body"+u,FE(Z),Error(Z);Z="Response with error"+u;FE(Z);throw Error(Z);},RcJ=function(Z){var u;
return g.A(function(G){switch(G.j){case 1:if(!Z.U)return FE("transferManager is undefined"),G.return();if(Z.U.j){G.Rl(2);break}return g.S(G,Os(Z.U),2);case 2:if(!Z.W.S("woffle_enable_main_downloads_library")){G.Rl(4);break}return g.S(G,Z.WG(),4);case 4:if(!Z.W.S("html5_offline_playback_position_sync")){G.Rl(6);break}return g.S(G,Z.El(),7);case 7:return g.S(G,Z.n3(864E5),6);case 6:return g.S(G,Z.refreshAllStaleEntities(43200,!0),9);case 9:return g.S(G,Z.o7(),10);case 10:if(!Z.W.S("html5_retry_downloads_for_expiration")){G.Rl(11);
break}return g.S(G,Z.M8(),11);case 11:return Z.C=g.AR(function(){Z.refreshAllStaleEntities(43200,!0);Z.o7()},9E5),g.EH(g.B2(),function(){return Z.S3()}),g.S(G,QO(),13);
case 13:return u=G.U,g.S(G,kKs(u),14);case 14:xCs(Z.T),g.pA(G)}})},htJ=function(){CX.apply(this,arguments)},dCv=function(){CX.apply(this,arguments)},Vja=function(Z,u,G){try{return Z.T(u,G)}catch(y){KQe(y,ftP)}},PH=function(Z,u,G){return wq(Z,{mode:"readonly",
SK:!0},function(y){return xD(y,u,G)})},DCk=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W;
return g.A(function(p){switch(p.j){case 1:return G=$w(u),y=g.ZE(u.entityKey),q=y.entityId,N=[],g.QS(p,2),g.S(p,Xye(Z,q),4);case 4:N=p.U;if((e=N)==null||!e.length){p.Rl(5);break}return g.S(p,nuR(Z.j,u.entityKey),5);case 5:g.u8(p,3);break;case 2:return h=g.Ts(p),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.h1&&h.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
p.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,d,K));case 3:return f=[],g.S(p,ltH(Z.j,"musicTrack",N),7);case 7:N=p.U;if(N.length)for(V=g.m(N),X=V.next();!X.done;X=V.next())if(n=X.value,l=n.offlineVideoData,Y=void 0,(Y=l)==null?0:Y.videoId)E=void 0,W=Number(((E=u.actionMetadata)==null?void 0:E.priority)||0)+1,f.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",l.videoId,"musicTrack",W,LF,Es(u,l,q)));return p.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,f))}})},
vi=function(Z,u,G){var y=Z.T[G];
y||(y=new Set,Z.T[G]=y);y.add(u)},mCJ=function(Z,u){var G;
return g.A(function(y){return u.length?(G=MjP(),g.qi(G,SH,{isEnqueuedForExpiredStreamUrlRefetch:!0}),Z.api.ET("qrd",{v:u.length}),y.return(RK(Z,u,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G))):y.return([])})},JXi=function(Z){var u;
return g.A(function(G){if(G.j==1)return g.S(G,Y0e(Z),2);u=G.U;return G.return(!!u&&u.length>0)})},Eua=function(Z,u,G){var y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv,x9;
return g.A(function(qS){y=[];q=new Set;if(G.length)for(N=g.m(G),e=N.next();!e.done;e=N.next())if(h=e.value,d=void 0,(d=h.downloads)==null?0:d.length)for(K=g.m(h.downloads),f=K.next();!f.done;f=K.next())V=f.value,V.videoItem&&(X=g.ZE(V.videoItem).entityId,q.add(X));if(Z.videos){n=g.m(Z.videos);for(l=n.next();!l.done;l=n.next())Y=l.value,E=JSON.parse(g.ZE(Y).entityId),E.videoId&&!q.has(E.videoId)&&y.push(E.videoId);W=g.m(u);for(p=W.next();!p.done;p=W.next())if(z=p.value,z.key!==Z.key&&(L=z.videos))for(Q=
g.m(L),b=Q.next();!b.done;b=Q.next())w=b.value,yv=JSON.parse(g.ZE(w).entityId),yv.videoId&&(x9=y.indexOf(yv.videoId),x9!==-1&&y.splice(x9,1))}return qS.return(y)})},UCa=function(){CX.apply(this,arguments)},Yuk=function(Z,u){var G=pya[Z.transferState],y=pya[u.transferState];
return G!==y?G-y:Number(Z.enqueuedTimestampMs)-Number(u.enqueuedTimestampMs)},Hlv=function(){CX.apply(this,arguments)},FgH=function(Z,u){return g.Vf(Z.j.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(u)},function(G){return g.nB.all([G.delete(),
azv(Z,G.cursor.primaryKey)]).then(function(){vi(Z,G.cursor.primaryKey,u);return g.Wq(G)})})},BPi=function(){CX.apply(this,arguments)},tje=function(){this.j=new Map},fPd=function(Z,u,G,y){var q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv,x9,qS,K7,GR,ED,oq,H,GH,L7,Rq,Qw,si,zH,Z6,av,dt,je,U,ZY,J6,xf,bo,KA,iF,ZR,t6,t,J,B;
return g.A(function(v){switch(v.j){case 1:return q=g.hq(Z,"mainPlaylistEntity"),N=g.hq(Z,"ytMainChannelEntity"),g.S(v,wq(u,{mode:"readonly",SK:!0},function(a){return g.nB.all([bR(a,q,"mainPlaylistEntity"),bR(a,N,"ytMainChannelEntity"),xD(a,"mainPlaylistEntity"),xD(a,"mainDownloadsListEntity"),xD(a,"ytMainChannelEntity"),xD(a,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:e=v.U;h=g.m(e);d=h.next().value;K=h.next().value;f=h.next().value;V=h.next().value;X=h.next().value;n=h.next().value;l=d;Y=K;E=f;W=V;p=X;z=n;if(!l&&!Y){v.Rl(3);break}L=l?WQR(l):[];if(!Y){Q=[];v.Rl(4);break}return g.S(v,j6s(Y,p),5);case 5:Q=v.U;case 4:return b=Q,g.S(v,hV(L.concat(b)),3);case 3:w=[];yv=new Map;if(!l){v.Rl(7);break}return g.S(v,Eua(l,E,W),8);case 8:w=v.U;x9=g.m(w);for(qS=x9.next();!qS.done;qS=x9.next())K7=qS.value,yv.set(K7,{videoId:K7,playlistId:Z,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.S(v,wq(u,{mode:"readonly",SK:!0},function(a){return g.nB.all([xD(a,"transfer"),xD(a,"videoDownloadContextEntity")])}),9);
case 9:GR=v.U;ED=g.m(GR);oq=ED.next().value;H=ED.next().value;GH=oq;L7=H;Rq=g.m(GH);for(Qw=Rq.next();!Qw.done;Qw=Rq.next())si=Qw.value,zH=g.ZE(si.key).entityId,(Z6=yv.get(zH))&&si&&(Z6.cotn=si.cotn);av=g.m(L7);for(dt=av.next();!dt.done;dt=av.next())je=dt.value,U=g.ZE(je.key).entityId,(ZY=yv.get(U))&&je&&(ZY.offlineModeType=je.offlineModeType);case 7:J6=[];xf=g.m(z);for(bo=xf.next();!bo.done;bo=xf.next())KA=bo.value,iF=g.ZE(KA.key).entityId,ZR=dN(KA),iF!==Z&&ZR.rootActionId!==Z||KF(G,KA.actionProto)||
J6.push(KA.key);t6=g.hq(Z,"mainPlaylistEntity");return g.S(v,wq(u,{mode:"readwrite",SK:!0},function(a){var hG=J6.map(function(r){return Iz(a,r)});
hG.push(Iz(a,t6,{uD:!0}));return g.nB.all(hG)}),10);
case 10:if(!l){v.Rl(0);break}w.reverse();if(!w){v.Rl(0);break}t=g.m(w);J=t.next();case 13:if(J.done){v.Rl(0);break}B=J.value;return g.S(v,CF(B,u,G,y,yv.get(B)),14);case 14:J=t.next(),v.Rl(13)}})},Old=function(Z){var u,G,y;
return g.A(function(q){if(q.j==1)return Z?g.S(q,Bi(Z,g.Sk,"mainDownloadsListEntity"),2):q.return([]);u=q.U;return((G=u)==null?0:(y=G.downloads)==null?0:y.length)?q.return(u.downloads.map(function(N){var e;return(e=N.videoItem)!=null?e:""})):q.return([])})},AXs=function(Z){return wq(Z,{mode:"readwrite",
SK:!0},function(u){return FgH(u,"videoPlaybackPositionEntity")})},zts=function(){CX.apply(this,arguments)},LQe=function(){CX.apply(this,arguments)},Iz=function(Z,u,G){if(G==null?0:G.uD){var y=new Set;
return s6e(Z,u,y).then(function(){for(var N=[],e=g.m(y),h=e.next();!h.done;h=e.next())N.push(Iz(Z,h.value));return g.nB.all(N).then(function(){})})}var q=g.ZE(u).entityType;
return g.nB.all([Z.j.objectStore("EntityStore").delete(u),azv(Z,u)]).then(function(){vi(Z,u,q)})},Pi=function(Z){return{key:g.hq(Z.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:Z.action,parentActionId:Z.parentActionId,rootActionId:Z.rootActionId,childActionIds:Z.childActionIds,prereqActionId:Z.prereqActionId,postreqActionIds:Z.postreqActionIds,retryScheduleIndex:Z.retryScheduleIndex,hasChildActionFailed:Z.hasChildActionFailed,enqueueTimeSec:(Z.j/1E3).toFixed()}},vud=function(){CX.apply(this,arguments)},oK=function(Z,u){g.O.call(this);
this.token=Z;this.j=u;this.observers=[];Z=new g.nh.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.UG());Z.onmessage=this.U.bind(this);this.channel=Z},Rtk=function(Z,u){var G,y,q,N,e,h,d,K,f,V;
return g.A(function(X){switch(X.j){case 1:return G=g.Mt(),g.S(X,QO(),2);case 2:y=X.U;if(!y){X.Rl(3);break}return g.S(X,i8e(y),4);case 4:q=X.U;case 3:var n=q;N={context:g.GF(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:Z},offlineClientState:n,clientStateRequestData:{preferredFormatType:u}}}};e=g.dW(S0i);g.QS(X,5);d={aL:!0};return g.S(X,g.KI(G,N,e,void 0,d),7);case 7:h=X.U;g.u8(X,6);break;case 5:K=g.Ts(X);if(K instanceof g.u$)throw f=
"DPS network manager error for smart downloads: "+K.message,FE(f,K),Error(f);FE("DPS fetch request error for smart downloads",K);throw Error("DPS fetch request error for smart downloads");case 6:V=cH(h);if(h)V!==void 0&&gq(V,"smart downloads");else throw FE("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return X.return(h)}})},Us=function(Z){g.O.call(this);
var u=this;this.api=Z;this.Wy={fxn:function(){return u.j},
CoT:function(){return u.U}};
typeof g.nh.BroadcastChannel!=="undefined"&&(this.j=new g.nh.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.UG()),this.j.onmessage=this.T.bind(this),this.U=new g.nh.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.UG()),this.U.onmessage=this.D.bind(this))},QC=function(Z){Z.K&&Z.X&&Z.G&&Z.visibility.isBackground()?g.Rg(Z.D,6E4):Z.D.stop()},CKe=function(Z,u,G){u=u.map(function(y){return TL(Z,y,G)});
return g.nB.all(u)},Bi=function(Z,u,G){return wq(Z,{mode:"readonly",
SK:!0},function(y){return bR(y,u,G)})},oue=function(Z,u){var G,y,q;
return g.A(function(N){switch(N.j){case 1:G=$w(u);g.QS(N,2);y=g.ZE(u.entityKey).entityId;if(y==="!*$_ALL_ENTITIES_!*$")return g.S(N,AXs(Z.j),5);q=g.hq(y,"videoPlaybackPositionEntity");return g.S(N,PKe(Z.j,q),5);case 5:g.u8(N,3);break;case 2:return g.Ts(N),N.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},Q6i=function(Z,u){this.j=Z;
this.W=u},FQH=function(){CX.apply(this,arguments)},ItJ=function(Z,u){var G,y,q,N,e,h;
return g.A(function(d){switch(d.j){case 1:if(Z.C)return d.return();Z.C=!0;Z.j=u;G=g.ZE(Z.j.key);y=G.entityId;q=void 0;if(Z.j.transferState==="TRANSFER_STATE_TRANSFERRING")return g.S(d,tV(Z,y),7);if(Z.j.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||Z.j.transferRetryCount||Z.j.hasLoggedFirstStarted){d.Rl(3);break}return g.S(d,tV(Z,y),5);case 5:return q=d.U,Z.j.hasLoggedFirstStarted=!0,g.S(d,cXv(Z),6);case 6:Mpv({videoId:y,wJ:Z.j,offlineModeType:q},void 0,void 0,!0);d.Rl(3);break;case 7:q=d.U,
mF({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:y,wJ:Z.j,offlineModeType:q});case 3:return g.S(d,guv(Z),8);case 8:return N=null,g.QS(d,9),g.S(d,wyk(Z,u),11);case 11:N=d.U;Z.G=N;g.u8(d,10);break;case 9:return e=g.Ts(d),FE("error getting player response",e,u.cotn),g.S(d,Z.p$("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return d.return();case 10:return h=TPe(Z.api.J(),u.cotn,N),g.S(d,ata(Z,h),13);case 13:return g.S(d,blP(h.videoId),
14);case 14:h.iJ=d.U;var K=Z.K,f=h,V=u.maximumDownloadQuality;f.getPlayerResponse();g.M0(f.videoId,2);K.T=2;K.U=!1;var X;(X=K.player)==null||X.dispose();K.player=K.api.E4(f);f={};K.player.nY((f.localmediachange=K.C$,f.signatureexpired=K.jg,f.statechange=K.hPn,f),K);K.S("html5_generate_content_po_token")&&K.player.Ya();V=K.GO(V);K.player.P6(g.k6(V,V,!0,"m"),!1);K.player.CD(!1);Z.D.start(108E5);g.pA(d)}})},guv=function(Z){var u,G,y;
return g.A(function(q){if(q.j==1){if(!Z.j)return eH(Z,"onTransferStart"),q.return();Z.D.start(108E5);return g.S(q,Wi(Z,"TRANSFER_STATE_TRANSFERRING"),2)}u=Z.j;return(y=((G=u)==null?0:G.key)?g.ZE(u.key).entityId:"")&&Z.T?g.S(q,kw(y,Z.T,Z.U,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):q.Rl(0)})},$CJ=function(){CX.apply(this,arguments)},QO=function(){rXv||(rXv=ilJ());
return rXv},u4H=function(){CX.apply(this,arguments)},Nee=function(Z,u,G,y){y=y===void 0?!1:y;
var q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p;return g.A(function(z){switch(z.j){case 1:return q=[],g.S(z,GpH(),2);case 2:return(N=z.U)||y?g.S(z,yuJ(u,G),3):z.return([]);case 3:e=z.U;if((h=e)==null||!h.length)return z.return([]);d={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};K=g.m(e);f=K.next();case 4:if(f.done){z.Rl(6);break}X=V=f.value;n=X.actionType;l=X.entityKey;Y=X.actionMetadata;if(!(n&&l&&Y)||g.C(Y,qFJ)){z.Rl(5);break}n==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Y.offlineLoggingData=
d);E=g.ZE(l);W=E.entityId;return g.S(z,RK(Z,[W],"mainVideoEntity",n,Y),8);case 8:p=z.U,q=q.concat(p);case 5:f=K.next();z.Rl(4);break;case 6:return z.return(q)}})},eyw=function(Z){var u=g.Gd();
u=Object.assign({},u);Z=Object.assign({},Z);for(var G in u)Z[G]?(u[G]!==4&&(u[G]=Z[G]),delete Z[G]):u[G]!==2&&(u[G]=4);Object.assign(u,Z);g.ZKS(u);JSON.stringify(u);return u},x$P=function(){CX.apply(this,arguments)},D4=function(Z){if(!Z||!Z.thumbnails)return[];
var u=[];Z=g.m(Z.thumbnails);for(var G=Z.next();!G.done;G=Z.next())G=G.value,G.url&&u.push(G.url);return u},hyJ=function(){CX.apply(this,arguments)},d$i=function(){CX.apply(this,arguments)},KSR=function(){CX.apply(this,arguments)},VcR=function(Z,u){var G,y,q,N,e,h,d,K;
return g.A(function(f){switch(f.j){case 1:return G=g.Mt(),y={context:g.GF(),videoPlaybackPositionEntities:Z,lastSyncTimestampUsec:u},q=g.dW(fxk),g.QS(f,2),e={aL:!0},g.S(f,g.KI(G,y,q,void 0,e),4);case 4:N=f.U;g.u8(f,3);break;case 2:h=g.Ts(f);if(h instanceof g.u$)throw d="VPPS network manager error: "+h.message,FE(d,h),Error(d);FE("VPPS fetch request error",h);throw Error("VPPS fetch request error");case 3:K=cH(N);if(N)K!==void 0&&gq(K,"position sync");else throw FE("Network request failed for position sync"),
Error("Network request failed for position sync");return f.return(N)}})},CF=function(Z,u,G,y,q){var N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv,x9,qS,K7,GR,ED,oq,H,GH,L7,Rq,Qw;
return g.A(function(si){switch(si.j){case 1:return N=g.hq(Z,"mainVideoEntity"),e=g.hq(Z,"ytMainChannelEntity"),h=g.hq(Z,"transfer"),d=g.hq(Z,"videoDownloadContextEntity"),g.S(si,wq(u,{mode:"readonly",SK:!0},function(zH){return g.nB.all([bR(zH,N,"mainVideoEntity"),bR(zH,e,"ytMainChannelEntity"),bR(zH,h,"transfer"),bR(zH,d,"videoDownloadContextEntity"),xD(zH,"ytMainChannelEntity"),xD(zH,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:K=si.U;f=g.m(K);V=f.next().value;X=f.next().value;n=f.next().value;l=f.next().value;Y=f.next().value;E=f.next().value;W=V;p=X;z=n;L=l;Q=Y;b=E;if(!W&&!p){si.Rl(3);break}w=W?D4(W.thumbnail):[];if(!p){yv=[];si.Rl(4);break}return g.S(si,j6s(p,Q),5);case 5:yv=si.U;case 4:return x9=yv,g.S(si,hV(w.concat(x9)),3);case 3:qS=[];K7=g.hq(Z,"downloadStatusEntity");GR=g.m(b);for(ED=GR.next();!ED.done;ED=GR.next())oq=ED.value,H=g.ZE(oq.key).entityId,GH=dN(oq),L7=g.ZE(GH.action.entityKey).entityId,H!==Z&&
L7!==Z||KF(G,oq.actionProto)||qS.push(oq.key);return g.S(si,wq(u,{mode:"readwrite",SK:!0},function(zH){var Z6=qS.map(function(av){return Iz(zH,av)});
Z6.push(Iz(zH,N,{uD:!0}));Z6.push(Iz(zH,K7,{uD:!0}));return g.nB.all(Z6)}),7);
case 7:Qw=(Rq=L)==null?void 0:Rq.offlineModeType,q&&(VC(q),q.offlineModeType&&(Qw=q.offlineModeType)),fF(z,Qw),X9(y,{entityKey:N,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.pA(si)}})},azv=function(Z,u){return Z.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(u))},VC=function(Z){var u;
Z.offlineDeleteReason=(u=Z.offlineDeleteReason)!=null?u:"OFFLINE_DELETE_REASON_UNKNOWN";var G;Z.offlineModeType=(G=Z.offlineModeType)!=null?G:"OFFLINE_NOW";g.Kl("offlineDeleteEvent",Z)},vGe=function(Z,u,G,y){g.O.call(this);
var q=this;this.U=Z;this.api=u;this.nV=G;this.UT=y;this.X=new g.dn;this.D=new g.fy(function(){q.j&&q.j.transferState==="TRANSFER_STATE_TRANSFERRING"&&q.X.DK()&&((q.j.transferRetryCount||0)<3?F9(q.K,q.G,!1,!1):zM(q.K,q.G.videoDetails.videoId),q.p$("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Qn=this.u7=0;this.Fn=this.C=!1;this.sT=g.Zh(this.api.J().experiments,"html5_transfer_processing_logs_interval");this.al=new g.Ch(this);this.Wy={EF6:function(){return q.D},
sCn:function(){return q.UT},
W1:function(){return q.X}};
this.xx=this.U.observe(this.Bk.bind(this));this.K=new g4w(u,this);this.wH=new X1J(u);this.Zi=new ci(this.U);this.Mu=this.X.listen("publicytnetworkstatus-online",this.Gd.bind(this));this.SD=this.X.listen("publicytnetworkstatus-offline",this.YP1.bind(this));this.Fn=this.api.J().S("html5_less_transfer_processing_logs");g.M(this,this.al);this.al.V(u,"offlinetransferpause",this.Ks6);if(g.Pv(this.api.J()))this.T="mainVideoDownloadStateEntity";else if(g.MO(this.api.J())||g.we(this.api.J()))this.T="musicTrackDownloadMetadataEntity"},
nHs=function(){CX.apply(this,arguments)},MjP=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},lxw=function(){CX.apply(this,arguments)},oGi=function(Z){return{context:g.GF(),
videoIds:Z}},D$4=function(Z,u,G,y){y=y===void 0?[]:y;
u={offlineOrchestrationContext:pQw(Z,u,G,y)};u=Gzk(3,u);H84(B0w(),u,Z.rootActionId)},coP=function(){var Z;
return g.A(function(u){return u.j==1?g.S(u,uNH(),2):(Z=u.U)?u.return(Z.delete("yt-player-local-img")):u.return(!0)})},Mcv=function(){CX.apply(this,arguments)},KF=function(Z,u){return Z.actionType===u.actionType&&Z.entityKey===u.entityKey},YFe=function(Z){return g.fH(m$i(),Z)},Jus=function(){CX.apply(this,arguments)},gN=function(Z,u,G,y,q,N){return new rq(u?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",$w(Z),G,y,q,N)},EHk=function(Z,u){return Z!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||
u?Z==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&u?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":Z:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},p1J=function(Z,u,G,y){var q,N,e,h,d,K,f;
return g.A(function(V){switch(V.j){case 1:return g.S(V,dXd([u]),2);case 2:return q=V.U,g.S(V,U$e(Z,q[0],G,y),3);case 3:return N=V.U,e=N.mainPlaylistEntity,h=N.CVu,K=WQR(e,(d=h)==null?void 0:d.avatar),g.QS(V,4),g.S(V,M8(K),6);case 6:g.u8(V,5);break;case 4:f=g.Ts(V),f instanceof Error&&f.message==="Failed to fetch"&&FE(f.message);case 5:return V.return(q[0].videos)}})},Hye=function(){CX.apply(this,arguments)},rhd=function(Z,u){if(u)for(var G=0;G<Z.actions.length;G++)if(u==="!*$_ALL_ENTITIES_!*$"&&Z.actions[G].actionId!==
u||u!=="!*$_ALL_ENTITIES_!*$"&&Z.actions[G].rootActionId===u&&Z.actions[G].actionId!==u)Z.actions.splice(G,1),G--},KQe=function(Z,u){Z=Z instanceof az?Z:u(Z);
g.SE(Z);throw Z;},Xye=function(Z,u,G){var y,q,N;
return g.A(function(e){switch(e.j){case 1:return g.S(e,dXd([u]),2);case 2:return y=e.U,g.S(e,rNs(Z,y[0],G),3);case 3:return q=e.U,N=D4(q.thumbnailDetails),g.S(e,M8(N),4);case 4:return e.return(y[0].videos)}})},Bei=function(Z,u){u=u===void 0?0:u;
Z=Z.j[u];if(!Z)throw u=new az("INVALID_ENCODER_VERSION",{QW:u}),g.SE(u),u;return Z},H84=function(Z,u,G){if(!G){var y=y===void 0?!1:y;
G=Z.j.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!G||y)G=g.HU(16),Z.j.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",G)}Z={flowNonce:G,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:u.eventType};u.metadata&&(Z.flowMetadata=u.metadata);u.statusCode!==void 0&&(Z.flowEventStatus=u.statusCode);u.csn&&(Z.csn=u.csn);u.can&&(Z.can=u.can);g.Kl("flowEvent",Z,void 0)},tcJ=function(){CX.apply(this,arguments)},ltH=function(Z,u,G){G=G===void 0?[]:G;
var y,q,N,e,h,d,K,f,V,X,n,l,Y;return g.A(function(E){if(E.j==1)return G.length?g.S(E,PH(Z,u),2):E.return([]);y=E.U;q=new Set;N=g.m(y);for(e=N.next();!e.done;e=N.next())if(h=e.value,d=h.id||h.key)K=g.ZE(d).entityId,q.add(K);f=[];V=g.m(G);for(X=V.next();!X.done;X=V.next())n=X.value,l=n.offlineVideoData,Y=void 0,((Y=l)==null?0:Y.videoId)&&!q.has(l.videoId)&&f.push(n);return E.return(f)})},KTJ=function(Z,u,G,y){var q,N,e,h,d,K,f,V,X;
return g.A(function(n){if(n.j==1)return q=g.hq("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),N=new Map,g.S(n,wq(Z,{mode:"readwrite",SK:!0},function(l){var Y=xD(l,"transfer"),E=xD(l,"offlineOrchestrationActionWrapperEntity"),W=xD(l,"videoDownloadContextEntity"),p=bR(l,q,"mainDownloadsListEntity");return g.nB.all([Y,E,W,p]).then(function(z){z=g.m(z);var L=z.next().value;var Q=z.next().value;var b=z.next().value;var w=z.next().value;z=WSv.map(function(x9){return FgH(l,x9)});
Q=g.m(Q);for(var yv=Q.next();!yv.done;yv=Q.next())yv=yv.value,KF(u,yv.actionProto)||z.push(Iz(l,yv.key,{uD:!0}));w&&(w.downloads=[],z.push(TL(l,w,"mainDownloadsListEntity")));if(b)for(b=g.m(b),w=b.next();!w.done;w=b.next())w=w.value,Q=g.ZE(w.key).entityId,Q=g.hq(Q,"transfer"),N.set(Q,w.offlineModeType);return g.nB.all(z).then(function(){return L})})}),2);
e=n.U;h=g.m(e);for(d=h.next();!d.done;d=h.next())K=d.value,fF(K,N.get(K.key)),f=g.ZE(K.key).entityId,V={videoId:f,offlineDeleteReason:y,cotn:K.cotn,offlineModeType:N.get(K.key)},VC(V),X=g.hq(f,"mainVideoEntity"),X9(G,{entityKey:X,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.S(n,coP(),0)})},jjs=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W;
return g.A(function(p){switch(p.j){case 1:return G=$w(u),y=g.ZE(u.entityKey),q=y.entityId,N=[],g.QS(p,2),g.S(p,fzv(Z,q),4);case 4:N=p.U;if((e=N)==null||!e.length){p.Rl(5);break}return g.S(p,nuR(Z.j,u.entityKey),5);case 5:g.u8(p,3);break;case 2:return h=g.Ts(p),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.h1&&h.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
p.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,d,K));case 3:return f=[],g.S(p,ltH(Z.j,"musicTrack",N),7);case 7:N=p.U;if(N.length)for(V=g.m(N),X=V.next();!X.done;X=V.next())if(n=X.value,l=n.offlineVideoData,Y=void 0,(Y=l)==null?0:Y.videoId)E=void 0,W=Number(((E=u.actionMetadata)==null?void 0:E.priority)||0)+1,f.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",l.videoId,"musicTrack",W,wN,Es(u,l,q)));return p.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,f))}})},
TM=function(Z,u,G,y,q){g.O.call(this);
var N=this;this.U=Z;this.xx=u;this.Qn=G;this.K=y;this.W=q;this.j=new OyP;this.X=new g.dn;this.T=new g.fy(function(){N.retry()});
this.C=NaN;this.G=!1;this.Wy={i7l:function(){return N.j},
W1:function(){return N.X},
v47:function(){return N.T},
retry:function(){return N.retry()}};
g.M(this,this.T);this.Fn=this.U.observe(this.UT.bind(this))},Aui=function(){CX.apply(this,arguments)},zyR=function(){CX.apply(this,arguments)},xD=function(Z,u,G){return G?(G=G.map(function(y){return bR(Z,y,u)}),g.nB.all(G)):Z.j.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(u)).then(function(y){return y.map(function(q){return WTk(Z,q)})})},LSR=function(){CX.apply(this,arguments)},blP=function(Z){var u;
return g.A(function(G){if(G.j==1)return g.S(G,g.S3Y(Z),2);u=G.U;return G.return(u.filter(function(y){return!!y.url}).map(function(y){return y.url}))})},sji=function(){var Z,u;
return g.A(function(G){if(G.j==1)return g.S(G,g.Xs(),2);if(G.j!=3){Z=G.U;if(!Z)throw g.ip("rvdfd");return g.S(G,g.V$(Z),3)}u=G.U;return G.return(g.Hq(u,["index","media"],{mode:"readwrite",SK:!0},function(y){var q={};return g.Bq(y.objectStore("index"),{},function(N){var e=N.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),h=g.nB.resolve(void 0);if(e){var d=e[1];e=e[2];q[d]=q[d]||{};var K;q[d][e]=g.Dwo((K=N.getValue())==null?void 0:K.fmts)}else h=N.delete().then(function(){});
return g.nB.all([g.Wq(N),h]).then(function(f){return g.m(f).next().value})}).then(function(){for(var N={},e=g.m(Object.keys(q)),h=e.next();!h.done;h=e.next()){h=h.value;
var d=q[h].v;N[h]=q[h].a&&d?1:2}var K=eyw(N);return g.WLt(y.objectStore("media"),{},function(f){var V=f.cursor.key.match(g.ejD);V&&N[V[1]]||y.objectStore("media").delete(f.cursor.key);return g.d$J(f)}).then(function(){return K})})}))})},GpH=function(){var Z,u,G,y,q;
return g.A(function(N){if(N.j==1)return g.S(N,QO(),2);if(N.j!=3)return(Z=N.U)?g.S(N,PH(Z,"refresh"),3):N.return(!1);u=N.U;if((G=u[0])==null||!G.refreshTime)return N.return(!1);y=Number(u[0].refreshTime);q=Date.now()/1E3;return N.return(isFinite(y)&&q>=y)})},X9=function(Z,u){Z.api.pV("onOfflineOperationFailure",u);
var G;(G=Z.j)==null||G.postMessage(u)},vHH=function(Z){if(Z.includes(":"))throw Error("Invalid user cache name: "+Z);
return Z+":"+g.UG("CacheStorage get")},SFR=function(Z){switch(Z.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},oHP=function(Z,u){var G,y,q,N,e,h,d,K,f;
return g.A(function(V){switch(V.j){case 1:return G=u.entityKey,q=(y=g.C(u.actionMetadata,SH))==null?void 0:y.isEnqueuedForExpiredStreamUrlRefetch,g.QS(V,2),N=void 0,g.S(V,RyJ(Z,u),4);case 4:N=V.U;g.QS(V,5);var X=(X=g.C(u.actionMetadata,SH))?{maximumDownloadQuality:X.maximumDownloadQuality}:void 0;return g.S(V,ClR(G,Z.W,{isEnqueuedForExpiredStreamUrlRefetch:q,wO:X,offlineSourceData:N}),7);case 7:e=V.U;g.u8(V,6,2);break;case 5:return g.Ts(V,2),h=$w(u)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",FE("PDE handleAdd error"),V.return(gN(u,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",h,"DOWNLOAD_STATE_FAILED"));case 6:return g.S(V,PlH(Z,e,u),8);case 8:return V.return(gN(u,!0,e.orchestrationActions));case 2:return d=g.Ts(V),K="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.h1&&d.type==="QUOTA_EXCEEDED"&&(K="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),FE("PDE handleAdd error"),V.return(gN(u,!1,void 0,K,f,"DOWNLOAD_STATE_FAILED"))}})},SWk=function(Z,u,G,y,q){var N;
return g.A(function(e){if(e.j==1)return N=new TM(Z,u,G,y,q),g.S(e,E4H(N),2);QjP(N);return e.return(N)})},Gee=function(Z,u){var G;
return((G=Z.player)==null?void 0:G.getVideoData().videoId)===u?Z.player:null},FSe=function(){CX.apply(this,arguments)},aK=function(){},cus=function(Z){switch(Z.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},kw=function(Z,u,G,y,q){q=q===void 0?!1:q;
var N,e,h,d,K,f;return g.A(function(V){if(V.j==1)return N=g.hq(Z,u),e=g.hq(Z,"downloadStatusEntity"),g.S(V,wq(G,{mode:"readonly",SK:!0},function(X){return g.nB.all([bR(X,N,u),bR(X,e,"downloadStatusEntity")])}),2);
h=V.U;d=h.length?h[0]:void 0;if(!d)return V.Rl(0);K=gHa;if(f=h.length>1?h[1]:void 0){if(f.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!q)return V.return();f.downloadState=y}else f={key:e,downloadState:y};g.qi(d,K,f);return g.S(V,wq(G,{mode:"readwrite",SK:!0},function(X){return g.nB.all([TL(X,d,u),TL(X,f,"downloadStatusEntity")])}),0)})},w1i=function(){CX.apply(this,arguments)},TeH=function(){CX.apply(this,arguments)},byP=function(Z,u){if(u.length===0)return Promise.resolve([]);
u=u.map(function(G){return Pi(G)});
return axw(Z.U,u)},dN=function(Z){if(!Z.key)throw Error("Entity key is required.");
if(!Z.actionProto)throw Error("OfflineOrchestrationAction is required.");var u=g.ZE(Z.key),G=g.ZE(Z.actionProto.entityKey);return new AV(G.entityType,u.entityId,Z.actionProto,Z.parentActionId,Z.rootActionId,Z.childActionIds,Z.prereqActionId,Z.postreqActionIds,Z.retryScheduleIndex,Z.hasChildActionFailed,Number(Z.enqueueTimeSec)*1E3)},Ixe=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p;
return g.A(function(z){switch(z.j){case 1:return G=$w(u),y=g.ZE(u.entityKey),q=y.entityId,g.S(z,Bi(Z.j,u.entityKey,"mainVideoEntity"),2);case 2:N=z.U;if(!N){e=void 0;z.Rl(3);break}return g.S(z,Bi(Z.j,N.downloadState,"mainVideoDownloadStateEntity"),4);case 4:e=z.U;case 3:h=e;if(!N||!h)return z.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.QS(z,5);return g.S(z,qPJ(Z,q,h.addedTimestampMillis,(K=g.C(u.actionMetadata,nF))==null?void 0:K.offlineVideoData),7);case 7:f=1;f=Number(((V=
u.actionMetadata)==null?void 0:V.priority)||0)+1;d=lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q,"playbackData",f,N0i);g.u8(z,6);break;case 5:X=g.Ts(z);if(!(X instanceof Error&&X.message==="No data")){if(X instanceof Error&&X.message==="Empty response body")FE(X.message);else return n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.h1&&X.type==="QUOTA_EXCEEDED"&&(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),z.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,n,l));z.Rl(6);break}return g.S(z,bM(Z.j,q),9);case 9:Y=z.U;E=g.C(u.actionMetadata,nF);if(p=(W=E)==null?void 0:W.playlistId)Y.playlistId=p;Y.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.S(z,CF(q,Z.j,u,Z.T,Y),6);case 6:return z.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,d?[d]:void 0))}})},$$e=function(Z){var u=(Z.j.transferRetryCount||0)<
3;
u&&(Z=Z.j,Z.transferRetryCount=(Z.transferRetryCount||0)+1);return u},T0e=function(Z){Z=Z.key||Z.id;
if(!Z)throw Error("Entity key is missing");return Z},iyJ=function(Z){return g.A(function(u){g.M0(Z,0);
return u.return(ruJ(Z))})},upe=function(Z,u){var G,y,q;
return g.A(function(N){G=g.m(u);for(y=G.next();!y.done;y=G.next()){q=y.value;var e=void 0,h=void 0,d=((h=q.action)==null?void 0:(e=h.actionMetadata)==null?void 0:e.retryScheduleIntervalsInSeconds)||[1,2,4];e=1;q.retryScheduleIndex<d.length&&(e=d[q.retryScheduleIndex]);q.j=e*1E3+Date.now();q.retryScheduleIndex++}return g.S(N,byP(Z,u),0)})},kpJ=function(){CX.apply(this,arguments)},bM=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X;
return g.A(function(n){if(n.j==1)return G=g.hq(u,"transfer"),y=g.hq(u,"videoDownloadContextEntity"),g.S(n,wq(Z,{mode:"readonly",SK:!0},function(l){return g.nB.all([bR(l,G,"transfer"),bR(l,y,"videoDownloadContextEntity")])}),2);
q=n.U;N=g.m(q);e=N.next().value;h=N.next().value;d=e;K=h;X={videoId:u,cotn:(f=d)==null?void 0:f.cotn,offlineModeType:(V=K)==null?void 0:V.offlineModeType};return n.return(X)})},IK=function(){pF.apply(this,arguments);
this.Fn="musicTrack"},qPJ=function(Z,u,G,y,q){var N,e,h,d,K,f;
return g.A(function(V){switch(V.j){case 1:if(N=y){V.Rl(2);break}return g.S(V,Frd([u]),3);case 3:e=V.U,N=e[0];case 2:return g.S(V,ZKP(Z,N,G,q),4);case 4:h=V.U;d=h.mainVideoEntity;K=h.channelEntity;g.QS(V,5);var X=D4(d.thumbnail),n=D4(K.avatar);return g.S(V,M8(X.concat(n)),7);case 7:g.u8(V,0);break;case 5:f=g.Ts(V),f instanceof Error&&f.message==="Failed to fetch"&&FE(f.message),g.pA(V)}})},uBJ=function(Z){if(Z==null?0:Z.streamsProgress){var u=0;
Z=Z.streamsProgress;for(var G=0;G<Z.length;G++){var y=Z[G];isNaN(Number(y.numBytesDownloaded))?FE("stream progress bytes number invalid"):u+=Number(y.numBytesDownloaded)}return u}return 0},PKe=function(Z,u){return wq(Z,{mode:"readwrite",
SK:!0},function(G){return Iz(G,u)})},yC=function(){},Gmw=function(){CX.apply(this,arguments)},ybi=function(){},TL=function(Z,u,G){var y=T0e(u),q=Bei(Z.U,1),N=Object.assign({},u);
return Z.j.objectStore("EntityStore").get(y).then(function(e){if(e){if(e.entityType!==G)throw Error("Incorrect entity type");N.entityMetadata||(e=WTk(Z,e),N.entityMetadata=e.entityMetadata)}}).then(function(){var e={key:y,
entityType:G,data:Vja(q,N,y),version:1};return g.nB.all([g.cA(Z.j.objectStore("EntityStore"),e),IzH(Z,N,G)])}).then(function(){vi(Z,y,G);
return y})},qfi=function(){CX.apply(this,arguments)},NRR=function(){CX.apply(this,arguments)},exs=function(Z){return new az("WRONG_DATA_TYPE",{QW:Z})},x6i=function(){pF.apply(this,arguments);
this.Fn="mainVideoEntity"},d64=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv,x9,qS,K7,GR;
return g.A(function(ED){switch(ED.j){case 1:return G=$w(u),y=[],g.S(ED,$D.getInstance(),2);case 2:q=ED.U;if(!q){ED.Rl(3);break}return g.S(ED,q.get("sdois"),4);case 4:return N=ED.U,g.S(ED,(h=q)==null?void 0:h.get("lmqf"),5);case 5:e=ED.U;case 3:g.QS(ED,6);if(N===void 0)throw Error("prefStorage or opt-in state is undefined");d=[];if(N){ED.Rl(8);break}return g.S(ED,Old(Z.j),9);case 9:d=ED.U,d.reverse();case 8:if(!d.length){ED.Rl(10);break}K=g.m(d);f=K.next();case 11:if(f.done){ED.Rl(10);break}V=f.value;
if(!V){ED.Rl(12);break}X=g.ZE(V).entityId;return g.S(ED,bM(Z.j,X),14);case 14:return n=ED.U,n.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.S(ED,CF(X,Z.j,{entityKey:V,actionType:u.actionType},Z.T,n),12);case 12:f=K.next();ED.Rl(11);break;case 10:return g.S(ED,Rtk(N,(l=e)!=null?l:"SD"),16);case 16:return Y=ED.U,g.S(ED,QYd(Y),17);case 17:E=hxi(Y);if(!Z.W.S("woffle_enable_main_downloads_library")){ED.Rl(18);break}if(N){ED.Rl(19);break}return g.S(ED,VtJ(Z.j,g.Sk),19);case 19:return g.S(ED,
Tri(Z.j,[g.Sk]),18);case 18:if((W=E)==null?0:W.length)for(p=g.m(E),z=p.next();!z.done;z=p.next())if(Q=L=z.value,b=Q.actionType,w=Q.entityKey,yv=Q.actionMetadata,b&&w&&yv&&!g.C(yv,qFJ)){b==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(yv.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(x9=g.C(L.actionMetadata,nF))x9.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",L.actionMetadata=Object.assign({},L.actionMetadata,{mainVideoEntityActionMetadata:x9});y.push(L)}g.u8(ED,
7);break;case 6:return qS=g.Ts(ED),K7="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",GR="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",qS instanceof g.h1&&qS.type==="QUOTA_EXCEEDED"&&(K7="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",GR="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ED.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,K7,GR));case 7:return ED.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,y))}})},jbe=function(Z){for(var u,
G=g.m(Z.additionalMetadatas),y=G.next();!y.done;y=G.next())y=y.value,y.offlineMusicVideoData&&(u=y.offlineMusicVideoData);
var q,N,e,h,d;return{id:g.hq(Z.videoId,"musicTrack"),videoId:Z.videoId,title:Z.title,thumbnailDetails:Z.thumbnail,lengthMs:String(Number(Z.lengthSeconds)*1E3),albumTitle:(q=u)==null?void 0:q.releaseTitle,musicVideoType:(N=u)==null?void 0:N.musicVideoType,contentRating:{explicitType:(e=u)==null?void 0:e.explicitType},artistNames:((h=u)==null?void 0:h.byline)||((d=u)==null?void 0:d.channelName),downloadMetadata:g.hq(Z.videoId,"musicTrackDownloadMetadataEntity")}},NPe=function(Z,u,G,y){var q,N,e,h,d,
K,f,V;
return g.A(function(X){switch(X.j){case 1:q=[],N=g.m(u),e=N.next();case 2:if(e.done){X.Rl(4);break}h=e.value;if(h.upToDate||G&&!h.shouldAutoSyncMetadata||!h.playlistId){X.Rl(3);break}d={};switch(y){case "mainPlaylistEntity":K={nextAutoRefreshIntervalSeconds:h.checkInSeconds,autoSync:G};d={mainPlaylistEntityActionMetadata:K};break;case "musicPlaylist":f={autoSync:G},d={musicPlaylistEntityActionMetadata:f}}return g.S(X,RK(Z,[h.playlistId],y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d),6);case 6:(V=
X.U)&&q.push.apply(q,g.bg(V));case 3:e=N.next();X.Rl(2);break;case 4:return X.return(q)}})},RK=function(Z,u,G,y,q){var N,e,h;
return g.A(function(d){if(d.j==1)return g.S(d,QO(),2);N=d.U;if(!N)return d.return([]);e=u.map(function(K){var f=g.hq(K,G);f={actionType:y,entityKey:f,actionMetadata:Object.assign({},MjP(),q)};y!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(f.actionMetadata.priority=0);K=new AV(G,K,f);return Pi(K)});
h=axw(N,e);Wrk(Z.T);return d.return(h)})},ci=function(Z){g.O.call(this);
this.j=Z;this.U=this.j.observe(this.T.bind(this))},fms=function(Z){var u,G,y,q,N,e,h;
return g.A(function(d){if(d.j==1)return g.S(d,$XR(Z),2);u=d.U;G=[];y=g.m(u);for(q=y.next();!q.done;q=y.next())N=q.value,e=g.ZE(N.key),h=e.entityId,KsH(Z.j,h)||G.push(N);return g.S(d,JoR(Z,G),0)})},VUi=function(){CX.apply(this,arguments)},TPe=function(Z,u,G){return new g.kR(Z,{cotn:u,
raw_player_response:G,download_media:!0,start:Infinity,disable_watch_next:!0})},sb4=function(Z){return g.A(function(u){Z.api.pV("onOrchestrationBecameLeader");
return g.S(u,Z.Dh(),0)})},$oa=function(Z,u){Z.j&&(Z.X=u,QC(Z))},WQR=function(Z,u){var G=[];
if(Z.thumbnailStyleData){Z=g.m(Z.thumbnailStyleData);for(var y=Z.next();!y.done;y=Z.next()){var q=void 0,N=void 0,e=void 0;G=G.concat(D4((q=y.value)==null?void 0:(N=q.value)==null?void 0:(e=N.collageThumbnail)==null?void 0:e.coverThumbnail))}}u=D4(u);return G.concat(u)},XGe=function(){CX.apply(this,arguments)},Kgs=function(Z,u,G,y){var q,N,e,h,d,K,f,V,X;
return g.A(function(n){return n.j==1?(q=u.playlistId,N=LrR(u),e=N.FR,h=N.jG,d=G?(Number(G)*1E3).toString():Date.now().toString(),K=u.lastModifiedTimestamp?(Number(u.lastModifiedTimestamp)*1E3).toString():"0",f={id:g.hq(q,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:h,lastModifiedTimestampMillis:K,addedTimestampMillis:d,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},V={id:g.hq(q,"musicPlaylist"),title:u.title,playlistId:q,thumbnailDetails:u.thumbnail,visibility:cus(u),trackCount:u.totalVideoCount,
tracks:e,downloadMetadata:f.id},y&&(((X=V)==null?0:X.entityMetadata)?V.entityMetadata.nextAutoRefreshIntervalSeconds=String(y):V&&(V.entityMetadata={nextAutoRefreshIntervalSeconds:String(y)})),g.S(n,wq(Z.j,{mode:"readwrite",SK:!0},function(l){var Y=TL(l,V,"musicPlaylist");l=TL(l,f,"musicPlaylistDownloadMetadataEntity");return g.nB.all([Y,l])}),2)):n.return(V)})},rN=function(Z){return Z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!Z.entityKey},OyP=function(){this.actions=[]},nOd=function(Z,
u){this.j=Z;
this.T=u},D6s=function(Z){var u,G,y,q,N;
g.A(function(e){switch(e.j){case 1:if(!Z.j)return eH(Z,"onTransferComplete"),e.return();u=Z.j;Z.D.stop();if(!u||!Z.G){e.Rl(2);break}G=TPe(Z.api.J(),u.cotn,Z.G);return g.S(e,ata(Z,G),2);case 2:return g.S(e,Wi(Z,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:q=((y=u)==null?0:y.key)?g.ZE(u.key).entityId:"";if(!q||!Z.T){e.Rl(5);break}return g.S(e,kw(q,Z.T,Z.U,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.S(e,lme(Z.U,q),7);case 7:return g.S(e,tV(Z,q),8);case 8:N=e.U,mF({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:q,wJ:u,offlineModeType:N}),jH(Z),Os(Z),g.pA(e)}})},MUJ=function(Z,u,G){this.j=Z;
this.W=u;this.T=G},m6i=function(){CX.apply(this,arguments)},YfJ=function(Z,u,G){this.j=Z;
this.W=u;this.T=G},RyJ=function(Z,u){var G,y,q,N;
return g.A(function(e){if(e.j==1)return G=g.ZE(u.entityKey).entityId,y=g.hq(G,"videoDownloadContextEntity"),g.S(e,Bi(Z.j,y,"videoDownloadContextEntity"),2);q=e.U;return(N=q)!=null&&N.offlineModeType?e.return({offlineModeType:q.offlineModeType}):e.return(void 0)})},Jbs=function(){g.gC.apply(this,arguments);
var Z=this;this.events=new g.Ch(this);this.W=this.player.J();this.Wy={d$m:function(){return Z.j},
L7:function(){return Z.L7()},
EW:function(u){return Z.EW(u)}}},s6e=function(Z,u,G){if(G.has(u))return g.nB.resolve(void 0);
G.add(u);return zjR(Z,u).then(function(y){return Z.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(u)).then(function(){return y})}).then(function(y){var q=g.nB.resolve(void 0);
y=g.m(y);for(var N=y.next(),e={};!N.done;e={Eo:void 0},N=y.next())e.Eo=N.value,q=q.then(function(h){return function(){return s6e(Z,h.Eo,G)}}(e));
return q}).then(function(){})},cXv=function(Z,u){var G;
return g.A(function(y){if(!Z.j)return y.return();G=Z.j;return g.S(y,wq(Z.U,{mode:"readwrite",SK:!0},function(q){var N=[TL(q,G,"transfer")];u&&N.push(u(q));return g.nB.all(N)}),0)})},mov=function(Z){return pya[Z.transferState]!==void 0},m$i=function(){if(iM)return iM();
var Z={};iM=g.y$("PersistentEntityStoreDb",{tN:(Z.EntityStore={jO:1},Z.EntityAssociationStore={jO:2},Z),shared:!1,upgrade:function(u,G){G(1)&&g.Nv(g.qv(u,"EntityStore",{keyPath:"key"}),"entityType","entityType");G(2)&&(u=g.qv(u,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Nv(u,"byParentEntityKey","parentEntityKey"),g.Nv(u,"byChildEntityKey","childEntityKey"))},
version:3});return iM()},EOk=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n;
return g.A(function(l){switch(l.j){case 1:return G=$w(u),g.S(l,PH(Z.j,"videoPlaybackPositionEntity"),2);case 2:y=l.U;if(y.length===0)return l.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.QS(l,3);return g.S(l,$D.getInstance(),5);case 5:q=l.U;if(!q)throw Error("prefStorage is undefined");return g.S(l,q.get("psi"),6);case 6:return N=l.U,d=(h=(e=N)==null?void 0:e.oo)!=null?h:"0",g.S(l,VcR(y,d),7);case 7:return K=l.U,f={isPaused:K.watchHistoryPaused,oo:K.syncTimestampUsec},g.S(l,q.set("psi",
f),8);case 8:if(f.isPaused){l.Rl(9);break}V=g.C(K.frameworkUpdates,q8);if(!K.frameworkUpdates||!V){l.Rl(9);break}return g.S(l,oli(V),9);case 9:g.u8(l,4);break;case 3:return X=g.Ts(l),n="PPE handleRefresh error: "+(X instanceof Error?X.message:"unknown error"),FE(n),l.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return l.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},pGR=function(Z,u,G,y){var q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv,x9,qS,K7,GR,ED,oq,H,GH,L7;
return g.A(function(Rq){switch(Rq.j){case 1:return g.S(Rq,QO(),2);case 2:q=Rq.U;if(!q)return Rq.return([]);N=[];if((e=y)==null?0:e.length){N=y;Rq.Rl(3);break}return g.S(Rq,PH(q,"mainPlaylistEntity"),4);case 4:N=Rq.U;case 3:if(!N.length)return Rq.return([]);h=[];d=Date.now()/1E3;K=g.m(N);f=K.next();case 5:if(f.done)return h.length?g.S(Rq,U6v(h),10):Rq.return([]);V=f.value;if(!V.downloadState){X=void 0;Rq.Rl(8);break}return g.S(Rq,Bi(q,V.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:X=
Rq.U;case 8:n=X;l=void 0;E=(Y=(l=V)==null?void 0:l.entityMetadata)&&Y.nextAutoRefreshIntervalSeconds?Number(Y.nextAutoRefreshIntervalSeconds):NaN;W=Number.isNaN(E)?Z:E;z=p=void 0;L=((p=n)==null?0:p.lastSyncedTimestampMillis)?Number((z=n)==null?void 0:z.lastSyncedTimestampMillis)/1E3:0;b=Q=void 0;w=((Q=n)==null?0:Q.addedTimestampMillis)?Number((b=n)==null?void 0:b.addedTimestampMillis)/1E3:0;if(G||!Y||L+W<=d){yv=[];x9=void 0;if((x9=V.videos)==null?0:x9.length)for(qS=g.m(V.videos),K7=qS.next();!K7.done;K7=
qS.next())GR=K7.value,ED=JSON.parse(g.ZE(GR).entityId),ED.videoId&&yv.push(ED.videoId);oq="0";Y&&(H=void 0,oq=String(Number((H=Y.offlineLastModifiedTimestampSeconds)!=null?H:0).toFixed()));GH={playlistId:V.playlistId,videoIds:yv,offlineLastModifiedTimestamp:oq,autoSync:u,offlineDateAddedTimestamp:String(w.toFixed())};h.push(GH)}f=K.next();Rq.Rl(5);break;case 10:return L7=Rq.U,Rq.return(L7)}})},HKJ=function(Z,u){Z=g.m(Z.observers);
for(var G=Z.next();!G.done;G=Z.next())G=G.value,G(u)},tUk=function(Z,u,G,y,q,N){var e,h,d;
return g.A(function(K){e="STREAM_TYPE_UNKNOWN";G.video&&G.audio?(e="STREAM_TYPE_AUDIO_AND_VIDEO",FE("unexpected stream type")):G.video&&!G.audio?e="STREAM_TYPE_VIDEO":!G.video&&G.audio&&(e="STREAM_TYPE_AUDIO");h=g.hq(u,"offlineVideoStreams");d={numBytesDownloaded:q.toFixed(),numTotalBytes:N.toFixed(),streamType:e,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(y),itag:e==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(G.itag):void 0};return g.S(K,wq(Z,{mode:"readwrite",SK:!0},
function(f){var V=bR(f,h,"offlineVideoStreams"),X=bR(f,g.hq(u,"transfer"),"transfer");return g.nB.all([V,X]).then(function(n){n=g.m(n);var l=n.next().value;n=n.next().value;if(!n)return Iz(f,h).then(function(){});
var Y=uBJ(l);l=BRJ(l,y,d,h);var E=TL(f,l,"offlineVideoStreams");uBJ(l)>Y&&(n.lastProgressTimeMs=Date.now().toString());Y=[E];n.offlineVideoStreams||(n.offlineVideoStreams=[]);n.offlineVideoStreams.indexOf(h)===-1&&(n.offlineVideoStreams.push(h),Y.push(TL(f,n,"transfer")));return g.nB.all(Y)})}),0)})},Wsi=function(Z,u,G){u=TPe(Z.W,G.cotn,u);
G=g.Xg(u);return g.VSF(u,G,Z.W)},$D=function(Z){this.token=Z},GKa=function(Z,u){u=g.m(u);
for(var G=u.next();!G.done;G=u.next())G=G.value,kzJ(G,1),Z.actions.push(G);Z.actions.sort(Z.j)},Z8R=function(Z,u,G){var y,q,N,e,h,d,K,f,V,X,n,l;
return g.A(function(Y){switch(Y.j){case 1:y=u.retryScheduleIndex+2===3;if(G.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){Y.Rl(2);break}if(G.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){Y.Rl(0);break}D$4(u,G,y);if(G.j&&u.retryScheduleIndex+1<3)return g.S(Y,upe(Z,[u]),0);N=((q=G)==null?0:q.U)?G.U:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";e={entityKey:u.action.entityKey,failureReason:N};h=void 0;g.Pv(Z.W)?h="mainVideoDownloadStateEntity":g.MO(Z.W)&&(h="musicTrackDownloadMetadataEntity");
if(!h||!G.downloadState){Y.Rl(7);break}d=g.ZE(u.action.entityKey).entityId;return g.S(Y,kw(d,h,Z.U,G.downloadState),7);case 7:X9(Z.K,e);if(G.downloadState==="DOWNLOAD_STATE_FAILED"&&Z.W.S("html5_auto_retry_failed_pde_actions")){Y.Rl(0);break}FE("Orchestration result is not retryable, deleting action");return g.S(Y,PKe(Z.U,Pi(u).key),0);case 2:K=void 0;try{K=(f=G.D)==null?void 0:f.map(function(E){return Z.createAction(E,u)})}catch(E){return D$4(u,G,y),V={entityKey:u.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},X9(Z.K,V),FE("Orchestration subactions creation error",E),Y.return()}D$4(u,G,y,K);if(!K){Y.Rl(12);break}X=K.map(function(E){return Pi(E)});
n=0;case 13:if(!(n<K.length)||Z.G){Y.Rl(15);break}return g.S(Y,wq(Z.U,{mode:"readwrite",SK:!0},function(E){var W=[];W.push(CKe(E,X.slice(n,n+10),"offlineOrchestrationActionWrapperEntity"));return g.nB.all(W)}),16);
case 16:n+=10;Y.Rl(13);break;case 15:if(Z.G)return Z.G=!1,Y.return();case 12:return l=Pi(u),g.S(Y,PKe(Z.U,l.key),17);case 17:kzJ(u,4),g.pA(Y)}})},U$e=function(Z,u,G,y){var q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L;
return g.A(function(Q){switch(Q.j){case 1:q=Date.now().toString();G||(G=q);N=u.videos;e=u.playlistId;h=[];d=[];if(N)for(K=g.m(N),f=K.next();!f.done;f=K.next()){V=f.value;X=V.offlineVideoData;if(!X||!X.videoId)throw FE("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");n=X.videoId;l={videoId:n,playlistId:e};Y={id:g.hq(JSON.stringify(l),"mainPlaylistVideoEntity"),video:g.hq(n,"mainVideoEntity")};h.push(Y);d.push(Y.id)}W={key:g.hq(e,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:G,lastSyncedTimestampMillis:q};p={key:g.hq(e,"mainPlaylistEntity"),playlistId:e,videos:d,title:u.title,thumbnailStyleData:jaR(u),visibility:SFR(u),downloadState:W.key};u.channel&&(z=u.channel.offlineChannelData,E=MtR(g.hq(e,"ytMainChannelEntity"),z),p.channelOwner=E.id);((L=p)==null?0:L.entityMetadata)?(p.entityMetadata.offlineLastModifiedTimestampSeconds=u.lastModifiedTimestamp,y&&(p.entityMetadata.nextAutoRefreshIntervalSeconds=String(y))):p&&(p.entityMetadata={nextAutoRefreshIntervalSeconds:y?
String(y):void 0,offlineLastModifiedTimestampSeconds:u.lastModifiedTimestamp});g.QS(Q,2);return g.S(Q,wq(Z.j,{mode:"readwrite",SK:!0},function(b){var w=TL(b,p,"mainPlaylistEntity"),yv=TL(b,W,"mainPlaylistDownloadStateEntity");w=[w,yv];yv=g.m(h);for(var x9=yv.next();!x9.done;x9=yv.next())w.push(TL(b,x9.value,"mainPlaylistVideoEntity"));E&&w.push(TL(b,E,"ytMainChannelEntity"));return g.nB.all(w)}),4);
case 4:g.u8(Q,3);break;case 2:throw g.Ts(Q),FE("PES failure for playlist"),Error("PES failure for playlist");case 3:return Q.return({mainPlaylistEntity:p,CVu:E,csH:h})}})},OKa=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv,x9,qS,K7,GR,ED,oq,H,GH,L7,Rq,Qw,si,zH,Z6,av,dt,je,U,ZY,J6,xf,bo,KA,iF,ZR,t6,t,J,B,v,a,hG,r,c,R,zR,sD,JG,OD,qJ,jo,FO,sz,r4,AG,TE,vS,Ei;
return g.A(function(cS){switch(cS.j){case 1:return G=$w(u),y=u.entityKey,q=g.ZE(y).entityId,N=[],e=!1,q==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.S(cS,PH(Z.j,"musicPlaylist"),5)):g.S(cS,Bi(Z.j,y,"musicPlaylist"),4);case 4:(h=cS.U)&&N.push(h);cS.Rl(3);break;case 5:N=cS.U;case 3:if((d=N)==null||!d.length)return cS.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));K=g.C(u.actionMetadata,O8d);V=(f=K)==null?void 0:f.autoSync;X=[];l=n=!0;Y=!1;E=void 0;if(!e&&V===!1){cS.Rl(6);break}g.QS(cS,7);return g.S(cS,
q0H(0,!!V,!0,N),9);case 9:X=cS.U;g.u8(cS,8);break;case 7:W=g.Ts(cS);if(!(W instanceof Error&&W.message==="No data")){W instanceof Error&&W.message==="Empty response body"&&FE(W.message);cS.Rl(8);break}return q==="!*$_ALL_ENTITIES_!*$"?g.S(cS,Z4(Z.j,u,Z.T),8):g.S(cS,N8(q,"musicPlaylist",Z.j,u,Z.T),8);case 8:if(!X.length||!e&&X[0].playlistId!==q)return cS.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));case 6:if(e){p=[];z=g.m(X);for(L=z.next();!L.done;L=z.next())Q=L.value,Q.upToDate||
V&&!Q.shouldAutoSyncMetadata||!Q.playlistId||(b={autoSync:V},p.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Q.playlistId,"musicPlaylist",0,wN,{musicPlaylistEntityActionMetadata:b})));return cS.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,p))}X.length&&(w=X[0],Y=!!w.upToDate,V&&(n=(yv=w.shouldAutoSyncMetadata)!=null?yv:!0,l=(x9=w.shouldAutoSyncVideos)!=null?x9:!0,w.checkInSeconds&&(E=w.checkInSeconds)));if(Y||!n)return cS.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G));qS=[];K7=N[0];GR=void 0;if(!K7.downloadMetadata){cS.Rl(15);break}return g.S(cS,Bi(Z.j,K7.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:ED=cS.U,GR=Number((H=(oq=ED)==null?void 0:oq.addedTimestampMillis)!=null?H:"0")/1E3;case 15:return g.QS(cS,17),g.S(cS,fzv(Z,q,(GH=GR)==null?void 0:GH.toString(),E),19);case 19:qS=cS.U;g.u8(cS,18);break;case 17:L7=g.Ts(cS);if(!(L7 instanceof Error&&L7.message==="No data")){if(L7 instanceof Error&&L7.message==="Empty response body")FE(L7.message);
else return Rq="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Qw="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L7 instanceof g.h1&&L7.type==="QUOTA_EXCEEDED"&&(Rq="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Qw="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),cS.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,Rq,Qw));cS.Rl(18);break}return g.S(cS,N8(q,"musicPlaylist",Z.j,u,Z.T),18);case 18:if(!l)return cS.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G));si=[];zH=new Map;if((Z6=qS)==null?0:Z6.length)for(av=g.m(qS),dt=av.next();!dt.done;dt=av.next())je=dt.value,U=je.offlineVideoData,ZY=void 0,((ZY=U)==null?0:ZY.videoId)&&zH.set(U.videoId,U);J6=new Map;xf=[];if((bo=K7)==null?0:(KA=bo.tracks)==null?0:KA.length)for(iF=g.m(K7.tracks),ZR=iF.next();!ZR.done;ZR=iF.next())if(t6=ZR.value,t=g.ZE(t6).entityId)zH.has(t)?(J6.set(t,zH.get(t)),zH.delete(t)):xf.push(t);B=Number(((J=u.actionMetadata)==null?void 0:J.priority)||0)+1;v=g.m(zH.entries());for(a=v.next();!a.done;a=
v.next())hG=a.value,r=g.m(hG),c=r.next().value,R=r.next().value,zR=c,sD=R,si.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",zR,"musicTrack",B,wN,Es(u,sD)));JG=g.m(J6.entries());for(OD=JG.next();!OD.done;OD=JG.next())qJ=OD.value,jo=g.m(qJ),FO=jo.next().value,sz=jo.next().value,r4=FO,AG=sz,si.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",r4,"musicTrack",B,wN,Es(u,AG)));TE=g.m(xf);for(vS=TE.next();!vS.done;vS=TE.next())Ei=vS.value,si.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Ei,"musicTrack",
0,wN));return cS.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,si))}})},ilJ=function(){var Z,u,G;
return g.A(function(y){if(y.j==1)return g.QS(y,2),g.S(y,g.Xs(),4);if(y.j!=2){Z=y.U;if(!Z||!g.Jx()||typeof g.nh.BroadcastChannel==="undefined")return y.return();u=new Pbe;return y.return(new oK(Z,u))}G=g.Ts(y);G instanceof Error&&g.SE(G);return y.return()})},Abi=function(){CX.apply(this,arguments)},ruJ=function(Z){var u,G;
return g.A(function(y){if(y.j==1)return g.S(y,g.Xs(),2);if(y.j!=3)return(u=y.U)?g.S(y,g.V$(u),3):y.return();G=y.U;return y.return(g.Hq(G,["index","media","captions"],{mode:"readwrite",SK:!0},function(q){var N=IDBKeyRange.bound(Z+"|",Z+"~");q=[q.objectStore("index").delete(N),q.objectStore("media").delete(N),q.objectStore("captions").delete(N)];return g.nB.all(q).then(function(){})}))})},zxi=function(){CX.apply(this,arguments)},uNH=function(){return g.A(function(Z){if(Z.j==1)return g.S(Z,Wge(),2);
if(!Z.U)return Z.return(void 0);Lsk||(Lsk=new ZlJ);return Z.return(Lsk)})},vOe=function(Z,u){var G,y,q,N,e,h,d,K;
return g.A(function(f){switch(f.j){case 1:return G=$w(u),y=g.ZE(u.entityKey).entityId,g.QS(f,2),g.S(f,$D.getInstance(),4);case 4:q=f.U;if(!q)throw Error("prefStorage is undefined");return g.S(f,q.get("psi"),5);case 5:N=f.U;e=g.C(u.actionMetadata,saJ);if(((h=N)==null?void 0:h.isPaused)!==!1||(d=e)==null||!d.lastPlaybackPositionSeconds){f.Rl(6);break}K={key:g.hq(y,"videoPlaybackPositionEntity"),videoId:y,lastPlaybackPositionSeconds:e.lastPlaybackPositionSeconds};return g.S(f,GM(Z.j,K,"videoPlaybackPositionEntity"),
6);case 6:g.u8(f,3);break;case 2:return g.Ts(f),f.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return f.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},kD=function(Z){return Z.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!Z.entityKey},Sfw=function(Z,u,G,y,q){var N,e,h,d,K,f;
return g.A(function(V){switch(V.j){case 1:if(N=y){V.Rl(2);break}return g.S(V,Frd([u]),3);case 3:e=V.U,h=e[0],N=jbe(h);case 2:return g.S(V,ElJ(Z,N,u,q,G),4);case 4:d=V.U;K=d.musicTrackEntity;f=d.Lv;var X=D4(K.thumbnailDetails),n=[];f&&(n=D4(f.thumbnailDetails));return g.S(V,M8(X.concat(n)),0)}})},b8H=function(Z,u,G){var y=T0e(u);
G=H$k(G);if(!G)return g.nB.resolve([]);G=new G(u);Z=Z.j.objectStore("EntityAssociationStore");u=[];G=g.m(G.U());for(var q=G.next();!q.done;q=G.next())u.push(g.cA(Z,{parentEntityKey:y,childEntityKey:q.value}));return g.nB.all(u).then(function(N){return N.map(function(e){return e[1]})})},ata=function(Z,u){var G,y,q;
return g.A(function(N){switch(N.j){case 1:return g.QS(N,2),(G=!!u.captionTracks.length||!!u.DY)?g.S(N,JXi(u.videoId),4):N.return();case 4:return(y=N.U)?N.return():g.S(N,Rxw(Z.wH,u),5);case 5:g.u8(N,0);break;case 2:q=g.Ts(N),FE("Caption downloading error",q,u.cotn),g.pA(N)}})},CBi=function(Z,u){var G,y;
return g.A(function(q){switch(q.j){case 1:return G=$w(u),g.QS(q,2),y=g.ZE(u.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?g.S(q,Z4(Z.j,u,Z.T),5):g.S(q,N8(y,"musicPlaylist",Z.j,u,Z.T),6);case 6:return g.S(q,BcR(Z.j,u.entityKey),5);case 5:g.u8(q,3);break;case 2:return g.Ts(q),q.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},PBi=function(Z,u,G){u=u===void 0?43200:u;
G=G===void 0?!0:G;var y=y===void 0?!1:y;var q,N,e;return g.A(function(h){switch(h.j){case 1:if(!Z.X.DK())return h.return([]);q=[];g.QS(h,2);return g.S(h,pGR(u,G,y),4);case 4:q=h.U;g.u8(h,3);break;case 2:N=g.Ts(h),N instanceof Error&&N.message==="No data"||N instanceof Error&&N.message==="Empty response body"&&FE(N.message);case 3:return e=NPe(Z,q,G,"mainPlaylistEntity"),h.return(e)}})},oOs=function(){CX.apply(this,arguments)},Os=function(Z,u){u=u===void 0?!1:u;
var G;return g.A(function(y){if(y.j==1){if(Z.j)throw Error("Already downloading a video");Z.Qn=0;Z.C=!1;return g.S(y,Jh4(Z),2)}return y.j!=4?(G=y.U,Qas(Z.nV,!G),G&&Z.X.DK()?u?g.S(y,new Promise(function(q){g.sW(q,1E3)}),4):y.Rl(4):(!G&&Z.j&&jH(Z),y.Rl(0))):g.S(y,ItJ(Z,G),0)})},Sus=function(Z,u,G,y){var q=Bei(Z.U,1);
return bR(Z,u,y).then(function(N){if(N){N=g.jx(N,G);var e={key:u,entityType:y,data:Vja(q,N,u),version:1};return g.nB.all([g.cA(Z.j.objectStore("EntityStore"),e),IzH(Z,N,y)])}}).then(function(){vi(Z,u,y);
return u})},Lgi=function(Z,u,G){var y=this;
this.C=Z;this.Fn=u;this.visibility=G;this.G=this.K=this.X=this.T=this.j=!1;this.D=new g.fy(function(){y.mj()});
this.Wy={lf:function(){return y.U},
mj:function(){y.mj()},
lxn:function(){return y.D}};
this.visibility.subscribe("visibilitystatechange",function(){y.YK()})},FE=function(Z,u,G){g.h6(new g.dw("Woffle: "+Z,G?{cotn:G}:""));
u instanceof Error&&g.h6(u)},lM=function(Z,u,G,y,q,N){u=g.hq(u,G);
y=Object.assign({},N,{priority:y,retryScheduleIntervalsInSeconds:q});return{actionType:Z,entityKey:u,actionMetadata:y}},Fsk=function(Z,u,G){var y,q;
g.A(function(N){switch(N.j){case 1:if(!Z.j)return eH(Z,"onTransferProgress: "+u),N.return();if(Z.j.transferState==="TRANSFER_STATE_TRANSFERRING"){N.Rl(2);break}return g.S(N,guv(Z),2);case 2:y=Date.now();if(!(y-Z.u7>1E3)){N.Rl(4);break}Z.u7=y;return g.S(N,tUk(Z.U,G.videoId,G.U,G.tp,G.bytesDownloaded,G.j),5);case 5:if(Z.Fn&&!(Z.Fn&&y-Z.Qn>Z.sT)){N.Rl(4);break}Z.Qn=y;return g.S(N,tV(Z,u),7);case 7:q=N.U,Mpv({videoId:u,wJ:Z.j,offlineModeType:q},G.bytesDownloaded,G.j);case 4:Z.D.start(108E5),g.pA(N)}})},
cbP=function(){CX.apply(this,arguments)},gOv=function(Z,u){var G,y;
return g.A(function(q){switch(q.j){case 1:return G=$w(u),g.S(q,Bi(Z.j,u.entityKey,"transfer"),2);case 2:if(y=q.U)return q.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.QS(q,3);return g.S(q,xoi(Z,u),5);case 5:g.u8(q,4);break;case 3:return g.Ts(q),q.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return q.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},j6s=function(Z,u){var G,y,q,N,e,h,d,K;
return g.A(function(f){G=D4(Z.avatar);y=g.m(u);for(q=y.next();!q.done;q=y.next())if(N=q.value,N.id!==Z.id)for(e=g.m(D4(N.avatar)),h=e.next();!h.done;h=e.next())d=h.value,K=G.indexOf(d),K!==-1&&G.splice(K,1);return f.return(G)})},$w=function(Z){var u,G,y;
return((y=(u=Z.actionMetadata)==null?void 0:(G=u.retryScheduleIntervalsInSeconds)==null?void 0:G.length)!=null?y:0)>0},wGR=function(){CX.apply(this,arguments)},q0H=function(Z,u,G,y){var q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv,x9,qS,K7,GR,ED,oq,H,GH,L7;
return g.A(function(Rq){switch(Rq.j){case 1:return g.S(Rq,QO(),2);case 2:q=Rq.U;if(!q)return Rq.return([]);N=[];if((e=y)==null?0:e.length){N=y;Rq.Rl(3);break}return g.S(Rq,PH(q,"musicPlaylist"),4);case 4:N=Rq.U;case 3:if(!N.length)return Rq.return([]);h=[];d=Date.now()/1E3;K=g.m(N);f=K.next();case 5:if(f.done)return h.length?g.S(Rq,U6v(h),10):Rq.return([]);V=f.value;X=void 0;l=(n=(X=V)==null?void 0:X.entityMetadata)&&n.nextAutoRefreshIntervalSeconds?Number(n.nextAutoRefreshIntervalSeconds):NaN;Y=
Number.isNaN(l)?Z:l;W=E=0;p="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!V.downloadMetadata){Rq.Rl(8);break}return g.S(Rq,Bi(q,V.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:z=Rq.U,Q=L=void 0,E=Number((Q=(L=z)==null?void 0:L.addedTimestampMillis)!=null?Q:"0")/1E3,w=b=void 0,W=Number((w=(b=z)==null?void 0:b.lastModifiedTimestampMillis)!=null?w:"0")/1E3,x9=yv=void 0,p=(x9=(yv=z)==null?void 0:yv.syncState)!=null?x9:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:qS=void 0;if(G||p!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!n||Number((qS=n.lastSyncedTimestampSeconds)!=null?qS:0)+Y<=d){K7=[];GR=void 0;if((GR=V.tracks)==null?0:GR.length)for(ED=g.m(V.tracks),oq=ED.next();!oq.done;oq=ED.next())H=oq.value,K7.push(g.ZE(H).entityId);GH={playlistId:V.playlistId,videoIds:K7,offlineLastModifiedTimestamp:String(W.toFixed()),autoSync:u,offlineDateAddedTimestamp:String(E.toFixed())};h.push(GH)}f=K.next();Rq.Rl(5);break;case 10:return L7=Rq.U,Rq.return(L7)}})},Y0e=function(Z){var u,G,y;
return g.A(function(q){if(q.j==1)return u=IDBKeyRange.bound(Z+"|",Z+"~"),g.S(q,g.Xs(),2);if(q.j!=3){G=q.U;if(!G)throw g.ip("gactfv");return g.S(q,g.V$(G),3)}y=q.U;return q.return(y.getAll("captions",u))})},bKP=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l;
return g.A(function(Y){switch(Y.j){case 1:return G=$w(u),y=g.ZE(u.entityKey),q=y.entityId,N=g.C(u.actionMetadata,TRa),g.QS(Y,2),g.S(Y,Sfw(Z,q,void 0,(e=N)==null?void 0:e.track,(h=N)==null?void 0:h.albumRelease),4);case 4:if((d=N)==null?0:d.playlistId){Y.Rl(5);break}return g.S(Y,nuR(Z.j,u.entityKey),5);case 5:g.u8(Y,3);break;case 2:return K=g.Ts(Y),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.h1&&K.type==="QUOTA_EXCEEDED"&&
(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Y.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,f,V));case 3:n=Number(((X=u.actionMetadata)==null?void 0:X.priority)||0)+1;var E=(E=g.C(u.actionMetadata,TRa))?{playbackDataActionMetadata:{maximumDownloadQuality:E.maximumDownloadQuality}}:void 0;l=lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q,"playbackData",n,am4,E);return Y.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G,[l]))}})},ImJ=function(Z){return g.A(function(u){if(u.j==1)u=g.S(u,sji(),2);
else{var G=Z.Zi;var y=g.Gd();y=Object.keys(y);G=Brk(G,y);u=g.S(u,G,0)}return u})},QjP=function(Z){var u=Z.j.actions[0];
return Z.D?((u==null?void 0:u.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&Z.D[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Z.G=!0),Promise.resolve()):i$i(Z)},i8e=function(Z){var u,G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv,x9,qS,K7,GR,ED,oq,H,GH,L7,Rq,Qw,si,zH,Z6,av,dt;
return g.A(function(je){if(je.j==1)return g.S(je,wq(Z,{mode:"readonly",SK:!0},function(U){return xD(U,"playbackData").then(function(ZY){var J6=ZY.map(function(iF){return iF.transfer}).filter(function(iF){return!!iF}),xf=ZY.map(function(iF){return iF.offlineVideoPolicy}).filter(function(iF){return!!iF}),bo=ZY.filter(function(iF){return!!iF.key}).map(function(iF){return g.hq(g.ZE(iF.key).entityId,"downloadStatusEntity")});
J6=xD(U,"transfer",J6);xf=xD(U,"offlineVideoPolicy",xf);bo=xD(U,"downloadStatusEntity",bo);var KA=J6.then(function(iF){iF=iF.reduce(function(ZR,t6){(t6==null?0:t6.offlineVideoStreams)&&ZR.push.apply(ZR,g.bg(t6.offlineVideoStreams));return ZR},[]).filter(function(ZR){return!!ZR});
return xD(U,"offlineVideoStreams",iF)});
return g.nB.all([J6,xf,KA,bo]).then(function(iF){var ZR=g.m(iF);iF=ZR.next().value;var t6=ZR.next().value;var t=ZR.next().value;ZR=ZR.next().value;return[ZY,iF,t6,t,ZR]})})}),2);
if(je.j!=3)return u=je.U,g.S(je,wq(Z,{mode:"readonly",SK:!0},function(U){return xD(U,"mainDownloadsListEntity").then(function(ZY){var J6,xf;return(xf=(J6=ZY[0])==null?void 0:J6.downloads)!=null?xf:[]})}),3);
G=je.U;y=g.m(u);q=y.next().value;N=y.next().value;e=y.next().value;h=y.next().value;d=y.next().value;K=q;f=N;V=e;X=h;n=d;l={};Y={};E={};W={};p={};z=[];L=g.m(f);for(Q=L.next();!Q.done;Q=L.next())(b=Q.value)&&(l[b.key]=b);w=g.m(V);for(yv=w.next();!yv.done;yv=w.next())(x9=yv.value)&&(Y[x9.key]=x9);qS=g.m(n);for(K7=qS.next();!K7.done;K7=qS.next())(GR=K7.value)&&(E[GR.key]=GR);ED=g.m(X);for(oq=ED.next();!oq.done;oq=ED.next())(H=oq.value)&&(W[H.key]=H);GH=g.m(G);for(L7=GH.next();!L7.done;L7=GH.next())Rq=
L7.value,Qw=void 0,p[(Qw=Rq.videoItem)!=null?Qw:""]=!0,Rq.videoItem&&(zH=si=void 0,Z6=(zH=(si=g.ZE(Rq.videoItem))==null?void 0:si.entityId)!=null?zH:"",z.push({externalVideoId:Z6}));av=K.filter(function(U){if(!U||!U.key||!U.offlineVideoPolicy)return!1;U=g.ZE(U.key).entityId;U=g.hq(U,"downloadStatusEntity");var ZY;return!(U&&((ZY=E[U])==null?void 0:ZY.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
dt=av.map(function(U){var ZY=l[U.transfer],J6=[];if(ZY==null?0:ZY.offlineVideoStreams)for(var xf=g.m(ZY.offlineVideoStreams),bo=xf.next();!bo.done;bo=xf.next())(bo=W[bo.value])&&J6.push(bo);xf=Y[U.offlineVideoPolicy];bo=p;var KA=U==null?void 0:U.playerResponseTimestamp,iF=g.ZE(xf.key).entityId;U=g.hq(iF,"mainVideoEntity");if(xf.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var ZR="OFFLINE_VIDEO_STATE_DISABLED";xf.expirationTimestamp&&Number(xf.expirationTimestamp)<Date.now()/1E3&&(ZR="OFFLINE_VIDEO_STATE_EXPIRED")}else if(xf.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")ZR="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(ZY==null?void 0:ZY.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":ZR="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":ZR="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":ZR="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":ZR="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":ZR="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":ZR="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:ZR="OFFLINE_VIDEO_STATE_UNKNOWN"}if(ZR==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(ZY==null?void 0:ZY.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":ZR="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":ZR="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":ZR=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}iF={id:iF,videoState:ZR};if(ZY==null?0:ZY.cotn)iF.cotn=ZY.cotn;if(ZY==null?0:ZY.maximumDownloadQuality)iF.selectedVideoQuality=ZY==null?void 0:ZY.maximumDownloadQuality;if(ZY==null?0:ZY.lastProgressTimeMs)iF.lastProgressTimeMs=ZY.lastProgressTimeMs;KA&&(iF.playerResponseSavedTimeMs=String(Number(KA)*1E3));ZY=String;KA=0;J6=g.m(J6);for(ZR=J6.next();!ZR.done;ZR=J6.next())if(ZR=ZR.value,ZR.streamsProgress){ZR=g.m(ZR.streamsProgress);for(var t6=ZR.next();!t6.done;t6=
ZR.next()){var t=void 0;KA+=Number((t=t6.value.numBytesDownloaded)!=null?t:0)}}iF.downloadedBytes=ZY(KA);iF.selectedOfflineMode=bo[U]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";xf.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(iF.offlinePlaybackDisabledReason=xf.offlinePlaybackDisabledReason);return iF});
return je.return({offlineVideos:dt,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:z}}})})},$6k=function(){CX.apply(this,arguments)},rbJ=function(Z,u){var G,y,q,N,e,h,d,K,f,V;
return g.A(function(X){switch(X.j){case 1:return G=$w(u),g.QS(X,2),y=g.ZE(u.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?g.S(X,KTJ(Z.j,u,Z.T,(f=u.actionMetadata)==null?void 0:(V=f.offlineLoggingData)==null?void 0:V.offlineDeleteReason),5):g.S(X,bM(Z.j,y),6);case 6:q=X.U;N=g.C(u.actionMetadata,nF);if(h=(e=N)==null?void 0:e.playlistId)q.playlistId=h;q.offlineDeleteReason=(d=u.actionMetadata)==null?void 0:(K=d.offlineLoggingData)==null?void 0:K.offlineDeleteReason;return g.S(X,CF(y,Z.j,u,Z.T,q),7);
case 7:if(!Z.W.S("woffle_enable_main_downloads_library")){X.Rl(5);break}return g.S(X,VtJ(Z.j,u.entityKey),5);case 5:g.u8(X,3);break;case 2:return g.Ts(X),X.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},iKe=function(Z,u){this.j=Z;
this.T=u},kmw=function(){CX.apply(this,arguments)},hV=function(Z){var u,G;
return g.A(function(y){if(y.j==1)return g.S(y,uNH(),2);if(y.j!=3){u=y.U;if(!u)throw Error("Cache API not supported");return Z.length?g.S(y,u.open("yt-player-local-img"),3):y.return()}G=y.U;return g.S(y,Promise.all(Z.map(function(q){return G.delete(q)})),0)})},oli=function(Z){var u;
return g.A(function(G){if(G.j==1){u=Z.mutations;if(!u||u.length<=0)return G.return();if(g.c3){var y={type:"ENTITY_LOADED"};u!==void 0&&(y.payload=u);g.c3.dispatch(y)}return g.S(G,Rje(u),2)}u.length=0;g.pA(G)})},Aoa=function(){this.locks=navigator.locks},wyk=function(Z,u){var G,y,q,N,e;
return g.A(function(h){if(h.j==1)return G=g.ZE(u.key),y=G.entityId,q=g.hq(y,"playbackData"),g.S(h,Bi(Z.U,q,"playbackData"),2);N=h.U;if((e=N)==null?0:e.playerResponseJson)return h.return(JSON.parse(N.playerResponseJson));throw Error("No PlayerResponse found");})},Qas=function(Z,u){Z.j&&(Z.K=u,QC(Z))},wq=function(Z,u,G){var y,q,N,e;
return g.A(function(h){if(h.j==1)return g.S(h,YFe(Z.token),2);if(h.j!=3)return y=h.U,g.S(h,g.Hq(y,["EntityStore","EntityAssociationStore"],u,function(d){q=new ZGP(d,Z.j);return G(q)}),3);
N=h.U;q&&(e=q.T,Object.keys(e).length>0&&(Z.channel.postMessage(e),HKJ(Z,e)));return h.return(N)})},ucv=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p;
return g.A(function(z){switch(z.j){case 1:return G=$w(u),y=g.ZE(u.entityKey),q=y.entityId,N=[],g.QS(z,2),g.S(z,p1J(Z,q),4);case 4:N=z.U;if(!(Z.W.S("woffle_enable_main_downloads_library")&&((e=N)==null?0:e.length))){z.Rl(5);break}return g.S(z,Tri(Z.j,[u.entityKey]),5);case 5:g.u8(z,3);break;case 2:return h=g.Ts(z),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.h1&&h.type==="QUOTA_EXCEEDED"?(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):FE("Playlist add error"),z.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,d,K));case 3:f=[];if(!Z.W.S("html5_offline_prevent_redownload_downloaded_video")){z.Rl(7);break}return g.S(z,ltH(Z.j,"mainVideoEntity",N),8);case 8:N=z.U;case 7:if((V=N)==null?0:V.length)for(X=g.m(N),n=X.next();!n.done;n=X.next())if(l=n.value,Y=l.offlineVideoData,E=void 0,(E=Y)==null?0:E.videoId)W=void 0,p=Number(((W=u.actionMetadata)==null?void 0:W.priority)||
0)+1,f.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y.videoId,"mainVideoEntity",p,ZA,EGv(u,Y,q)));return z.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,f))}})},axw=function(Z,u){return wq(Z,{mode:"readwrite",
SK:!0},function(G){return CKe(G,u,"offlineOrchestrationActionWrapperEntity")})},GOH=function(){CX.apply(this,arguments)},KsH=function(Z,u){Z=g.m(Z.actions);
for(var G=Z.next();!G.done;G=Z.next())if(G.value.actionId===u)return!0;return!1},F9=function(Z,u,G,y){G=G===void 0?!1:G;
y=y===void 0?!0:y;u=typeof u==="string"?u:u.videoDetails.videoId;if(g.Fv(u)===2){var q=Gee(Z,u);q&&q.stopVideo();g.M0(u,2);Z.T=2;G?o4i(Z.j):y&&yys(Z.j)}},yys=function(Z){var u,G,y;
g.A(function(q){if(q.j==1){if(!Z.j)return eH(Z,"onTransferPausedByNetwork"),q.return();Z.D.stop();return g.S(q,Wi(Z,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(q.j!=3)return u=Z.j,(y=((G=u)==null?0:G.key)?g.ZE(u.key).entityId:"")&&Z.T?g.S(q,kw(y,Z.T,Z.U,"DOWNLOAD_STATE_PAUSED"),3):q.Rl(3);jH(Z);g.pA(q)})},q8v=function(){CX.apply(this,arguments)},BcR=function(Z,u){var G,y,q,N,e,h,d;
return g.A(function(K){if(K.j==1)return G=g.hq("music_downloads_library_id","musicDownloadsLibraryEntity"),g.S(K,Bi(Z,G,"musicDownloadsLibraryEntity"),2);y=K.U;if(!y)return K.Rl(0);q=g.ZE(u).entityType;q==="musicTrack"?N=y.downloadedTracks:q==="musicPlaylist"&&(N=y.downloadedPlaylists);if((e=N)==null?0:e.length)for(h=0;h<N.length;h++)if(d=N[h],d===u){N.splice(h,1);break}return g.S(K,GM(Z,y,"musicDownloadsLibraryEntity"),0)})},U6v=function(Z){var u,G,y,q,N,e,h,d;
return g.A(function(K){switch(K.j){case 1:return u=g.Mt(),G=Nz4(Z),y=g.dW(emi),g.QS(K,2),N={aL:!0},g.S(K,g.KI(u,G,y,void 0,N),4);case 4:q=K.U;g.u8(K,3);break;case 2:e=g.Ts(K);if(e instanceof g.u$)throw h="offlinePlaylistSyncCheck network manager error: "+e.message,FE(h,e),Error(h);FE("offlinePlaylistSyncCheck fetch request error",e);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:d=cH(q);if(!q)throw FE("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(d!==void 0)gq(d,"playlist sync");else if(!q.offlinePlaylistSyncCheckDatas||!q.offlinePlaylistSyncCheckDatas.length)throw FE("No data for playlist sync"),Error("No data for playlist sync");return K.return(q.offlinePlaylistSyncCheckDatas.map(function(f){return f.offlinePlaylistSyncCheckData}))}})},x7a=function(){CX.apply(this,arguments)},hmi=function(){CX.apply(this,arguments)},d7s=function(){CX.apply(this,arguments)},uv=function(Z){this.j=Z},ZKP=function(Z,u,G,y){var q,N,e,h,d,K,f,V,X,n,l,Y,E;
return g.A(function(W){switch(W.j){case 1:G||(G=Date.now().toString());N=(q=u.channel)==null?void 0:q.offlineChannelData;e={id:g.hq(u.videoId,"ytMainChannelEntity"),channelId:N.channelId,title:N.title,avatar:N.thumbnail};h={key:g.hq(u.videoId,"mainVideoDownloadStateEntity"),playbackData:g.hq(u.videoId,"playbackData"),addedTimestampMillis:G,videoDownloadContextEntity:g.hq(u.videoId,"videoDownloadContextEntity")};d={key:g.hq(u.videoId,"videoPlaybackPositionEntity"),videoId:u.videoId,lastPlaybackPositionSeconds:"0"};
Z.W.S("html5_offline_playback_position_sync")&&(K={playbackPosition:d.key});f=g.hq(u.videoId,"mainVideoEntity");V={key:f,videoId:u.videoId,title:u.title,thumbnail:u.thumbnail,localizedStrings:{viewCount:u.shortViewCountText},userState:K,lengthSeconds:u.lengthSeconds?Number(u.lengthSeconds):void 0,publishedTimestampMillis:u.publishedTimestamp?(Number(u.publishedTimestamp)*1E3).toString():void 0,formattedDescription:u.description,owner:e.id,downloadState:h.key};if(!Z.W.S("woffle_enable_main_downloads_library")||
!y){W.Rl(2);break}return g.S(W,wCJ(Z.j,[f]),3);case 3:if(l=W.U)X=l.mainDownloadsLibraryEntity,n=l.mainDownloadsListEntity;case 2:return E=gHa,Y={key:g.hq(u.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.qi(h,E,Y),g.S(W,wq(Z.j,{mode:"readwrite",SK:!0},function(p){var z=TL(p,e,"ytMainChannelEntity"),L=TL(p,h,"mainVideoDownloadStateEntity"),Q=TL(p,V,"mainVideoEntity");z=[z,L,Q];Z.W.S("html5_offline_playback_position_sync")&&(L=TL(p,d,"videoPlaybackPositionEntity"),
z.push(L));X&&(L=TL(p,X,"mainDownloadsLibraryEntity"),z.push(L));n&&(L=TL(p,n,"mainDownloadsListEntity"),z.push(L));Y&&(p=TL(p,Y,"downloadStatusEntity"),z.push(p));return g.nB.all(z)}),4);
case 4:return W.return({mainVideoEntity:V,channelEntity:e})}})},xCs=function(Z){Z.j&&(Z.G=!0,QC(Z))},ZGP=function(Z,u){this.j=Z;
this.U=u;this.T={}},Kq4=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv,x9,qS,K7,GR,ED,oq,H,GH,L7,Rq,Qw,si,zH,Z6,av,dt,je,U,ZY,J6,xf,bo,KA,iF,ZR,t6,t,J,B,v,a,hG,r,c,R,zR,sD,JG,OD,qJ,jo,FO,sz,r4,AG,TE,vS,Ei,cS,EK,HP;
return g.A(function(is){switch(is.j){case 1:return G=$w(u),y=u.entityKey,q=g.ZE(y).entityId,N=[],e=!1,q==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.S(is,PH(Z.j,"mainPlaylistEntity"),5)):g.S(is,Bi(Z.j,y,"mainPlaylistEntity"),4);case 4:(h=is.U)&&N.push(h);is.Rl(3);break;case 5:N=is.U;case 3:if((d=N)==null||!d.length)return is.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));K=g.C(u.actionMetadata,JNs);V=(f=K)==null?void 0:f.nextAutoRefreshIntervalSeconds;n=(X=K)==null?void 0:X.autoSync;l=[];E=Y=
!0;W=!1;if(!e&&n===!1){is.Rl(6);break}g.QS(is,7);return g.S(is,pGR(0,!!n,!0,N),9);case 9:l=is.U;g.u8(is,8);break;case 7:p=g.Ts(is);if(!(p instanceof Error&&p.message==="No data")){p instanceof Error&&p.message==="Empty response body"&&FE(p.message);is.Rl(8);break}return q==="!*$_ALL_ENTITIES_!*$"?g.S(is,KTJ(Z.j,u,Z.T,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.S(is,fPd(q,Z.j,u,Z.T),8);case 8:if(!l.length||!e&&l[0].playlistId!==q)return is.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G));case 6:if(e){z=[];L=g.m(l);for(Q=L.next();!Q.done;Q=L.next())b=Q.value,b.upToDate||n&&!b.shouldAutoSyncMetadata||!b.playlistId||(w={nextAutoRefreshIntervalSeconds:b.checkInSeconds,autoSync:n},z.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b.playlistId,"mainPlaylistEntity",0,ZA,{mainPlaylistEntityActionMetadata:w})));return is.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,z))}l.length&&(yv=l[0],W=!!yv.upToDate,n&&(Y=(x9=yv.shouldAutoSyncMetadata)!=null?x9:!0,E=(qS=yv.shouldAutoSyncVideos)!=
null?qS:!0,yv.checkInSeconds&&(V=yv.checkInSeconds)));if(W||!Y)return is.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));K7=[];GR=N[0];if(!GR.downloadState){ED=void 0;is.Rl(15);break}return g.S(is,Bi(Z.j,GR.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:ED=is.U;case 15:return oq=ED,GH=((H=oq)==null?0:H.addedTimestampMillis)?String(oq.addedTimestampMillis):void 0,g.QS(is,17),g.S(is,p1J(Z,q,GH,V),19);case 19:K7=is.U;g.u8(is,18);break;case 17:L7=g.Ts(is);if(!(L7 instanceof
Error&&L7.message==="No data for playlist")){if(L7 instanceof Error&&L7.message==="Empty response body for playlist")FE(L7.message);else return Rq="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Qw="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L7 instanceof g.h1&&L7.type==="QUOTA_EXCEEDED"&&(Rq="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Qw="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),is.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,Rq,Qw));
is.Rl(18);break}return g.S(is,fPd(q,Z.j,u,Z.T),18);case 18:if(!E)return is.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));si=[];zH=new Map;if((Z6=K7)==null?0:Z6.length)for(av=g.m(K7),dt=av.next();!dt.done;dt=av.next())je=dt.value,U=je.offlineVideoData,ZY=void 0,((ZY=U)==null?0:ZY.videoId)&&zH.set(U.videoId,U);J6=new Map;xf=[];if((bo=GR)==null?0:(KA=bo.videos)==null?0:KA.length)for(iF=g.m(GR.videos),ZR=iF.next();!ZR.done;ZR=iF.next())if(t6=ZR.value,t=JSON.parse(g.ZE(t6).entityId),
J=t.videoId)zH.has(J)?(J6.set(J,zH.get(J)),zH.delete(J)):xf.push(J);v=Number(((B=u.actionMetadata)==null?void 0:B.priority)||0)+1;a=g.m(zH.entries());for(hG=a.next();!hG.done;hG=a.next())r=hG.value,c=g.m(r),R=c.next().value,zR=c.next().value,sD=R,JG=zR,si.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",sD,"mainVideoEntity",v,ZA,EGv(u,JG,q)));OD=g.m(J6.entries());for(qJ=OD.next();!qJ.done;qJ=OD.next())jo=qJ.value,FO=g.m(jo),sz=FO.next().value,r4=FO.next().value,AG=sz,TE=r4,si.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
AG,"mainVideoEntity",v,ZA,EGv(u,TE,q)));vS=g.m(xf);for(Ei=vS.next();!Ei.done;Ei=vS.next())cS=Ei.value,EK={playlistId:q},HP={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:EK},si.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",cS,"mainVideoEntity",0,ZA,HP));return is.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,si))}})},feH=function(){CX.apply(this,arguments)},vl4=function(Z){var u;
Z=(u=Z.options)==null?void 0:u.persistenceOption;return Z==="ENTITY_PERSISTENCE_OPTION_PERSIST"||Z==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},BRJ=function(Z,u,G,y){if(Z&&Z.streamsProgress){y=Z;
a:{u=u.itag+";"+u.xtags;for(var q=Z.streamsProgress,N=0;N<q.length;N++){var e=JSON.parse(q[N].formatStreamBytes);if(e.itag+";"+e.xtags===u){q[N]=G;G=q;break a}}q.push(G);G=q}y.streamsProgress=G}else Z={key:y,streamsProgress:[G]};return Z},VVk=function(Z){return g.A(function(u){if(u.j==1)return Z.G?g.S(u,zM(Z.K,Z.G.videoDetails.videoId),3):u.Rl(0);
jH(Z);g.pA(u)})},Xte=function(){CX.apply(this,arguments)},nEi=function(){CX.apply(this,arguments)},B0w=function(){lei||(lei=new tje);
return lei},D7J=function(Z){mF({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},Z)},MVk=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv,x9,qS,K7,GR,ED,oq,H,GH,L7,Rq,Qw,si,zH,Z6,av,dt,je,U,ZY,J6,xf,bo,KA,iF,ZR,t6,t,J,B,v,a,hG,r,c,R,zR;
return g.A(function(sD){switch(sD.j){case 1:return G=$w(u),y=u.entityKey,q=g.ZE(y).entityId,N=[],e=!1,q==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.S(sD,PH(Z.j,"musicAlbumRelease"),5)):g.S(sD,Bi(Z.j,y,"musicAlbumRelease"),4);case 4:(h=sD.U)&&N.push(h);sD.Rl(3);break;case 5:N=sD.U;case 3:if((d=N)==null||!d.length)return sD.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));if(e){K=[];f=g.m(N);for(V=f.next();!V.done;V=f.next())X=V.value,n=g.ZE(X.id).entityId,K.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
n,"musicAlbumRelease",0,LF));return sD.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,K))}l=[];Y=N[0];E=void 0;if(!Y.downloadMetadata){sD.Rl(6);break}return g.S(sD,Bi(Z.j,Y.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:W=sD.U,E=Number((z=(p=W)==null?void 0:p.addedTimestampMillis)!=null?z:"0")/1E3;case 6:return g.QS(sD,8),g.S(sD,Xye(Z,q,(L=E)==null?void 0:L.toString()),10);case 10:l=sD.U;g.u8(sD,9);break;case 8:Q=g.Ts(sD);if(!(Q instanceof Error&&Q.message===
"No data")){if(Q instanceof Error&&Q.message==="Empty response body")FE(Q.message);else return b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.h1&&Q.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),sD.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,b,w));sD.Rl(9);break}return g.S(sD,N8(q,"musicAlbumRelease",Z.j,
u,Z.T),9);case 9:yv=[];x9=new Map;if((qS=l)==null?0:qS.length)for(K7=g.m(l),GR=K7.next();!GR.done;GR=K7.next())ED=GR.value,oq=ED.offlineVideoData,H=void 0,((H=oq)==null?0:H.videoId)&&x9.set(oq.videoId,oq);GH=new Map;L7=[];if((Rq=Y)==null?0:(Qw=Rq.tracks)==null?0:Qw.length)for(si=g.m(Y.tracks),zH=si.next();!zH.done;zH=si.next())if(Z6=zH.value,av=g.ZE(Z6).entityId)x9.has(av)?(GH.set(av,x9.get(av)),x9.delete(av)):L7.push(av);je=Number(((dt=u.actionMetadata)==null?void 0:dt.priority)||0)+1;U=g.m(x9.entries());
for(ZY=U.next();!ZY.done;ZY=U.next())J6=ZY.value,xf=g.m(J6),bo=xf.next().value,KA=xf.next().value,iF=bo,ZR=KA,yv.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",iF,"musicTrack",je,LF,Es(u,ZR)));t6=g.m(GH.entries());for(t=t6.next();!t.done;t=t6.next())J=t.value,B=g.m(J),v=B.next().value,a=B.next().value,hG=v,r=a,yv.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",hG,"musicTrack",je,LF,Es(u,r)));c=g.m(L7);for(R=c.next();!R.done;R=c.next())zR=R.value,yv.push(lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
zR,"musicTrack",0,LF));return sD.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,yv))}})},oz=function(Z){this.j=Z},dXd=function(Z){var u,G,y,q,N,e,h,d;
return g.A(function(K){switch(K.j){case 1:return u=g.Mt(),G=v4s(Z),y=g.dW(QCJ),g.QS(K,2),N={aL:!0},g.S(K,g.KI(u,G,y,void 0,N),4);case 4:q=K.U;g.u8(K,3);break;case 2:e=g.Ts(K);if(e instanceof g.u$)throw h="GetOffline network manager error for playlist: "+e.message,FE(h,e),Error(h);FE("GetOffline fetch request error for playlist",e);throw Error("GetOffline fetch request error for playlist");case 3:d=cH(q);if(!q)throw FE("Network request failed for playlist"),Error("Network request failed for playlist");
if(d!==void 0)gq(d,"playlist");else if(!q.playlists||!q.playlists.length)throw FE("No data for playlist"),Error("No data for playlist");return K.return(q.playlists.map(function(f){return f.offlinePlaylistData}))}})},m7v=function(){CX.apply(this,arguments)},jH=function(Z){Z.j=void 0;
Z.G=void 0;Z.D.stop()},nuR=function(Z,u){var G,y,q,N,e,h,d,K,f;
return g.A(function(V){if(V.j==1)return G=g.hq("music_downloads_library_id","musicDownloadsLibraryEntity"),g.S(V,Bi(Z,G,"musicDownloadsLibraryEntity"),2);(y=V.U)||(y={id:G});q=g.ZE(u).entityType;q==="musicTrack"?(N=y.downloadedTracks)!=null&&N.includes(u)||(y.downloadedTracks=((e=y.downloadedTracks)!=null?e:[]).concat(u)):q==="musicPlaylist"?(h=y.downloadedPlaylists)!=null&&h.includes(u)||(y.downloadedPlaylists=((d=y.downloadedPlaylists)!=null?d:[]).concat(u)):q!=="musicAlbumRelease"||(K=y.downloadedAlbumReleases)!=
null&&K.includes(u)||(y.downloadedAlbumReleases=((f=y.downloadedAlbumReleases)!=null?f:[]).concat(u));return g.S(V,GM(Z,y,"musicDownloadsLibraryEntity"),0)})},FTa=function(Z){var u;
Z=g.C((u=Z.getWatchNextResponse())==null?void 0:u.currentVideoEndpoint,g.hH);if(Z==null?0:Z.playlistId)var G=Z.playlistId;return G},Y8e=function(Z,u){u.length!==0&&u.forEach(function(G){G=dN(G);
G.retryScheduleIndex<3&&GKa(Z.j,[G])})},Nz4=function(Z){return{context:g.GF(),
offlinePlaylistSyncChecks:Z}},JyJ=function(Z,u){u=u===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":u;
var G,y,q,N;return g.A(function(e){if(e.j==1)return Z.j||eH(Z,"setTransferToFailed: "+u),G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u==="TRANSFER_FAILURE_REASON_NETWORK"?G="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":u==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.S(e,Wi(Z,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",u),2);if(e.j!=3)return X9(Z.UT,{entityKey:(y=Z.j)==null?void 0:y.key,failureReason:G}),
q=Z.j?g.ZE(Z.j.key).entityId:"",g.S(e,tV(Z,q),3);N=e.U;var h={videoId:q,wJ:Z.j,offlineModeType:N},d=u,K={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};d&&(K.transferFailureReason=d,K.failureReason=sCk(d));mF(K,h);g.pA(e)})},JoR=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n;
return g.A(function(l){G=[];y=Infinity;q=4E3;N=g.m(u);for(e=N.next();!e.done;e=N.next())h=e.value,d=Number(h.enqueueTimeSec),K=DXe(d),f=h.retryScheduleIndex,V=f!=null&&f>0,K>0&&V?(y=Math.min(y,d),q=Math.min(K,q)):G.push(h);isFinite(y)&&(!Z.T.isActive()||y<Z.C)&&(Z.C=y,Z.T.start(q));Z.X.DK()||(X=G.length,G=G.filter(function(Y){var E;Y=((E=Y.actionProto)==null?void 0:E.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!EEP.includes(Y)}),n=G.length<X,!Z.T.isActive()&&n&&Z.T.start(1));
G.length>0&&Y8e(Z,G);return g.S(l,QjP(Z),0)})},pQw=function(Z,u,G,y){if(!Z.action.entityKey)throw Error("entityKey is missing.");
var q=g.ZE(Z.action.entityKey);q={entityType:q.O0,entityId:q.entityId,offlineOrchestrationActionType:Z.action.actionType,orchestrationAction:{orchestrationActionId:Z.actionId}};u&&(q.offlineOrchestrationActionResult=u.status,q.isRetryable=G?!1:u.j,u.T&&(q.offlineOrchestrationFailureReason=EHk(u.T,q.isRetryable)));var N,e;if((N=Z.action.actionMetadata)==null?0:(e=N.offlineLoggingData)==null?0:e.offlineModeType)q.offlineModeType=Z.action.actionMetadata.offlineLoggingData.offlineModeType;y&&(q.additionalOrchestrationActions=
y.map(function(h){return{orchestrationActionId:h.actionId}}));
return q},Wi=function(Z,u,G,y){var q;
return g.A(function(N){if(N.j==1){if(!Z.j)return eH(Z,"saveTransferState: "+u),N.return();Z.j.transferState=u;Z.j.failureReason=y;g.QS(N,2);return g.S(N,cXv(Z,function(e){return G?xD(e,"offlineVideoStreams",Z.j.offlineVideoStreams).then(function(h){for(var d=g.m(h),K=d.next();!K.done;K=d.next())if((K=K.value)&&K.streamsProgress){K=g.m(K.streamsProgress);for(var f=K.next();!f.done;f=K.next())f.value.streamState=G}return CKe(e,h.filter(function(V){return!!V}),"offlineVideoStreams")}):g.nB.resolve(void 0)}),
4)}if(N.j!=2)return g.u8(N,0);
q=g.Ts(N);return q instanceof g.h1&&q.type==="QUOTA_EXCEEDED"?g.S(N,Z.p$("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):N.Rl(0)})},U7i=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E;
return g.A(function(W){switch(W.j){case 1:return G=$w(u),y=g.ZE(u.entityKey),q=y.entityId,g.S(W,Bi(Z.j,u.entityKey,"musicTrack"),2);case 2:N=W.U;if(!N){e=void 0;W.Rl(3);break}return g.S(W,Bi(Z.j,N.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:e=W.U;case 3:h=e;if(!N||!h)return W.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));K=g.C(u.actionMetadata,TRa);g.QS(W,5);return g.S(W,Sfw(Z,q,h.addedTimestampMillis,(f=K)==null?void 0:f.track,(V=K)==null?void 0:V.albumRelease),
7);case 7:n=Number(((X=u.actionMetadata)==null?void 0:X.priority)||0)+1;d=lM("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q,"playbackData",n,am4);g.u8(W,6);break;case 5:l=g.Ts(W);if(!(l instanceof Error&&l.message==="No data")){if(l instanceof Error&&l.message==="Empty response body")FE(l.message);else return Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.h1&&l.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),W.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,Y,E));W.Rl(6);break}return g.S(W,uM(q,Z.j,u,Z.T),6);case 6:return W.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,d?[d]:void 0))}})},IPe=function(Z,u){var G,y,q,N,e,h,d,K;
return g.A(function(f){G=D4(Z.thumbnailDetails);y=g.m(u);for(q=y.next();!q.done;q=y.next())if(N=q.value,N.id!==Z.id)for(e=g.m(D4(N.thumbnailDetails)),h=e.next();!h.done;h=e.next())d=h.value,K=G.indexOf(d),K!==-1&&G.splice(K,1);return f.return(G)})},Hee=function(Z){return g.A(function(u){return u.return(iyJ(Z))})},fF=function(Z,u){if(Z&&Z.transferState!=="TRANSFER_STATE_COMPLETE"&&Z.transferState!=="TRANSFER_STATE_FAILED"){var G=g.ZE(Z.key).entityId;
mF({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:G,wJ:Z,offlineModeType:u})}},WTk=function(Z,u){a:{Z=Bei(Z.U,u.version);
try{var G=Z.U(u.data,u.key);break a}catch(y){KQe(y,n4a)}G=void 0}return G},pte=function(){CX.apply(this,arguments)},HGa=function(Z,u,G){this.j=Z;
this.W=u;this.T=G},BzJ=function(){CX.apply(this,arguments)},Rxw=function(Z,u){var G,y,q,N;
return g.A(function(e){G=u.videoId;y=!0;if(u.captionTracks.length)q=Cxd(u),Z.j=new g.nP(Z.KV,u,q);else if(u.DY)N=g.mHY(u),Z.j=new g.mp(Z.KV,u.DY,G,N,u.BF,u.eventId),y=u.BF;else return e.return();return e.return(new Promise(function(h){var d;(d=Z.j)==null||d.zF({Po:function(){return g.A(function(K){if(K.j==1)return g.S(K,Z.Po(G,y),2);h();g.pA(K)})},
ib:function(){}})}))})},rq=function(Z,u,G,y,q,N){this.status=Z;
this.j=u;this.D=G;this.U=y;this.T=q;this.downloadState=N},tVd=function(Z,u){var G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv,x9;
return g.A(function(qS){switch(qS.j){case 1:return G=u.entityKey,y=g.ZE(G).entityId,g.S(qS,wq(Z.j,{mode:"readonly",SK:!0},function(K7){var GR=bR(K7,G,"playbackData"),ED=bR(K7,g.hq(y,"offlineVideoPolicy"),"offlineVideoPolicy");K7=bR(K7,g.hq(y,"transfer"),"transfer");return g.nB.all([GR,ED,K7])}),2);
case 2:q=qS.U;N=g.m(q);e=N.next().value;h=N.next().value;d=N.next().value;K=e;f=h;V=d;if(!K||!f)return qS.return(gN(u,!0));X=[];Y=((l=K)==null?0:l.playerResponseJson)?JSON.parse(K.playerResponseJson):null;if(!(V&&Y&&Z.W.S("html5_refresh_deprecated_downloads"))){qS.Rl(3);break}n=Wsi(Z,Y,V);return g.S(qS,xXv(Z,V),4);case 4:X=qS.U;case 3:E={lastPlayerResponseTimestampSeconds:K.playerResponseTimestamp,offlineToken:f.offlineToken,formatIds:X};W={};if((p=V)==null?0:p.maximumDownloadQuality)W.maximumDownloadQuality=
V.maximumDownloadQuality;g.QS(qS,5);z=void 0;return g.S(qS,RyJ(Z,u),7);case 7:return z=qS.U,g.QS(qS,8),g.S(qS,ClR(G,Z.W,{refreshData:E,wO:W,offlineSourceData:z,mediaCapabilities:n}),10);case 10:L=qS.U;g.u8(qS,9,5);break;case 8:return g.Ts(qS,5),Q=$w(u)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",FE("PDE handleRefresh error"),qS.return(gN(u,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",Q,"DOWNLOAD_STATE_FAILED"));
case 9:return g.S(qS,PlH(Z,L,u),11);case 11:return qS.return(gN(u,!0,L.orchestrationActions));case 5:return b=g.Ts(qS),w="PDE handleRefresh error",b instanceof Error&&(w="PDE handleRefresh error: "+b.message),yv="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x9="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.h1&&b.type==="QUOTA_EXCEEDED"&&(yv="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x9="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),FE(w),qS.return(gN(u,
!1,void 0,yv,x9,"DOWNLOAD_STATE_FAILED"))}})},Wqs=function(){oz.apply(this,arguments)},jmk=function(){CX.apply(this,arguments)},OGs=function(Z,u){var G,y,q,N,e,h,d,K,f,V;
return g.A(function(X){switch(X.j){case 1:return G=$w(u),y=g.ZE(u.entityKey).entityId,g.S(X,wq(Z.j,{mode:"readonly",SK:!0},function(n){var l=bR(n,u.entityKey,"transfer");n=bR(n,g.hq(y,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.nB.all([l,n])}),2);
case 2:q=X.U;N=g.m(q);e=N.next().value;h=N.next().value;d=e;K=h;if(!d||d.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return X.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.QS(X,3);d.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.S(X,GM(Z.j,d,"transfer"),5);case 5:f=g.ZE(d.key).entityId;D7J({videoId:f,wJ:d,offlineModeType:(V=K)==null?void 0:V.offlineModeType});g.u8(X,4);break;case 3:return g.Ts(X),X.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return X.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},ClR=function(Z,u,G){var y,q,N,e,h,d,K,f;
return g.A(function(V){switch(V.j){case 1:y=g.Mt();var X=G.refreshData,n=G.isEnqueuedForExpiredStreamUrlRefetch,l=G.wO,Y=G.offlineSourceData,E=G.mediaCapabilities,W={entityKey:Z};X&&(W.refreshData=X);n&&(W.isExpiredStreamUrlRefetch=n);l&&(W.downloadParameters=l);Y&&(W.offlineSourceData=Y);X={context:g.J9(u),signatureTimestamp:20373,videos:[W]};E&&(X.mediaCapabilities=E);q=X;N=g.dW(AyP);g.QS(V,2);h={aL:!0};return g.S(V,g.KI(y,q,N,void 0,h),4);case 4:e=V.U;g.u8(V,3);break;case 2:d=g.Ts(V);if(d instanceof
g.u$)throw K="GetPDE network manager error: "+d.message,FE(K,d),Error(K);FE("GetPDE fetch request error",d);throw Error("GetPDE fetch request error");case 3:f=cH(e);if(e)f!==void 0&&gq(f,"PDE");else throw FE("Network request failed for PDE"),Error("Network request failed for PDE");return V.return(e)}})},zm4=function(){CX.apply(this,arguments)},PlH=function(Z,u,G){var y,q,N,e,h;
return g.A(function(d){if(d.j==1){if(!u.frameworkUpdates||!g.C(u.frameworkUpdates,q8))return d.return();if(!(g.C(u.frameworkUpdates,q8).mutations&&g.C(u.frameworkUpdates,q8).mutations.length>0&&g.C(u.frameworkUpdates,q8).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return d.Rl(2);y=g.ZE(g.C(u.frameworkUpdates,q8).mutations[0].entityKey).entityId;return g.S(d,bM(Z.j,y),3)}if(d.j!=2){q=d.U;N=g.C(G.actionMetadata,SH);if(h=(e=N)==null?void 0:e.playlistId)q.playlistId=h;q.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Pv(Z.W)?g.S(d,CF(y,Z.j,G,Z.T,q),2):g.MO(Z.W)?g.S(d,uM(y,Z.j,G,Z.T),2):d.Rl(2)}return g.S(d,oli(g.C(u.frameworkUpdates,q8)),0)})},Lqv=function(){oz.apply(this,arguments)},hxi=function(Z){var u;
if((u=Z.onResponseReceivedActions)!=null&&u.length){var G;Z=(G=g.C(g.C(Z.onResponseReceivedActions[0],sms),g.b7J))==null?void 0:G.actions;if(Z!=null&&Z.length)return Z}},yuJ=function(Z,u){var G,y,q;
return g.A(function(N){switch(N.j){case 1:return g.QS(N,2),g.S(N,Rtk(Z,u),4);case 4:return y=N.U,g.S(N,QYd(y),5);case 5:G=hxi(y);g.u8(N,3);break;case 2:q=g.Ts(N),FE("getAndProcessSmartDownloadsResponse request or processing error",q);case 3:return N.return(G)}})},N8=function(Z,u,G,y,q){var N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv,x9,qS,K7,GR,ED,oq,H,GH,L7,Rq,Qw,si,zH,Z6,av,dt;
return g.A(function(je){switch(je.j){case 1:return N=g.hq(Z,u),e=g.hq("music_downloads_library_id","musicDownloadsLibraryEntity"),g.S(je,wq(G,{mode:"readonly",SK:!0},function(U){return g.nB.all([bR(U,N,u),bR(U,e,"musicDownloadsLibraryEntity"),xD(U,u),xD(U,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=je.U;d=g.m(h);K=d.next().value;f=d.next().value;V=d.next().value;X=d.next().value;n=K;l=f;Y=V;E=X;if(!n){je.Rl(3);break}return g.S(je,IPe(n,Y),4);case 4:return W=je.U,g.S(je,hV(W),3);case 3:p=[];z=new Map;if(!n){je.Rl(6);break}return g.S(je,sYe(n,Y,l),7);case 7:p=je.U;L=g.m(p);for(Q=L.next();!Q.done;Q=L.next())b=Q.value,w=g.ZE(b).entityId,z.set(w,{videoId:w,playlistId:Z,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.S(je,PH(G,"transfer"),8);case 8:for(yv=je.U,x9=
g.m(yv),qS=x9.next();!qS.done;qS=x9.next())K7=qS.value,GR=g.ZE(K7.key).entityId,(ED=z.get(GR))&&K7&&(ED.cotn=K7.cotn);case 6:oq=[];H=g.m(E);for(GH=H.next();!GH.done;GH=H.next())L7=GH.value,Rq=g.ZE(L7.key).entityId,Qw=dN(L7),Rq!==Z&&Qw.rootActionId!==Z||KF(y,L7.actionProto)||oq.push(L7.key);si=g.hq(Z,u);return g.S(je,wq(G,{mode:"readwrite",SK:!0},function(U){var ZY=oq.map(function(J6){return Iz(U,J6)});
ZY.push(Iz(U,si,{uD:!0}));return g.nB.all(ZY)}),9);
case 9:if(!n){je.Rl(0);break}p.reverse();if(!p.length){je.Rl(0);break}zH=g.m(p);Z6=zH.next();case 12:if(Z6.done){je.Rl(0);break}av=Z6.value;dt=g.ZE(av).entityId;if(!dt){je.Rl(13);break}return g.S(je,uM(dt,G,y,q,z.get(dt)),13);case 13:Z6=zH.next(),je.Rl(12)}})},X1J=function(Z){this.KV=Z;
this.j=void 0},ftP=function(Z){return Z instanceof Error?new az("UNKNOWN_ENCODE_ERROR",{originalMessage:Z.message}):new az("UNKNOWN_ENCODE_ERROR")},vEk=function(){CX.apply(this,arguments)},lme=function(Z,u){var G,y,q,N,e;
return g.A(function(h){if(h.j==1)return G=g.hq(u,"offlineVideoStreams"),g.S(h,Bi(Z,G,"offlineVideoStreams"),2);y=h.U;if(!y||!y.streamsProgress)return h.return();q=g.m(y.streamsProgress);for(N=q.next();!N.done;N=q.next())e=N.value,e.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",e.numTotalBytes!==e.numBytesDownloaded&&(e.numBytesDownloaded=e.numTotalBytes);return g.S(h,GM(Z,y,"offlineVideoStreams"),0)})},S8J=function(){CX.apply(this,arguments)},Rmw=function(Z,u){var G,y;
return g.A(function(q){switch(q.j){case 1:return G=$w(u),g.S(q,Bi(Z.j,u.entityKey,"transfer"),2);case 2:y=q.U;if(!y||y.transferState!=="TRANSFER_STATE_COMPLETE")return q.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.QS(q,3);return g.S(q,xoi(Z,u,!0),5);case 5:g.u8(q,4);break;case 3:return g.Ts(q),q.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return q.return(new rq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},jaR=function(Z){var u=[],G=Z.videos;
G&&G.length>0&&u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:G[0].offlineVideoData.thumbnail}}});if((Z=Z.additionalMetadadatas)&&Z.length>0)for(Z=g.m(Z),G=Z.next();!G.done;G=Z.next()){var y=G.value.offlineBundleItemPlaylistData,q=void 0;G=(q=y)==null?void 0:q.style;q=void 0;y={collageThumbnail:{coverThumbnail:(q=y)==null?void 0:q.coverThumbnail}};switch(G){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:y});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:y});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:y});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:y})}}return u},Cck=function(){CX.apply(this,arguments)};
g.Jk.prototype.E4=g.$r(45,function(Z){return this.app.E4(Z)});
g.cj.prototype.E4=g.$r(44,function(Z){return g.wot(this,9,Z)});
g.I(CX,oz);g.p3.Object.defineProperties(CX.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.j.entityMetadata},
set:function(Z){this.j.entityMetadata=Z}}});
g.I(pte,CX);pte.prototype.U=function(){return[]};
g.I(FQH,CX);FQH.prototype.U=function(){return[]};
g.I(lPv,CX);lPv.prototype.U=function(){return[]};
g.I(GOH,CX);GOH.prototype.U=function(){return[]};
g.I($is,CX);$is.prototype.U=function(){return[]};
g.I(hyJ,CX);hyJ.prototype.U=function(){var Z=[];this.j.alternateChannel&&Z.push(this.j.alternateChannel);this.j.alternateChannelList&&Z.push.apply(Z,g.bg(this.j.alternateChannelList));this.j.oneofChannelEntity&&Z.push(this.j.oneofChannelEntity);return[].concat(g.bg(new Set(Z)))};
g.I(TeH,CX);TeH.prototype.U=function(){var Z=[];this.j.entryCollection&&Z.push(this.j.entryCollection);return[].concat(g.bg(new Set(Z)))};
g.I(quw,oz);quw.prototype.U=function(){var Z=[];this.j.video&&Z.push(this.j.video);return[].concat(g.bg(new Set(Z)))};
g.I(cNH,CX);cNH.prototype.U=function(){var Z=[];this.j.parentPlaylist&&Z.push(this.j.parentPlaylist);if(this.j.entries)for(var u=g.m(this.j.entries),G=u.next();!G.done;G=u.next())Z.push.apply(Z,g.bg((new quw(G.value)).U()));return[].concat(g.bg(new Set(Z)))};
g.I(UCa,CX);UCa.prototype.U=function(){var Z=[];this.j.descriptionEntity&&Z.push(this.j.descriptionEntity);this.j.creators&&Z.push.apply(Z,g.bg(this.j.creators));this.j.theBiggestFan&&Z.push(this.j.theBiggestFan);return[].concat(g.bg(new Set(Z)))};
g.I(m6i,CX);m6i.prototype.U=function(){return[]};
g.I(zAe,CX);zAe.prototype.U=function(){return[]};
g.I(Uii,CX);Uii.prototype.U=function(){return[]};
g.I(zcd,CX);zcd.prototype.U=function(){return[]};
g.I(q8v,CX);q8v.prototype.U=function(){return[]};
g.I(Mcv,CX);Mcv.prototype.U=function(){return[]};
g.I(Ide,CX);Ide.prototype.U=function(){return[]};
g.I(tcJ,CX);tcJ.prototype.U=function(){return[]};
g.I(d$i,CX);d$i.prototype.U=function(){return[]};
g.I(Doe,CX);Doe.prototype.U=function(){var Z=[];this.j.downloadsList&&Z.push(this.j.downloadsList);this.j.smartDownloadsList&&Z.push(this.j.smartDownloadsList);this.j.recommendedDownloadsList&&Z.push(this.j.recommendedDownloadsList);this.j.refresh&&Z.push(this.j.refresh);return[].concat(g.bg(new Set(Z)))};
g.I(Lqv,oz);Lqv.prototype.U=function(){var Z=[];this.j.video&&Z.push(this.j.video);this.j.playlist&&Z.push(this.j.playlist);this.j.videoItem&&Z.push(this.j.videoItem);this.j.playlistItem&&Z.push(this.j.playlistItem);return[].concat(g.bg(new Set(Z)))};
g.I(Hye,CX);Hye.prototype.U=function(){var Z=[];this.j.refresh&&Z.push(this.j.refresh);if(this.j.downloads)for(var u=g.m(this.j.downloads),G=u.next();!G.done;G=u.next())Z.push.apply(Z,g.bg((new Lqv(G.value)).U()));return[].concat(g.bg(new Set(Z)))};
g.I(htJ,CX);htJ.prototype.U=function(){var Z=[];this.j.localImageEntities&&Z.push.apply(Z,g.bg(this.j.localImageEntities));return[].concat(g.bg(new Set(Z)))};
g.I(nEi,CX);nEi.prototype.U=function(){var Z=[];this.j.playbackData&&Z.push(this.j.playbackData);this.j.localImageEntities&&Z.push.apply(Z,g.bg(this.j.localImageEntities));this.j.videoDownloadContextEntity&&Z.push(this.j.videoDownloadContextEntity);return[].concat(g.bg(new Set(Z)))};
g.I(u4H,CX);u4H.prototype.U=function(){return[]};
g.I(nHs,CX);nHs.prototype.U=function(){var Z=[];this.j.fakeChildren&&Z.push.apply(Z,g.bg(this.j.fakeChildren));return[].concat(g.bg(new Set(Z)))};
g.I(TcJ,CX);TcJ.prototype.U=function(){var Z=[];this.j.video&&Z.push(this.j.video);this.j.playbackData&&Z.push(this.j.playbackData);this.j.offlineVideoPolicy&&Z.push(this.j.offlineVideoPolicy);return[].concat(g.bg(new Set(Z)))};
g.I(Hlv,CX);Hlv.prototype.U=function(){return[]};
g.I(wQ4,CX);wQ4.prototype.U=function(){var Z=[];this.j.channelOwner&&Z.push(this.j.channelOwner);this.j.videos&&Z.push.apply(Z,g.bg(this.j.videos));this.j.collaboratorChannels&&Z.push.apply(Z,g.bg(this.j.collaboratorChannels));this.j.downloadState&&Z.push(this.j.downloadState);this.j.refresh&&Z.push(this.j.refresh);return[].concat(g.bg(new Set(Z)))};
g.I(yXd,CX);yXd.prototype.U=function(){var Z=[];this.j.video&&Z.push(this.j.video);this.j.channelContributor&&Z.push(this.j.channelContributor);return[].concat(g.bg(new Set(Z)))};
g.I(ro4,oz);ro4.prototype.U=function(){var Z=[];this.j.localImageEntities&&Z.push.apply(Z,g.bg(this.j.localImageEntities));this.j.videoDownloadContextEntity&&Z.push(this.j.videoDownloadContextEntity);return[].concat(g.bg(new Set(Z)))};
g.I(ANv,oz);ANv.prototype.U=function(){var Z=[];this.j.recommendedVideoMetadata&&Z.push.apply(Z,g.bg((new ro4(this.j.recommendedVideoMetadata)).U()));return[].concat(g.bg(new Set(Z)))};
g.I(OeJ,oz);OeJ.prototype.U=function(){var Z=[];this.j.playbackPosition&&Z.push(this.j.playbackPosition);return[].concat(g.bg(new Set(Z)))};
g.I(yhJ,CX);yhJ.prototype.U=function(){var Z=[];this.j.owner&&Z.push(this.j.owner);this.j.downloadState&&Z.push(this.j.downloadState);this.j.userState&&Z.push.apply(Z,g.bg((new OeJ(this.j.userState)).U()));this.j.additionalMetadata&&Z.push.apply(Z,g.bg((new ANv(this.j.additionalMetadata)).U()));return[].concat(g.bg(new Set(Z)))};
g.I(LQe,CX);LQe.prototype.U=function(){var Z=[];this.j.userChannelDetails&&Z.push(this.j.userChannelDetails);return[].concat(g.bg(new Set(Z)))};
g.I(BPi,CX);BPi.prototype.U=function(){var Z=[];this.j.channelOwner&&Z.push(this.j.channelOwner);this.j.playbackPosition&&Z.push(this.j.playbackPosition);this.j.localImageEntities&&Z.push.apply(Z,g.bg(this.j.localImageEntities));this.j.downloadStatus&&Z.push(this.j.downloadStatus);return[].concat(g.bg(new Set(Z)))};
g.I(XQs,CX);XQs.prototype.U=function(){return[]};
g.I(lzH,CX);lzH.prototype.U=function(){return[]};
g.I(qfi,CX);qfi.prototype.U=function(){return[]};
g.I(hAJ,CX);hAJ.prototype.U=function(){return[]};
g.I(lxw,CX);lxw.prototype.U=function(){return[]};
g.I(Xte,CX);Xte.prototype.U=function(){return[]};
g.I(aPJ,CX);aPJ.prototype.U=function(){return[]};
g.I(YPd,CX);YPd.prototype.U=function(){return[]};
g.I(zxi,CX);zxi.prototype.U=function(){return[]};
g.I(gG4,CX);gG4.prototype.U=function(){return[]};
g.I(kmw,CX);kmw.prototype.U=function(){return[]};
g.I(x$P,CX);x$P.prototype.U=function(){return[]};
g.I(mXH,CX);mXH.prototype.U=function(){return[]};
g.I(hmi,CX);hmi.prototype.U=function(){var Z=[];this.j.compositeSourceKeys&&Z.push.apply(Z,g.bg(this.j.compositeSourceKeys));return[].concat(g.bg(new Set(Z)))};
g.I(RAi,CX);RAi.prototype.U=function(){var Z=[];this.j.trackDownloadMetadatas&&Z.push.apply(Z,g.bg(this.j.trackDownloadMetadatas));return[].concat(g.bg(new Set(Z)))};
g.I($6k,CX);
$6k.prototype.U=function(){var Z=[];this.j.downloadedTracks&&Z.push.apply(Z,g.bg(this.j.downloadedTracks));this.j.smartDownloadedTracks&&Z.push.apply(Z,g.bg(this.j.smartDownloadedTracks));this.j.downloadedEpisodes&&Z.push.apply(Z,g.bg(this.j.downloadedEpisodes));this.j.downloadedAlbumReleases&&Z.push.apply(Z,g.bg(this.j.downloadedAlbumReleases));this.j.smartDownloadedAlbumReleases&&Z.push.apply(Z,g.bg(this.j.smartDownloadedAlbumReleases));this.j.downloadedPlaylists&&Z.push.apply(Z,g.bg(this.j.downloadedPlaylists));this.j.smartDownloadedPlaylists&&
Z.push.apply(Z,g.bg(this.j.smartDownloadedPlaylists));this.j.metadataOnlyTracks&&Z.push.apply(Z,g.bg(this.j.metadataOnlyTracks));return[].concat(g.bg(new Set(Z)))};
g.I(LSR,CX);LSR.prototype.U=function(){var Z=[];this.j.trackDownloadMetadatas&&Z.push.apply(Z,g.bg(this.j.trackDownloadMetadatas));return[].concat(g.bg(new Set(Z)))};
g.I(BzJ,CX);BzJ.prototype.U=function(){var Z=[];this.j.playbackData&&Z.push(this.j.playbackData);this.j.localImageEntities&&Z.push.apply(Z,g.bg(this.j.localImageEntities));this.j.videoDownloadContextEntity&&Z.push(this.j.videoDownloadContextEntity);return[].concat(g.bg(new Set(Z)))};
g.I(oOs,CX);oOs.prototype.U=function(){var Z=[];this.j.musicLibraryStatusEntity&&Z.push(this.j.musicLibraryStatusEntity);this.j.primaryArtists&&Z.push.apply(Z,g.bg(this.j.primaryArtists));this.j.details&&Z.push(this.j.details);this.j.userDetails&&Z.push(this.j.userDetails);this.j.tracks&&Z.push.apply(Z,g.bg(this.j.tracks));this.j.share&&Z.push(this.j.share);this.j.downloadMetadata&&Z.push(this.j.downloadMetadata);this.j.refresh&&Z.push(this.j.refresh);return[].concat(g.bg(new Set(Z)))};
g.I(jCk,CX);jCk.prototype.U=function(){var Z=[];this.j.albumRelease&&Z.push(this.j.albumRelease);this.j.tracks&&Z.push.apply(Z,g.bg(this.j.tracks));return[].concat(g.bg(new Set(Z)))};
g.I(x7a,CX);x7a.prototype.U=function(){var Z=[];this.j.albumRelease&&Z.push(this.j.albumRelease);return[].concat(g.bg(new Set(Z)))};
g.I(d7s,CX);d7s.prototype.U=function(){var Z=[];this.j.details&&Z.push(this.j.details);this.j.userDetails&&Z.push(this.j.userDetails);return[].concat(g.bg(new Set(Z)))};
g.I(w1i,CX);w1i.prototype.U=function(){var Z=[];this.j.parentArtist&&Z.push(this.j.parentArtist);return[].concat(g.bg(new Set(Z)))};
g.I(Abi,CX);Abi.prototype.U=function(){var Z=[];this.j.parentArtist&&Z.push(this.j.parentArtist);return[].concat(g.bg(new Set(Z)))};
g.I(doH,CX);doH.prototype.U=function(){return[]};
g.I(feH,CX);feH.prototype.U=function(){return[]};
g.I(Wqs,oz);Wqs.prototype.U=function(){var Z=[];this.j.creatorEntity&&Z.push(this.j.creatorEntity);return[].concat(g.bg(new Set(Z)))};
g.I(ieJ,CX);
ieJ.prototype.U=function(){var Z=[];this.j.tracks&&Z.push.apply(Z,g.bg(this.j.tracks));this.j.refresh&&Z.push(this.j.refresh);this.j.musicLibraryStatusEntity&&Z.push(this.j.musicLibraryStatusEntity);this.j.details&&Z.push(this.j.details);this.j.downloadMetadata&&Z.push(this.j.downloadMetadata);this.j.sideloadMetadata&&Z.push(this.j.sideloadMetadata);this.j.userDetails&&Z.push(this.j.userDetails);this.j.entryCollection&&Z.push(this.j.entryCollection);this.j.share&&Z.push(this.j.share);this.j.podcastShowAdditionalMetadata&&
Z.push.apply(Z,g.bg((new Wqs(this.j.podcastShowAdditionalMetadata)).U()));return[].concat(g.bg(new Set(Z)))};
g.I(Jus,CX);Jus.prototype.U=function(){return[]};
g.I(hja,CX);
hja.prototype.U=function(){var Z=[];this.j.musicLibraryStatusEntity&&Z.push(this.j.musicLibraryStatusEntity);this.j.artists&&Z.push.apply(Z,g.bg(this.j.artists));this.j.audioModeVersion&&Z.push(this.j.audioModeVersion);this.j.videoModeVersion&&Z.push(this.j.videoModeVersion);this.j.userDetails&&Z.push(this.j.userDetails);this.j.details&&Z.push(this.j.details);this.j.albumRelease&&Z.push(this.j.albumRelease);this.j.share&&Z.push(this.j.share);this.j.libraryEdit&&Z.push(this.j.libraryEdit);this.j.downloadMetadata&&
Z.push(this.j.downloadMetadata);this.j.playbackPosition&&Z.push(this.j.playbackPosition);this.j.lyrics&&Z.push(this.j.lyrics);return[].concat(g.bg(new Set(Z)))};
g.I(zm4,CX);zm4.prototype.U=function(){var Z=[];this.j.parentTrack&&Z.push(this.j.parentTrack);return[].concat(g.bg(new Set(Z)))};
g.I(cbP,CX);cbP.prototype.U=function(){var Z=[];this.j.parentTrack&&Z.push(this.j.parentTrack);return[].concat(g.bg(new Set(Z)))};
g.I(KSR,CX);KSR.prototype.U=function(){return[]};
g.I(VUi,CX);VUi.prototype.U=function(){return[]};
g.I(yoa,CX);yoa.prototype.U=function(){return[]};
g.I(nlR,CX);nlR.prototype.U=function(){return[]};
g.I(vud,CX);vud.prototype.U=function(){var Z=[];this.j.transfer&&Z.push(this.j.transfer);this.j.adsPlaybackData&&Z.push.apply(Z,g.bg(this.j.adsPlaybackData));this.j.drmLicense&&Z.push(this.j.drmLicense);this.j.offlineVideoPolicy&&Z.push(this.j.offlineVideoPolicy);this.j.videoDownloadContextEntity&&Z.push(this.j.videoDownloadContextEntity);return[].concat(g.bg(new Set(Z)))};
g.I(m7v,CX);m7v.prototype.U=function(){return[]};
g.I(kpJ,CX);kpJ.prototype.U=function(){var Z=[];this.j.offlineVideoStreams&&Z.push.apply(Z,g.bg(this.j.offlineVideoStreams));this.j.captionTrack&&Z.push.apply(Z,g.bg(this.j.captionTrack));return[].concat(g.bg(new Set(Z)))};
g.I(Aui,CX);Aui.prototype.U=function(){return[]};
g.I(uCi,CX);uCi.prototype.U=function(){return[]};
g.I(zts,CX);zts.prototype.U=function(){return[]};
g.I(jmk,CX);jmk.prototype.U=function(){return[]};
g.I(Cck,CX);Cck.prototype.U=function(){return[]};
g.I(be4,CX);be4.prototype.U=function(){return[]};
g.I(Gmw,CX);Gmw.prototype.U=function(){return[]};
g.I(S8J,CX);S8J.prototype.U=function(){return[]};
g.I(zyR,CX);zyR.prototype.U=function(){return[]};
g.I(LTH,CX);LTH.prototype.U=function(){return[]};
g.I(dCv,CX);dCv.prototype.U=function(){return[]};
g.I(vEk,CX);vEk.prototype.U=function(){return[]};
g.I(kjd,CX);kjd.prototype.U=function(){return[]};
g.I(FSe,CX);FSe.prototype.U=function(){return[]};
g.I(O$J,CX);O$J.prototype.U=function(){return[]};
g.I($CJ,CX);$CJ.prototype.U=function(){return[]};
g.I(Ahw,CX);Ahw.prototype.U=function(){return[]};
g.I(wGR,CX);wGR.prototype.U=function(){return[]};
g.I(SPd,CX);SPd.prototype.U=function(){return[]};
g.I(UoJ,CX);UoJ.prototype.U=function(){return[]};
g.I(NRR,CX);NRR.prototype.U=function(){return[]};
g.I(XGe,CX);XGe.prototype.U=function(){return[]};
var S0i=["browse","music/browse","streaming_browse","unplugged/browse"],emi=["offline/playlist_sync_check"],QCJ=["offline"],fxk=["offline/offline_video_playback_position_sync"],AyP=["offline/get_playback_data_entity"],iM;$D.getInstance=function(){return g.A(function(Z){return Z.return(new Promise(function(u){g.Xs().then(function(G){G?($D.instance||($D.instance=new $D(G)),u($D.instance)):u(void 0)})}))})};
$D.prototype.get=function(Z){var u=this,G,y,q;return g.A(function(N){if(N.j==1)return g.S(N,Z$J(u.token),2);if(N.j!=3)return G=N.U,g.S(N,G.get("prefs",Z),3);y=N.U;if(!y)return N.return();q=(0,g.MJ)();return y.expirationTimestampMs<=q?N.return():N.return(y.value)})};
$D.prototype.set=function(Z,u,G){G=G===void 0?31536E3:G;var y=this,q,N,e;return g.A(function(h){if(h.j==1)return q=(0,g.MJ)(),N={key:Z,value:u,expirationTimestampMs:q+G*1E3},g.S(h,Z$J(y.token),2);e=h.U;return g.S(h,g.eN(e,"prefs",N),0)})};
$D.prototype.remove=function(Z){var u=this,G;return g.A(function(y){if(y.j==1)return g.S(y,Z$J(u.token),2);G=y.U;return g.S(y,G.delete("prefs",Z),0)})};
g.I(az,g.dw);g.I(iR,ybi);iR.prototype.T=function(Z,u){u=Cba(u);Z=(new TextEncoder).encode(JSON.stringify(Z));return this.j.encrypt(Z,u)};
iR.prototype.U=function(Z,u){if(!(Z instanceof Uint8Array))throw exs(1);var G=new TextDecoder;u=Cba(u);Z=this.j.decrypt(Z,u);return JSON.parse(G.decode(Z))};
var pxJ={accountLinkStatusEntity:Uii,booleanEntity:GOH,buttonEntity:O$J,captionTrack:KSR,channelHandle:pte,chipEntity:Gmw,commerceAcquisitionClientPayloadEntity:Ahw,commerceCartListEntity:wGR,compositeSourceEntity:mXH,multiviewStagingEntity:hmi,contextNoteFeedEntityPayload:FQH,contextNoteUserRatingEntityPayload:lPv,continuationTokenEntity:Hlv,downloadQualityPickerEntity:Ide,downloadsPageRefreshTokenEntity:d$i,downloadsPageViewConfigurationEntity:XQs,downloadStatusEntity:tcJ,dismissState:S8J,sfvAudioItemCurrentlyPlayingEntity:jmk,
emojiFountainDataEntity:kjd,emojiCustomizationSetEntity:vEk,fakeChannel:hyJ,fakePlaylist:TeH,fakePlaylistEntryCollection:cNH,fakeVideo:UCa,fakeVideoDescription:m6i,featuredProductsEntity:gG4,flowStateEntity:zAe,iconBadgeEntity:SPd,interstitialInteractionStateEntity:q8v,likeButtonAnimationEntity:lzH,liveChatPollStateEntity:Mcv,dataFreshnessEntity:dCv,liveViewerLeaderboardChatEntryPointStateEntity:uCi,liveViewerLeaderboardPointsEntity:zts,liveReactionsDataEntity:FSe,logoEntity:zcd,macroMarkerEntity:qfi,
mainDownloadsLibraryEntity:Doe,mainDownloadsListEntity:Hye,mainPlaylistDownloadStateEntity:htJ,mainPlaylistEntity:wQ4,mainPlaylistVideoEntity:yXd,mainVideoDownloadStateEntity:nEi,mainVideoEntity:yhJ,markersEngagementPanelSyncEntity:hAJ,markersVisibilityOverrideEntity:lxw,musicAlbumReleaseDetail:jCk,musicAlbumReleaseDownloadMetadataEntity:RAi,musicAlbumRelease:oOs,musicAlbumReleaseUserDetail:x7a,musicArtistDetail:w1i,musicArtist:d7s,musicArtistUserDetail:Abi,musicDownloadsLibraryEntity:$6k,musicLibraryEdit:doH,
musicLibraryStatusEntity:feH,musicPlaylist:ieJ,musicPlaylistDownloadMetadataEntity:LSR,musicShare:Jus,musicTrackDetail:zm4,musicTrackDownloadMetadataEntity:BzJ,musicTrack:hja,musicTrackUserDetail:cbP,offlineOrchestrationActionWrapperEntity:VUi,offlineVideoPolicy:yoa,offlineVideoStreams:nlR,offlineabilityEntity:u4H,orchestrationWebSamplingEntity:nHs,pageHeaderEntity:zyR,pdpStateEntity:UoJ,pinnedProductEntity:kmw,playbackData:vud,playerStateEntity:Xte,quantityIncrementerEntity:NRR,refresh:m7v,saveToPlaylistListEntity:Cck,
selectedChipIndexEntityPayload:aPJ,settingEntity:be4,stringEntity:$is,suggestedFeedbackChipStateEntity:YPd,transfer:kpJ,trendingOfferEntity:x$P,videoDownloadContextEntity:Aui,videoOverviewAsyncDataEntity:XGe,videoPlaybackPositionEntity:$CJ,votingEntity:LTH,ytMainChannelEntity:LQe,youchatPendingResponseEntity:zxi,ytMainDownloadedVideoEntity:TcJ,ytMainVideoEntity:BPi};g.I(yC,ybi);yC.prototype.T=function(Z){return Z};
yC.prototype.U=function(Z){if(Z instanceof Uint8Array)throw exs(0);return Z};
g.I(oK,g.O);oK.prototype.observe=function(Z){var u=this;this.observers.push(Z);return function(){var G=u.observers.indexOf(Z);G>=0&&u.observers.splice(G,1)}};
oK.prototype.U=function(Z){HKJ(this,Z.data)};
oK.prototype.tT=function(){this.channel.close()};
var rXv,sms=new g.fq("elementsCommand");var q8=new g.fq("entityBatchUpdate");var gHa=new g.fq("downloadStatusEntity");var JNs=new g.fq("mainPlaylistEntityActionMetadata");var nF=new g.fq("mainVideoEntityActionMetadata");var O8d=new g.fq("musicPlaylistEntityActionMetadata");var TRa=new g.fq("musicTrackEntityActionMetadata");var qFJ=new g.fq("localImageEntityActionMetadata");var SH=new g.fq("playbackDataActionMetadata");var Ncd=new g.fq("transferEntityActionMetadata");var saJ=new g.fq("videoPlaybackPositionEntityActionMetadata");var lei;new g.JN;new g.JN;Aoa.prototype.request=function(Z,u,G){u=u===void 0?{}:u;return this.locks.request(Z,u,function(y){return G(y)})};var JV=g.nh.caches,YD,Lsk;aK.prototype.open=function(Z){return JV.open(vHH(Z))};
aK.prototype.has=function(Z){return JV.has(vHH(Z))};
aK.prototype.delete=function(Z){return JV.delete(vHH(Z))};
aK.prototype.match=function(Z,u){var G=this,y,q,N,e,h,d;return g.A(function(K){switch(K.j){case 1:return g.S(K,G.keys(),2);case 2:y=K.U,q=g.m(y),N=q.next();case 3:if(N.done){K.Rl(5);break}e=N.value;return g.S(K,G.open(e),6);case 6:return h=K.U,g.S(K,h.match(Z,u),7);case 7:if(d=K.U)return K.return(d);N=q.next();K.Rl(3);break;case 5:return K.return()}})};
g.I(ZlJ,aK);ZlJ.prototype.keys=function(){var Z,u,G,y,q,N,e,h,d;return g.A(function(K){if(K.j==1)return Z=[],u=g.UG("CacheStorage keys"),g.S(K,JV.keys(),2);G=K.U;y=g.m(G);for(q=y.next();!q.done;q=y.next()){N=q.value;var f=N.indexOf(":");e=f===-1?{zX:N}:{zX:N.substring(0,f),datasyncId:N.substring(f+1)};h=e.zX;d=e.datasyncId;d===u&&Z.push(h)}return K.return(Z)})};g.I(Us,g.O);Us.prototype.T=function(Z){this.api.pV("onOfflineOperationFailure",Z.data)};
Us.prototype.D=function(Z){this.api.publish("offlinetransferpause",Z.data)};
Us.prototype.tT=function(){var Z;(Z=this.j)==null||Z.close();var u;(u=this.U)==null||u.close()};Lgi.prototype.YK=function(){this.j&&QC(this)};
Lgi.prototype.mj=function(){this.U&&this.U.resolve();this.T=this.j=!1;this.Fn()};var EEP=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var WSv="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var Qbi="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.I(YfJ,uv);YfJ.prototype.U=function(Z){return Hi(Z)?oHP(this,Z):rN(Z)?tVd(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};g.I(UXP,uv);UXP.prototype.U=function(Z){return rN(Z)?EOk(this,Z):tpH(Z)?vOe(this,Z):kD(Z)?oue(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};g.D=g4w.prototype;g.D.hPn=function(Z){var u=this,G,y,q,N;return g.A(function(e){if(!g.T(Z.state,128))return e.Rl(0);G=Z.state.Ko;var h=(y=G)==null?void 0:y.errorCode,d=(q=G)==null?void 0:q.iG;N=h==="net.connect"&&d===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(h==null?0:h.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.S(e,u.p$(u.player.getVideoData().videoId,N),0)})};
g.D.p$=function(Z,u){var G=this;return g.A(function(y){if(y.j==1){if(G.U)return y.return();G.U=!0;return u==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(F9(G,Z,!1,!0),y.Rl(0)):g.S(y,zM(G,Z),3)}g.M0(Z,4);return g.S(y,G.j.p$(u),0)})};
g.D.C$=function(Z){Z.status===2?(Z.status!==this.T&&(guv(this.j),g.M0(Z.videoId,2)),Z.ll&&Fsk(this.j,Z.videoId,Z.ll)):Z.status===4?(zM(this,Z.videoId),this.p$(Z.videoId,Z.JR?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):Z.status===1&&D6s(this.j);this.T=Z.status;this.api.pV("localmediachange",{videoId:Z.videoId,status:Z.status})};
g.D.jg=function(){var Z=this,u;return g.A(function(G){if(G.j==1){if(Z.U)return G.return();Z.U=!0;u=Z.player.getVideoData().videoId;return g.S(G,zM(Z,u),2)}return g.S(G,Z.j.jg(),0)})};
g.D.GO=function(Z){switch(Z){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.D.S=function(Z){return this.api.J().S(Z)};g.I(Q6i,uv);Q6i.prototype.U=function(Z){return Hi(Z)?gOv(this,Z):rN(Z)?Rmw(this,Z):tpH(Z)?OGs(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};OyP.prototype.j=function(Z,u){var G=Z.action.actionMetadata.priority-u.action.actionMetadata.priority;G===0&&(Z.j<u.j?G=-1:Z.j>u.j&&(G=1));return G};g.I(TM,g.O);TM.prototype.tT=function(){this.Fn&&this.Fn();g.O.prototype.tT.call(this)};
TM.prototype.createAction=function(Z,u){var G=g.ZE(Z.entityKey).entityType,y=g.HU(16);return new AV(G,y,Z,u.actionId,u.rootActionId)};
TM.prototype.UT=function(Z){var u=this,G,y,q,N,e,h,d,K,f;return g.A(function(V){if(V.j==1){if(u.Bu())return V.return();y=(G=Z.offlineOrchestrationActionWrapperEntity)!=null?G:new Set;q=[];N=g.m(y);for(e=N.next();!e.done;e=N.next())h=e.value,d=g.ZE(h),K=d.entityId,KsH(u.j,K)||q.push(h);return g.S(V,$XR(u,q),2)}f=V.U;return g.S(V,JoR(u,f),0)})};
TM.prototype.retry=function(){var Z=this;return g.A(function(u){return g.S(u,fms(Z),0)})};X1J.prototype.Po=function(Z,u){u=u===void 0?!0:u;var G=this,y,q,N,e,h,d,K,f;return g.A(function(V){switch(V.j){case 1:if(!G.j)return V.return();y=[];q=g.AZ(G.j.U,u);N=[];for(e={Bh:0};e.Bh<q.length;e={Bh:e.Bh},e.Bh++)h=q[e.Bh],d=G.j.JG(h,"json3"),K=g.ET(d,{withCredentials:!0,format:"RAW"},3,500).then(function(X){return function(n){n={metadata:g.wZ(q[X.Bh]),trackData:n.xhr.responseText};N.push(n)}}(e)).Uh(function(X){FE("Caption fetch error",X)}),y.push(K);
return g.S(V,PZk(y),2);case 2:return g.QS(V,3),g.S(V,b$v(Z,N),5);case 5:g.u8(V,0);break;case 3:f=g.Ts(V),FE("Caption DB transaction error",f),g.pA(V)}})};g.I(ci,g.O);ci.prototype.tT=function(){this.U&&this.U();g.O.prototype.tT.call(this)};
ci.prototype.T=function(Z){var u=this,G,y,q,N,e,h,d,K;return g.A(function(f){y=(G=Z.transfer)!=null?G:new Set;q=[];N=g.m(y);for(e=N.next();!e.done;e=N.next())h=e.value,d=g.ZE(h),K=d.entityId,q.push(K);return q.length===0?f.return():g.S(f,Brk(u,q),0)})};g.I(vGe,g.O);g.D=vGe.prototype;g.D.tT=function(){this.xx&&this.xx();this.Zi.dispose();this.D.dispose();this.Mu&&g.O_(this.X.oT,this.Mu);this.SD&&g.O_(this.X.oT,this.SD);g.O.prototype.tT.call(this)};
g.D.Ks6=function(Z){var u=this,G,y,q;return g.A(function(N){switch(N.j){case 1:G=g.hq(Z,"transfer");if(u.j&&G===u.j.key){F9(u.K,u.G,!0);u.D.stop();N.Rl(0);break}return g.S(N,wq(u.U,{mode:"readwrite",SK:!0},function(e){return bR(e,G,"transfer").then(function(h){if(h&&h.transferState!=="TRANSFER_STATE_COMPLETE"&&h.transferState!=="TRANSFER_STATE_FAILED")return h.transferState="TRANSFER_STATE_PAUSED_BY_USER",TL(e,h,"transfer").then(function(){return h})})}),3);
case 3:y=N.U;if(!y){N.Rl(0);break}if(!Z||!u.T){N.Rl(5);break}return g.S(N,kw(Z,u.T,u.U,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.S(N,tV(u,Z),7);case 7:q=N.U,Pxi({videoId:Z,wJ:y,offlineModeType:q}),g.pA(N)}})};
g.D.YP1=function(){var Z=this;if(this.j&&this.G){F9(this.K,this.G,!1);var u=this.j,G=(u==null?0:u.key)?g.ZE(u.key).entityId:"";G&&this.T&&(new Promise(function(y,q){kw(G,Z.T,Z.U,"DOWNLOAD_STATE_PAUSED").catch(function(N){q(N)})})).catch(function(y){FE("Download state setting error",y)})}this.D.stop()};
g.D.Gd=function(){this.j?ItJ(this,this.j):Os(this)};
g.D.Bk=function(Z){var u=this;return g.A(function(G){switch(G.j){case 1:if(!u.j){G.Rl(2);break}if(u.j.transferState==="TRANSFER_STATE_COMPLETE"||u.j.transferState==="TRANSFER_STATE_FAILED"||!Z.transfer||!Z.transfer.has(u.j.key)){G.Rl(3);break}return g.S(G,Bi(u.U,u.j.key,"transfer"),4);case 4:u.j=G.U;if(u.j){G.Rl(3);break}return g.S(G,VVk(u),3);case 3:if(u.j)return G.return();case 2:return g.S(G,Os(u),0)}})};
g.D.p$=function(Z,u){var G=this,y,q,N,e,h;return g.A(function(d){switch(d.j){case 1:if(!G.j){eH(G,"onTransferFailure: "+Z);d.Rl(2);break}y=G.j;N=((q=y)==null?0:q.key)?g.ZE(y.key).entityId:"";a:switch(Z){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var K=!1;break a;default:K=!0}return K&&$$e(G)?g.S(d,Wi(G,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.S(d,
JyJ(G,Z),5);case 5:if(!N||!G.T){d.Rl(2);break}return g.S(d,kw(N,G.T,G.U,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.S(d,tV(G,N),9);case 9:e=d.U;mF({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:N,wJ:y,offlineModeType:e});if(!N||!G.T){d.Rl(2);break}return g.S(d,kw(N,G.T,G.U,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:jH(G),h=Os(G,!0),u&&u(h),g.pA(d)}})};
g.D.jg=function(Z){var u=this,G,y,q,N,e,h,d,K,f,V,X,n;return g.A(function(l){switch(l.j){case 1:if(!u.j){eH(u,"onMaybeTransferStreamsExpired");l.Rl(2);break}return $$e(u)?g.S(l,Wi(u,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.S(l,JyJ(u,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!u.T){l.Rl(2);break}G=u.j;q=((y=G)==null?0:y.key)?g.ZE(G.key).entityId:"";if(!q){l.Rl(2);break}return g.S(l,kw(q,u.T,u.U,"DOWNLOAD_STATE_FAILED"),2);case 9:return u.j||eH(u,"onMaybeTransferStreamsExpiredRetryAttempting"),
N=u.j,h=((e=N)==null?0:e.key)?g.ZE(N.key).entityId:"",g.S(l,tV(u,h),10);case 10:return d=l.U,mF({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:h,wJ:N,offlineModeType:d}),K=MjP(),g.qi(K,SH,{isEnqueuedForExpiredStreamUrlRefetch:!0}),f=g.hq(h,"playbackData"),V={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:f,actionMetadata:K},X=Pi(new AV("playbackData",h,V)),g.S(l,GM(u.U,X,"offlineOrchestrationActionWrapperEntity"),2);case 2:jH(u),n=Os(u,!0),
Z&&Z(n),g.pA(l)}})};
var Pc4={},pya=(Pc4.TRANSFER_STATE_TRANSFERRING=1,Pc4.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,Pc4);g.D=pF.prototype;g.D.KL=function(){return this.G.promise};
g.D.Dh=function(){if(this.U&&this.K)return this.G.promise;CZk(this).then(this.G.resolve).catch(this.G.reject);return this.G.promise};
g.D.ww=function(Z){var u={};return u.playbackData=new YfJ(Z,this.W,this.j),u.transfer=new Q6i(Z,this.W),u.videoPlaybackPositionEntity=new UXP(Z,this.W),u};
g.D.S3=function(){var Z=this;return g.A(function(u){return Z.U?g.S(u,ImJ(Z.U),0):u.Rl(0)})};
g.D.u6=function(){var Z=this,u,G;return g.A(function(y){if(y.j==1)return Z.U||Z.K?g.S(y,Z.KL(),2):y.return();Z.C!==void 0&&(g.s2(Z.C),Z.C=void 0);Z.D!==void 0&&(g.s2(Z.D),Z.D=void 0);(u=Z.U)==null||u.dispose();Z.U=void 0;(G=Z.K)==null||G.dispose();Z.K=void 0;Z.api.pV("onOrchestrationLostLeader");Z.G=new g.JN;g.pA(y)})};
g.D.isOrchestrationLeader=function(){return this.T.j};
g.D.Mf=function(){return g.A(function(Z){return Z.return(!1)})};
g.D.Vy=function(Z){var u=this.j;u.api.publish("offlinetransferpause",Z);var G;(G=u.U)==null||G.postMessage(Z)};
g.D.Gd=function(Z){var u,G;return g.A(function(y){if(y.j==1)return g.S(y,QO(),2);u=y.U;if(!u)return y.return();G=g.hq(Z,"transfer");return g.S(y,wq(u,{mode:"readwrite",SK:!0},function(q){var N=bR(q,G,"transfer"),e=bR(q,g.hq(Z,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.nB.all([N,e]).then(function(h){h=g.m(h);var d=h.next().value;var K=h.next().value;return d&&d.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(d.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",TL(q,d,"transfer").then(function(){mF({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:Z,wJ:d,offlineModeType:K==null?void 0:K.offlineModeType});return g.nB.resolve(null)})):g.nB.resolve(null)})}),0)})};
g.D.Tq=function(Z){Z=Z===void 0?43200:Z;var u=this,G,y,q,N,e,h,d,K;return g.A(function(f){if(f.j==1)return u.X.DK()?g.S(f,QO(),2):f.return(jYR());if(f.j!=3){G=f.U;if(!G)return f.return([]);y=Date.now()/1E3;return g.S(f,PH(G,"offlineVideoPolicy"),3)}q=f.U;N=[];e=g.m(q);for(h=e.next();!h.done;h=e.next())d=h.value,Number(d.lastUpdatedTimestampSeconds)+Z<=y&&(K=g.ZE(d.key).entityId,N.push(K));return N.length?f.return(RK(u,N,u.Fn,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):f.return([])})};
g.D.deleteAll=function(){return RK(this,["!*$_ALL_ENTITIES_!*$"],this.Fn,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.D.refreshAllStaleEntities=function(Z){var u=this;return g.A(function(G){return G.j==1?g.S(G,u.Tq(Z),2):G.return(G.U)})};
g.D.setUpPositionSyncInterval=function(Z){var u=this;this.D!==void 0&&(g.s2(this.D),this.D=void 0);var G=Z!=null?Z:864E5;this.D=g.AR(function(){u.n3(G)},G)};
g.D.n3=function(Z){var u=this,G,y,q,N,e,h;return g.A(function(d){switch(d.j){case 1:return g.QS(d,2),g.S(d,$D.getInstance(),4);case 4:G=d.U;if(!G)throw Error("prefStorage is undefined");return g.S(d,G.get("psi"),5);case 5:y=d.U;N=((q=y)==null?0:q.oo)?Number(y.oo)/1E3:0;e=Date.now();if(!(N+Z<=e)){d.Rl(6);break}return g.S(d,RK(u,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.u8(d,0);break;case 2:h=g.Ts(d),FE("Offline manager error",h),
g.pA(d)}})};
g.D.M8=function(){var Z=this,u,G,y,q,N,e,h;return g.A(function(d){if(d.j==1)return g.S(d,QO(),2);if(d.j!=3)return(u=d.U)?g.S(d,PH(u,"transfer"),3):d.return([]);G=d.U;y=[];q=g.m(G);for(N=q.next();!N.done;N=q.next())e=N.value,e.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&e.key&&(h=g.ZE(e.key).entityId,y.push(h));return d.return(mCJ(Z,y))})};
g.D.o7=function(){return g.A(function(Z){return Z.return([])})};
g.D.WG=function(){return g.A(function(Z){g.pA(Z)})};
g.D.El=function(){return g.A(function(Z){g.pA(Z)})};g.I(MUJ,uv);MUJ.prototype.U=function(Z){return Hi(Z)?ucv(this,Z):rN(Z)?Kq4(this,Z):kD(Z)?Xxa(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};
var ZA=[10];g.I(adR,uv);adR.prototype.U=function(Z){return Hi(Z)?eAP(this,Z):rN(Z)?Ixe(this,Z):kD(Z)?rbJ(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};
var N0i=[10];g.I(HGa,uv);HGa.prototype.U=function(Z){return rN(Z)?d64(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};g.I(x6i,pF);g.D=x6i.prototype;g.D.ww=function(Z){var u=pF.prototype.ww.call(this,Z);u.mainVideoEntity=new adR(Z,this.W,this.j);u.mainPlaylistEntity=new MUJ(Z,this.W,this.j);u.mainDownloadsListEntity=new HGa(Z,this.W,this.j);return u};
g.D.refreshAllStaleEntities=function(Z,u){var G=this,y,q,N,e,h,d,K,f,V,X,n;return g.A(function(l){switch(l.j){case 1:y=[];if(!G.W.S("web_player_offline_playlist_auto_refresh")){l.Rl(2);break}return g.S(l,PBi(G,Z,u),3);case 3:y=l.U;case 2:return g.S(l,$D.getInstance(),4);case 4:return q=l.U,g.S(l,(N=q)==null?void 0:N.get("sdois"),5);case 5:return e=l.U,g.S(l,(h=q)==null?void 0:h.get("lmqf"),6);case 6:d=l.U;if(!e){l.Rl(7);break}f=y;V=f.concat;return g.S(l,Nee(G,e,(K=d)!=null?K:"SD",Z===0),8);case 8:y=
V.call(f,l.U);case 7:return X=y,n=X.concat,g.S(l,pF.prototype.refreshAllStaleEntities.call(G,Z,u),9);case 9:return y=n.call(X,l.U),l.return(y)}})};
g.D.Mf=function(Z){var u,G,y,q,N,e,h,d;return g.A(function(K){if(K.j==1)return g.S(K,QO(),2);if(K.j!=3)return(u=K.U)?g.S(K,Bi(u,g.Sk,"mainDownloadsListEntity"),3):K.return(!1);G=K.U;if((y=G)==null?0:(q=y.downloads)==null?0:q.length)for(N=g.hq(Z,"mainVideoEntity"),e=g.m(G.downloads),h=e.next();!h.done;h=e.next())if(d=h.value,d.videoItem===N)return K.return(!0);return K.return(!1)})};
g.D.o7=function(){var Z=this,u,G,y,q,N,e,h,d;return g.A(function(K){if(K.j==1)return g.S(K,QO(),2);if(K.j!=3)return(u=K.U)?g.S(K,PH(u,"downloadStatusEntity"),3):K.return([]);G=K.U;y=[];q=g.m(G);for(N=q.next();!N.done;N=q.next())e=N.value,e.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&e.key&&(h=g.ZE(e.key).entityId,y.push(h));return y.length?(d={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},K.return(RK(Z,y,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
d))):K.return([])})};
g.D.El=function(){var Z;return g.A(function(u){return u.j==1?g.S(u,QO(),2):(Z=u.U)?g.S(u,wq(Z,{mode:"readwrite",SK:!0},function(G){return xD(G,"mainVideoEntity").then(function(y){var q=[];y=g.m(y);for(var N=y.next();!N.done;N=y.next()){N=N.value;var e=void 0;(e=N.userState)!=null&&e.playbackPosition||(e=g.ZE(N.key).entityId,e={key:g.hq(e,"videoPlaybackPositionEntity"),videoId:e,lastPlaybackPositionSeconds:"0"},q.push(TL(G,e,"videoPlaybackPositionEntity")),N.userState={playbackPosition:e.key},q.push(TL(G,
N,"mainVideoEntity")))}return g.nB.all(q)})}),0):u.return()})};
g.D.WG=function(){var Z,u,G,y,q,N,e,h,d,K,f,V,X,n,l,Y,E,W,p,z,L,Q,b,w,yv,x9,qS,K7,GR,ED,oq,H,GH,L7,Rq,Qw,si,zH;return g.A(function(Z6){if(Z6.j==1)return g.S(Z6,QO(),2);if(Z6.j!=3){Z=Z6.U;if(!Z)return Z6.return();u=g.hq("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.S(Z6,wq(Z,{mode:"readonly",SK:!0},function(av){return g.nB.all([bR(av,u,"mainDownloadsListEntity"),bR(av,g.Sk,"mainDownloadsListEntity"),xD(av,"mainVideoEntity"),xD(av,"mainPlaylistEntity")])}),3)}G=Z6.U;
y=g.m(G);q=y.next().value;N=y.next().value;e=y.next().value;h=y.next().value;d=q;K=N;f=e;V=h;X=new Set;if((n=d)==null?0:(l=n.downloads)==null?0:l.length)for(Y=g.m(d.downloads),E=Y.next();!E.done;E=Y.next())W=E.value,p=void 0,(z=(p=W.videoItem)!=null?p:W.playlistItem)&&X.add(z);if((L=K)==null?0:(Q=L.downloads)==null?0:Q.length)for(b=g.m(K.downloads),w=b.next();!w.done;w=b.next())yv=w.value,yv.videoItem&&X.add(yv.videoItem);x9=new Set;qS=[];K7=g.m(V);for(GR=K7.next();!GR.done;GR=K7.next()){ED=GR.value;
if(ED.videos)for(oq=g.m(ED.videos),H=oq.next();!H.done;H=oq.next())GH=H.value,(L7=JSON.parse(g.ZE(GH).entityId).videoId)&&x9.add(L7);ED.key&&!X.has(ED.key)&&qS.push(ED.key)}Rq=g.m(f);for(Qw=Rq.next();!Qw.done;Qw=Rq.next())si=Qw.value,si.key&&!X.has(si.key)&&(zH=g.ZE(si.key).entityId,x9.has(zH)||qS.push(si.key));return qS.length?g.S(Z6,Tri(Z,qS),0):Z6.Rl(0)})};g.I(nOd,uv);nOd.prototype.U=function(Z){return Hi(Z)?DCk(this,Z):rN(Z)?MVk(this,Z):kD(Z)?glk(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};
var LF=[10];g.I(iKe,uv);iKe.prototype.U=function(Z){return Hi(Z)?jjs(this,Z):rN(Z)?OKa(this,Z):kD(Z)?CBi(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};
var wN=[10];g.I(Vpv,uv);Vpv.prototype.U=function(Z){return Hi(Z)?bKP(this,Z):rN(Z)?U7i(this,Z):kD(Z)?tti(this,Z):Promise.reject(Error("Unsupported action type: "+Z.actionType))};
var am4=[10];g.I(IK,pF);IK.prototype.ww=function(Z){var u=pF.prototype.ww.call(this,Z);u.musicTrack=new Vpv(Z,this.j);u.musicPlaylist=new iKe(Z,this.j);u.musicAlbumRelease=new nOd(Z,this.j);return u};
IK.prototype.refreshAllStaleEntities=function(Z,u){var G=this,y,q,N;return g.A(function(e){if(e.j==1)return g.S(e,ete(G,Z,u),2);if(e.j!=3)return q=y=e.U,N=q.concat,g.S(e,pF.prototype.refreshAllStaleEntities.call(G,Z,u),3);y=N.call(q,e.U);return e.return(y)})};g.I(Jbs,g.gC);g.D=Jbs.prototype;g.D.create=function(){var Z=this;g.M(this,this.events);if(g.Pv(this.W))this.j=new x6i(this.W,this.player);else if(g.MO(this.W)||g.we(this.W))this.j=new IK(this.W,this.player);this.events.V(this.player,"onPlaybackStartExternal",function(){Z.L7()});
this.events.V(this.player,"videodatachange",function(){Z.L7()});
this.W.S("html5_offline_playback_position_sync")&&this.events.V(this.player,"presentingplayerstatechange",this.EW)};
g.D.dI=function(){return!1};
g.D.YE=function(Z,u,G,y){var q=this;return g.A(function(N){return q.j?N.return(RK(q.j,Z,u,G,y)):N.return(Promise.reject())})};
g.D.deleteAll=function(){return this.j.deleteAll()};
g.D.Tq=function(Z){return this.j.Tq(Z)};
g.D.refreshAllStaleEntities=function(Z){return this.j.refreshAllStaleEntities(Z)};
g.D.setUpPositionSyncInterval=function(Z){this.j.setUpPositionSyncInterval(Z)};
g.D.Vy=function(Z){this.j.Vy(Z)};
g.D.Gd=function(Z){return this.j.Gd(Z)};
g.D.L7=function(){var Z=this,u;return g.A(function(G){u=Z.player.getVideoData();return g.$X(u)?FTa(u)&&Z.U!==u.clientPlaybackNonce?g.S(G,chJ(Z,u),0):G.Rl(0):G.return()})};
g.D.EW=function(Z){var u=this,G,y,q,N,e,h,d;return g.A(function(K){if(K.j==1)return G=u.player.getVideoData(),y=G.Qu,g.Il(Z,2)||g.Il(Z,512)?g.S(K,QO(),2):K.return();if(K.j!=3){q=K.U;if(!q)return FE("PES is undefined"),K.return();N=G.videoId;return g.S(K,Bi(q,g.hq(N,"mainVideoEntity"),"mainVideoEntity"),3)}e=K.U;if(!e)return K.return();h=Math.floor(y).toString();d={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:h}};return g.S(K,u.YE([N],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
d),0)})};
g.D.isOrchestrationLeader=function(){return this.j.isOrchestrationLeader()};
g.D.updateDownloadState=function(Z,u){var G,y,q,N;return g.A(function(e){if(e.j==1)return g.S(e,QO(),2);G=e.U;if(!G)return FE("PES is undefined"),e.return();y=g.ZE(Z);q=y.entityType;N=y.entityId;return g.S(e,kw(N,q,G,u,!0),0)})};g.on("offline",Jbs);})(_yt_player);
